(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,83752,e=>{"use strict";async function t(e,t){let s=await fetch(e,{...t,headers:{"Content-Type":"application/json",...t?.headers??{}}}),a=await s.text(),i=a?function(e){try{return JSON.parse(e)}catch{return e}}(a):null;if(!s.ok){let e="object"==typeof i&&i&&"error"in i?String(i.error):`Request failed (${s.status})`,t=function(e){if("string"==typeof e&&e.trim().length>0)return e.trim();if(Array.isArray(e)){let t=e.find(e=>"string"==typeof e&&e.trim().length>0);if(t)return t.trim()}if("object"!=typeof e||null===e)return null;let t=e.message;if("string"==typeof t&&t.trim().length>0)return t.trim();if(Array.isArray(t)){let e=t.find(e=>"string"==typeof e&&e.trim().length>0);if(e)return e.trim()}return null}("object"==typeof i&&i&&"details"in i?i.details:void 0);throw Error(t?`${e}: ${t}`:e)}return i}e.s(["apiRequest",()=>t])},20212,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(83752);let i=["Identity","Behavior","Voice"];function r(){let[r,n]=(0,s.useState)(0),[l,o]=(0,s.useState)([]),[c,d]=(0,s.useState)(null),[u,p]=(0,s.useState)("Fill all required fields to unlock preview."),[m,h]=(0,s.useState)(!1),[g,v]=(0,s.useState)(!1),[f,y]=(0,s.useState)(!1),[x,j]=(0,s.useState)("idle"),[b,S]=(0,s.useState)(null),[w,N]=(0,s.useState)([]),[C,k]=(0,s.useState)({name:"",intro:"",firstMessageMode:"assistant-speaks-first",systemPrompt:"",voiceId:""}),T=(0,s.useRef)(null),M=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=!0;return(0,a.apiRequest)("/api/ev/voice/voices").then(t=>{e&&(o(t.voices),k(e=>({...e,voiceId:e.voiceId||t.voices[0]?.id||""})))}).catch(t=>{e&&p(t.message)}),()=>{e=!1,M.current&&clearTimeout(M.current),T.current?.stop()}},[]);let A=(0,s.useMemo)(()=>{let e=[];return(C.name.trim().length<2||C.name.trim().length>80)&&e.push("Agent Name must be 2-80 characters."),(C.intro.trim().length<4||C.intro.trim().length>500)&&e.push("Intro / First Message must be 4-500 characters."),(C.systemPrompt.trim().length<20||C.systemPrompt.trim().length>5e3)&&e.push("Skills and Description must be 20-5000 characters."),e},[C]),P=0===A.length;async function R(){if(!P)throw Error("Complete all required fields before saving.");if(!c){let e=await (0,a.apiRequest)("/api/ev/voice/agents",{method:"POST",body:JSON.stringify({...C,status:"draft",autoCreateRemote:!0})});return d(e.agent.id),e.agent.id}return await (0,a.apiRequest)(`/api/ev/voice/agents/${c}`,{method:"PATCH",body:JSON.stringify(C)}),c}async function I(){h(!0);try{let e=await R();p(`Draft saved (${e.slice(0,8)}...).`)}catch(e){p(e.message)}finally{h(!1)}}async function $(e){M.current&&(clearTimeout(M.current),M.current=null),T.current?.stop(),T.current=null,y(!1),j("ended"),b&&await (0,a.apiRequest)(`/api/ev/voice/preview-sessions/${b}`,{method:"PATCH",body:JSON.stringify({status:e,transcript:w,ended:!0})}).catch(()=>{})}async function q(){if(!P)return void p(A[0]??"Complete all required fields first.");y(!0),j("connecting"),p("Starting preview...");try{let t=await R(),s=await (0,a.apiRequest)(`/api/ev/voice/session-config?agentId=${t}`);S(s.previewSessionId),N([]);let i=new(await e.A(42803)).default(s.publicKey);i.on("call-start",()=>{j("live"),p("Preview call is live.")}),i.on("call-end",()=>{$("ended")}),i.on("message",e=>{let t=function(e){if(!e||"object"!=typeof e)return null;let t="string"==typeof e.type?e.type:"",s="string"==typeof e.transcript&&e.transcript||"string"==typeof e.text&&e.text||"string"==typeof e.message&&e.message||"string"==typeof e.content&&e.content;return s&&(t.includes("transcript")||"message"===t)?{role:"assistant"===e.role||"assistant"===e.source||"assistant"===e.speaker?"agent":"user",text:s,at:new Date().toISOString()}:null}(e);t&&N(e=>[...e.slice(-99),t])}),i.on("error",e=>{j("error"),p(`Preview error: ${String(e)}`)}),T.current=i,await i.start(s.assistantId),M.current=setTimeout(()=>{$("timeout")},1e3*s.timeoutSeconds)}catch(e){j("error"),y(!1),p(e.message)}}async function D(){await $("stopped"),p("Preview stopped.")}async function O(){v(!0);try{let e=await R();await (0,a.apiRequest)(`/api/ev/voice/agents/${e}/deploy`,{method:"POST"}),p("Agent is live and attached to dashboard routing.")}catch(e){p(e.message)}finally{v(!1)}}return(0,t.jsxs)("div",{className:"split",children:[(0,t.jsxs)("section",{className:"card",children:[(0,t.jsx)("div",{className:"stepTabs",children:i.map((e,s)=>(0,t.jsxs)("button",{type:"button",className:`stepTab ${r===s?"active":""}`,onClick:()=>n(s),children:[s+1,". ",e]},e))}),0===r&&(0,t.jsxs)("div",{className:"fieldGrid",children:[(0,t.jsxs)("label",{children:["Agent Name",(0,t.jsx)("input",{value:C.name,maxLength:80,onChange:e=>k(t=>({...t,name:e.target.value})),placeholder:"Weekend Support Desk"})]}),(0,t.jsxs)("label",{children:["Intro / First Message",(0,t.jsx)("textarea",{rows:4,value:C.intro,maxLength:500,onChange:e=>k(t=>({...t,intro:e.target.value})),placeholder:"Hi, you reached Eburon Voice support. How can I help you today?"})]}),(0,t.jsxs)("label",{children:["Conversation Start",(0,t.jsxs)("select",{value:C.firstMessageMode,onChange:e=>k(t=>({...t,firstMessageMode:e.target.value})),children:[(0,t.jsx)("option",{value:"assistant-speaks-first",children:"Agent speaks first"}),(0,t.jsx)("option",{value:"assistant-waits-for-user",children:"User speaks first"})]})]})]}),1===r&&(0,t.jsx)("div",{className:"fieldGrid",children:(0,t.jsxs)("label",{children:["Skills and Description",(0,t.jsx)("textarea",{rows:10,value:C.systemPrompt,maxLength:5e3,onChange:e=>k(t=>({...t,systemPrompt:e.target.value})),placeholder:"You are a CSR assistant for Eburon Voice. Keep responses concise, polite, and actionable."})]})}),2===r&&(0,t.jsxs)("div",{className:"fieldGrid",children:[(0,t.jsxs)("label",{children:["Voice",(0,t.jsxs)("select",{value:C.voiceId,onChange:e=>k(t=>({...t,voiceId:e.target.value})),children:[!l.length&&(0,t.jsx)("option",{value:"",children:"Default voice"}),l.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.label," (",e.locale,")"]},e.id))]})]}),(0,t.jsx)("p",{className:"muted",children:"Only approved voices are shown. If none is selected, a default voice is auto-assigned."})]}),(0,t.jsxs)("div",{className:"inlineActions templateMarginTopLarge",children:[(0,t.jsx)("button",{type:"button",className:"secondary",onClick:I,disabled:m||!P,children:m?"Saving...":"Save Draft"}),(0,t.jsx)("button",{type:"button",className:"warn",onClick:q,disabled:!P||f,children:f?"Connecting...":"Preview"}),(0,t.jsx)("button",{type:"button",onClick:O,disabled:!P||g,children:g?"Deploying...":"Deploy"})]}),(0,t.jsxs)("p",{className:"muted templateMarginTopMedium",children:["Readiness: ",P?"Ready for preview":A[0]]})]}),(0,t.jsxs)("section",{className:"phoneMock",children:[(0,t.jsxs)("div",{className:"phoneState",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"kicker",children:"Preview Dialer"}),(0,t.jsx)("h3",{className:"templateMarginTopSmall",children:"Web Call Test"})]}),(0,t.jsx)("span",{className:`badge ${"live"===x?"live":"idle"}`,children:x})]}),(0,t.jsx)("div",{className:"inlineActions templateMarginBottomMedium",children:(0,t.jsx)("button",{type:"button",className:"ghost",onClick:D,disabled:!f&&"live"!==x,children:"Stop"})}),(0,t.jsx)("div",{className:"transcriptList",children:0===w.length?(0,t.jsx)("p",{className:"muted",children:"Transcript will appear here during the call."}):w.map((e,s)=>(0,t.jsxs)("div",{className:`transcriptItem ${"user"===e.role?"me":""}`,children:[(0,t.jsxs)("strong",{children:["agent"===e.role?"Agent":"User",":"]})," ",e.text]},`${e.at}-${s}`))}),(0,t.jsx)("p",{className:"muted templateMarginTopMedium",children:u})]})]})}e.s(["AgentBuilder",()=>r])},42803,e=>{e.v(t=>Promise.all(["static/chunks/eaed5c47280ec17e.js"].map(t=>e.l(t))).then(()=>t(1150)))}]);