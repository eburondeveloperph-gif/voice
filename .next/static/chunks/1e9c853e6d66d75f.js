(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,74378,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(7471);let l=["new","contacted","qualified","proposal","won","lost"],i="__auto_vapi_sip__",r={dashboard:"A quick glance at your recent activity.",agents:"Create and manage agents generated inside this client CRM.",calls:"Client call logs filtered to this CRM, including recordings.",leads:"Manage and convert your prospective clients.",files:"Secure document and asset tracking.",settings:"Manage branding, billing, numbers, and embed settings."};function n(e){return"disabled"===e||"requested"===e||"approved"===e?e:null}function c(e){return`$${(e/100).toFixed(2)}`}function d(e){if(!e)return"-";let a=new Date(e);return Number.isNaN(a.valueOf())?"-":a.toLocaleString()}async function o(e,a,s,t){let l=await fetch(`/api/crm/${encodeURIComponent(e)}${a}`,{...t,headers:{Authorization:`Bearer ${s}`,...t?.headers??{}}}),i=await l.json().catch(()=>({}));if(!l.ok)throw Error("string"==typeof i?.error?i.error:`Request failed (${l.status})`);return i}function m({clientSlug:m,projectName:h,projectDescription:u,logoUrl:p}){let[j,g]=(0,s.useState)(""),[x,v]=(0,s.useState)(null),[b,N]=(0,s.useState)(!1),[y,C]=(0,s.useState)(null),[f,S]=(0,s.useState)(!1),[A,w]=(0,s.useState)("dashboard"),[P,M]=(0,s.useState)(null),[T,I]=(0,s.useState)(""),[R,U]=(0,s.useState)({name:h,description:u,logoUrl:p}),[k,E]=(0,s.useState)([]),[L,F]=(0,s.useState)([]),[B,W]=(0,s.useState)([]),[H,D]=(0,s.useState)([]),[$,O]=(0,s.useState)([]),[_,G]=(0,s.useState)([]),[q,V]=(0,s.useState)(null),[J,z]=(0,s.useState)([]),[K,Y]=(0,s.useState)({fullName:"",email:"",phone:"",company:"",source:"",notes:""}),[Q,X]=(0,s.useState)(""),[Z,ee]=(0,s.useState)(null),[ea,es]=(0,s.useState)(null),[et,el]=(0,s.useState)(!1),[ei,er]=(0,s.useState)({name:"",intro:"",firstMessageMode:"assistant-speaks-first",systemPrompt:"",voiceId:"",phoneSelection:"",numberDesiredAreaCode:""}),[en,ec]=(0,s.useState)(!1),[ed,eo]=(0,s.useState)(null),[em,eh]=(0,s.useState)({name:"",intro:"",firstMessageMode:"assistant-speaks-first",systemPrompt:"",voiceId:""}),[eu,ep]=(0,s.useState)(!1),[ej,eg]=(0,s.useState)({country:"US",areaCode:"",assignAgentId:""}),[ex,ev]=(0,s.useState)(!1),[eb,eN]=(0,s.useState)(""),[ey,eC]=(0,s.useState)(!1),[ef,eS]=(0,s.useState)(null),eA=(0,s.useRef)(null),ew=(0,s.useRef)(null),eP=(0,s.useRef)(null),eM=x?.access_token??null,eT=(0,s.useMemo)(()=>new Map(k.map(e=>[e.id,e])),[k]),eI=(0,s.useMemo)(()=>{let e=new Map;for(let a of _)a.assignedAgent?.id&&e.set(a.assignedAgent.id,a.displayNumber);return e},[_]);(0,s.useEffect)(()=>{let e=(0,t.createClient)();if(!e){N(!0),C("Supabase auth is not configured. Please set Supabase env vars.");return}let a=!0;e.auth.getSession().then(({data:e})=>{a&&v(e.session)}).finally(()=>{a&&N(!0)});let{data:s}=e.auth.onAuthStateChange((e,a)=>{v(a)});return()=>{a=!1,s.subscription.unsubscribe()}},[]),(0,s.useEffect)(()=>{I(window.location.origin)},[]),(0,s.useEffect)(()=>{H.length&&er(e=>e.voiceId?e:{...e,voiceId:H[0].id})},[H]),(0,s.useEffect)(()=>{B.length&&eg(e=>e.assignAgentId?e:{...e,assignAgentId:B[0].id})},[B]),(0,s.useEffect)(()=>{!ed||B.some(e=>e.id===ed)||eo(null)},[B,ed]);let eR=(0,s.useCallback)(async()=>{ew.current&&(clearTimeout(ew.current),ew.current=null);let e=eA.current;if(e&&(e.pause(),e.currentTime=0),eP.current)try{await eP.current.stop()}catch{}finally{eP.current=null}eS(null)},[]);(0,s.useEffect)(()=>()=>{eR()},[eR]);let eU=(0,s.useCallback)(async e=>{let a=await o(m,"/bootstrap",e);E(a.leads),F(a.files),U(e=>({...e,name:a.project.name,description:a.project.description,logoUrl:a.project.logoUrl}))},[m]),ek=(0,s.useCallback)(async e=>{let a=await o(m,"",e);M(n(a.project.embedStatus)),U(e=>({...e,name:a.project.name,description:a.project.description,logoUrl:a.project.logoUrl}))},[m]),eE=(0,s.useCallback)(async e=>{let a=await o(m,"/agents",e);W(a.agents),D(a.voices)},[m]),eL=(0,s.useCallback)(async(e,a)=>{let s=new URLSearchParams;s.set("sync",a?.sync?"true":"false"),eb.trim()&&s.set("q",eb.trim()),O((await o(m,`/calls?${s.toString()}`,e)).calls)},[eb,m]),eF=(0,s.useCallback)(async e=>{G((await o(m,"/phone-numbers",e)).numbers)},[m]),eB=(0,s.useCallback)(async e=>{let a=await o(m,"/billing",e);V(a.summary),z(a.entries)},[m]),eW=(0,s.useCallback)(async e=>{if(!eM)return;S(!0);let a=(await Promise.allSettled([eU(eM),ek(eM),eE(eM),eL(eM,{sync:e?.syncCalls===!0}),eF(eM),eB(eM)])).find(e=>"rejected"===e.status);a&&"rejected"===a.status&&C(a.reason instanceof Error?a.reason.message:"Failed loading CRM data."),S(!1)},[eM,eE,eB,eU,eL,eF,ek]);async function eH(){let e=(0,t.createClient)();if(!e)return void C("Supabase auth is not configured.");if(!j.trim())return void C("Enter your email to continue.");C("Sending sign-in link...");let{error:a}=await e.auth.signInWithOtp({email:j.trim().toLowerCase(),options:{emailRedirectTo:window.location.href}});a?C(a.message):C("Check your email for a secure sign-in link.")}async function eD(){let e=(0,t.createClient)();e&&(await e.auth.signOut(),E([]),F([]),W([]),O([]),G([]),V(null),z([]),eo(null),C("Signed out."))}async function e$(){if(eM){if(!K.fullName.trim())return void C("Lead name is required.");C("Creating lead...");try{let e=await o(m,"/leads",eM,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:K.fullName.trim(),email:K.email.trim()||void 0,phone:K.phone.trim()||void 0,company:K.company.trim()||void 0,source:K.source.trim()||void 0,notes:K.notes.trim()||void 0})});E(a=>[e.lead,...a]),Y({fullName:"",email:"",phone:"",company:"",source:"",notes:""}),C("Lead created."),w("leads")}catch(e){C(e.message)}}}async function eO(e,a){if(eM){E(s=>s.map(s=>s.id===e?{...s,stage:a}:s));try{await o(m,`/leads/${encodeURIComponent(e)}`,eM,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({stage:a})}),C(null)}catch(e){C(e.message),await eU(eM)}}}async function e_(){if(!eM||!Z)return;C("Uploading file...");let e=new FormData;e.append("file",Z),Q&&e.append("leadId",Q);try{let a=await o(m,"/files",eM,{method:"POST",body:e});F(e=>[a.file,...e]),ee(null),X(""),C("File uploaded."),w("files")}catch(e){C(e.message)}}async function eG(){if(eM){S(!0),C("Requesting embed access...");try{let e=await o(m,"",eM,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({embedStatus:"requested"})}),a=n(e.project.embedStatus);a&&M(a),C("Embed access requested. Pending admin approval.")}catch(e){C(e.message)}finally{S(!1)}}}async function eq(){if(!eM||!ea)return void C("Select a logo image first.");el(!0),C("Uploading company logo...");try{let e=new FormData;e.append("logo",ea);let a=await o(m,"/branding",eM,{method:"POST",body:e});U(e=>({...e,logoUrl:a.project.logoUrl})),es(null),C("Logo updated successfully.")}catch(e){C(e.message)}finally{el(!1)}}async function eV(){let a=ei.voiceId.trim();if(!a)return void C("Select a voice first.");let s=H.find(e=>e.id===a);if(!s)return void C("Selected voice is not available.");let t=eA.current;if(!t)return void C("Voice preview player is unavailable.");if(ef===a)return void await eR();eC(!0);try{if(await eR(),s.previewSampleUrl){t.src=s.previewSampleUrl,await t.play(),eS(a),C(`Playing voice preview for ${s.label}.`);return}let l=await fetch(`/api/ev/voice/voices/preview-config?voiceId=${encodeURIComponent(a)}`),i=await l.json().catch(()=>({}));if(!l.ok||!("preview"in i)){let e="string"==typeof i.error?i.error:"Preview is unavailable for this voice.";throw Error(e)}let r=new(await e.A(42803)).default(i.preview.publicKey);eP.current=r,eS(a),r.on("call-end",()=>{eP.current===r&&(eP.current=null),eS(e=>e===a?null:e)}),r.on("error",()=>{eP.current===r&&(eP.current=null),eS(e=>e===a?null:e),C("Live voice preview failed.")}),await r.start(i.preview.assistantId,i.preview.assistantOverrides),ew.current=setTimeout(()=>{eR()},1e3*i.preview.timeoutSeconds),C(`Running live voice preview for ${s.label}.`)}catch{eS(null),C("Failed to play selected voice preview.")}finally{eC(!1)}}async function eJ(){if(eM){if(!ei.name.trim())return void C("Agent name is required.");ec(!0),C("Creating CRM agent...");try{let e=ei.phoneSelection.trim(),a=e===i,s=await o(m,"/agents",eM,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:ei.name.trim(),intro:ei.intro.trim()||void 0,firstMessageMode:ei.firstMessageMode,systemPrompt:ei.systemPrompt.trim()||void 0,voiceId:ei.voiceId||void 0,phoneNumberId:e&&!a?e:void 0,autoGeneratePhoneNumber:a||void 0,numberDesiredAreaCode:a&&ei.numberDesiredAreaCode.trim()?ei.numberDesiredAreaCode.trim():void 0})});W(e=>[s.agent,...e]);let t=s.number;t&&G(e=>[t,...e.filter(e=>e.id!==t.id)]),er(e=>({name:"",intro:"",firstMessageMode:e.firstMessageMode,systemPrompt:"",voiceId:e.voiceId,phoneSelection:"",numberDesiredAreaCode:""})),C(s.number?"CRM agent created and phone number connected.":"CRM agent created."),w("agents")}catch(e){C(e.message)}finally{ec(!1)}}}async function ez(){if(eM&&ed){if(!em.name.trim())return void C("Agent name is required.");ep(!0),C("Updating CRM agent...");try{let e=await o(m,`/agents/${encodeURIComponent(ed)}`,eM,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:em.name.trim(),intro:em.intro.trim()||void 0,firstMessageMode:em.firstMessageMode,systemPrompt:em.systemPrompt.trim()||void 0,voiceId:em.voiceId||void 0})});W(a=>a.map(a=>a.id===e.agent.id?e.agent:a)),eo(null),C("CRM agent updated.")}catch(e){C(e.message)}finally{ep(!1)}}}async function eK(){if(eM){if(!ej.assignAgentId)return void C("Select an agent for the new phone number.");ev(!0),C("Purchasing phone number...");try{let e=await o(m,"/phone-numbers",eM,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({country:ej.country.trim()||"US",areaCode:ej.areaCode.trim()||void 0,assignAgentId:ej.assignAgentId})});G(a=>[e.number,...a]),await eB(eM),C("Number purchase submitted.")}catch(e){C(e.message)}finally{ev(!1)}}}async function eY(e=!1){if(eM){S(!0);try{await eL(eM,{sync:e}),C(null)}catch(e){C(e.message)}finally{S(!1)}}}(0,s.useEffect)(()=>{eM&&eW()},[eM,eW]);let eQ=(0,s.useMemo)(()=>[{id:"dashboard",label:"Overview"},{id:"agents",label:`Agents (${B.length})`},{id:"calls",label:`Calls (${$.length})`},{id:"leads",label:`Leads (${k.length})`},{id:"files",label:`Files (${L.length})`},{id:"settings",label:"Settings"}],[B.length,$.length,k.length,L.length]);if(!b)return(0,a.jsx)("div",{className:"crmPortalRoot crmPortalCenter",children:(0,a.jsx)("p",{className:"muted",children:"Initializing workspace..."})});if(!(0,t.isSupabaseEnabled)())return(0,a.jsx)("div",{className:"crmPortalRoot crmPortalCenter",children:(0,a.jsx)("section",{className:"card crmPortalNoticeCard",children:(0,a.jsx)("p",{className:"muted crmTextCenter",children:"Auth is disabled. Please configure `NEXT_PUBLIC_SUPABASE_URL` to continue."})})});if(!x)return(0,a.jsx)("div",{className:"crmPortalRoot crmPortalCenter",children:(0,a.jsxs)("section",{className:"card crmAuthCard crmAuthCardCompact",children:[(0,a.jsxs)("div",{className:"crmAuthHeader",children:[R.logoUrl?(0,a.jsx)("img",{src:R.logoUrl,alt:R.name,width:120,height:48,className:"crmAuthLogo"}):null,(0,a.jsxs)("h2",{className:"crmAuthTitle",children:[R.name," Workspace"]}),(0,a.jsx)("p",{className:"muted crmAuthSubtitle",children:"Sign in with your client email to access your CRM."})]}),(0,a.jsxs)("div",{className:"crmAuthForm",children:[(0,a.jsx)("input",{type:"email",placeholder:"you@client.com",value:j,onChange:e=>g(e.target.value),className:"crmInputWide"}),(0,a.jsx)("button",{type:"button",className:"crmButtonFull",onClick:()=>void eH(),children:"Continue with Email Link"})]}),y?(0,a.jsx)("p",{className:"muted crmAuthStatus",children:y}):null]})});let eX=`<iframe src="${T||"{YOUR_CRM_HOST}"}/portal/${m}" width="100%" height="800px" style="border:none; border-radius:12px; box-shadow:0 4px 24px rgba(0,0,0,0.1);"></iframe>`,eZ=R.description?.trim()||r.dashboard;return(0,a.jsxs)("div",{className:"crmDashboardLayout",children:[(0,a.jsx)("audio",{ref:eA,hidden:!0,onEnded:()=>eS(null)}),(0,a.jsxs)("aside",{className:"crmSidebar",children:[(0,a.jsxs)("div",{className:"crmSidebarBrand",children:[R.logoUrl?(0,a.jsx)("img",{src:R.logoUrl,alt:R.name,className:"crmSidebarLogo"}):null,(0,a.jsx)("h2",{className:"crmSidebarName",children:R.name}),(0,a.jsxs)("div",{className:"muted crmSidebarSlug",children:["/",m]}),R.description?(0,a.jsx)("p",{className:"muted crmSidebarDescription",children:R.description}):null]}),(0,a.jsx)("nav",{className:"crmSidebarNav",children:eQ.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>w(e.id),className:`crmSidebarTab${A===e.id?" isActive":""}`,children:e.label},e.id))}),(0,a.jsxs)("div",{className:"crmSidebarFooter",children:[(0,a.jsx)("div",{className:"crmSidebarEmail",children:x.user.email??"Unknown email"}),(0,a.jsx)("button",{type:"button",className:"secondary crmButtonFull crmButtonSmall",onClick:()=>void eD(),children:"Sign Out"})]})]}),(0,a.jsxs)("main",{className:"crmMain",children:[(0,a.jsxs)("div",{className:"crmTopBar",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"crmTopTitle",children:"dashboard"===A?"Overview":A}),(0,a.jsx)("p",{className:"muted crmTopSubtitle",children:"dashboard"===A?eZ:r[A]})]}),(0,a.jsxs)("div",{className:"inlineActions inlineActionsCenter",children:[y?(0,a.jsx)("span",{className:"crmTopStatus",children:y}):null,(0,a.jsx)("button",{type:"button",className:"secondary crmButtonSmall",onClick:()=>void eW(),disabled:f,children:f?"Refreshing...":"Refresh Data"})]})]}),"dashboard"===A&&(0,a.jsxs)("div",{className:"crmStackLg",children:[(0,a.jsxs)("div",{className:"crmMetricGrid",children:[(0,a.jsxs)("div",{className:"card crmMetricCardWide",children:[(0,a.jsx)("div",{className:"muted crmMetricLabel",children:"Total Leads"}),(0,a.jsx)("div",{className:"crmMetricValueStrong",children:k.length})]}),(0,a.jsxs)("div",{className:"card crmMetricCardWide",children:[(0,a.jsx)("div",{className:"muted crmMetricLabel",children:"Client Agents"}),(0,a.jsx)("div",{className:"crmMetricValueStrong",children:B.length})]}),(0,a.jsxs)("div",{className:"card crmMetricCardWide",children:[(0,a.jsx)("div",{className:"muted crmMetricLabel",children:"Recent Calls"}),(0,a.jsx)("div",{className:"crmMetricValueStrong",children:$.length})]}),(0,a.jsxs)("div",{className:"card crmMetricCardWide",children:[(0,a.jsx)("div",{className:"muted crmMetricLabel",children:"Active Numbers"}),(0,a.jsx)("div",{className:"crmMetricValueStrong",children:_.length})]})]}),(0,a.jsxs)("div",{className:"card crmCardPadded",children:[(0,a.jsx)("h3",{className:"crmCardHeading",children:"Recent Calls (Client-Only)"}),(0,a.jsx)("div",{className:"tableWrap crmTableWrapFlush",children:(0,a.jsxs)("table",{className:"crmTableWide",children:[(0,a.jsx)("thead",{className:"crmTableHeadSmall",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Call"}),(0,a.jsx)("th",{children:"Agent"}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsx)("th",{children:"From"}),(0,a.jsx)("th",{children:"To"}),(0,a.jsx)("th",{children:"Started"}),(0,a.jsx)("th",{children:"Recording"})]})}),(0,a.jsxs)("tbody",{children:[$.slice(0,8).map(e=>(0,a.jsxs)("tr",{className:"crmRowCompact",children:[(0,a.jsx)("td",{children:e.vapiCallId}),(0,a.jsx)("td",{children:e.agent?.name??"-"}),(0,a.jsx)("td",{children:e.status}),(0,a.jsx)("td",{children:e.fromNumber??"-"}),(0,a.jsx)("td",{children:e.toNumber??"-"}),(0,a.jsx)("td",{children:d(e.startedAt)}),(0,a.jsx)("td",{children:e.recordingUrl?(0,a.jsx)("audio",{controls:!0,preload:"none",src:e.recordingUrl,className:"crmAudioPlayer"}):(0,a.jsx)("span",{className:"muted",children:"No recording"})})]},e.id)),0===$.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,className:"muted crmTableEmpty",children:"No client calls logged yet."})})]})]})})]}),(0,a.jsxs)("div",{className:"card crmCardPadded",children:[(0,a.jsx)("h3",{className:"crmCardHeading",children:"Quick Add Lead"}),(0,a.jsxs)("div",{className:"fieldGrid crmQuickLeadGrid",children:[(0,a.jsx)("input",{placeholder:"Full Name",value:K.fullName,onChange:e=>Y(a=>({...a,fullName:e.target.value}))}),(0,a.jsx)("input",{placeholder:"Email",type:"email",value:K.email,onChange:e=>Y(a=>({...a,email:e.target.value}))})]}),(0,a.jsx)("div",{className:"crmActionsEnd",children:(0,a.jsx)("button",{type:"button",onClick:()=>void e$(),children:"Save Lead"})})]})]}),"agents"===A&&(0,a.jsxs)("div",{className:"crmStack",children:[(0,a.jsxs)("div",{className:"card crmCardPadded",children:[(0,a.jsx)("h3",{className:"crmCardHeading",children:"Create CRM Agent"}),(0,a.jsxs)("div",{className:"fieldGrid crmAgentGrid",children:[(0,a.jsxs)("label",{children:["Name",(0,a.jsx)("input",{value:ei.name,onChange:e=>er(a=>({...a,name:e.target.value})),placeholder:"Client Assistant"})]}),(0,a.jsxs)("label",{children:["Voice",(0,a.jsxs)("div",{className:"crmVoiceSelectGroup",children:[(0,a.jsxs)("select",{"aria-label":"Agent Voice",value:ei.voiceId,onChange:e=>er(a=>({...a,voiceId:e.target.value})),className:"crmInputGrow",children:[!H.length&&(0,a.jsx)("option",{value:"",children:"No approved voices"}),H.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.label," (",e.locale,")"]},e.id))]}),(0,a.jsx)("button",{type:"button",className:"secondary",onClick:()=>void eV(),disabled:ey||!ei.voiceId,"aria-label":"Preview selected voice",title:"Preview selected voice",children:ef===ei.voiceId?"■":"▶"})]}),(0,a.jsx)("p",{className:"muted crmInputHint",children:"If no voice is selected, a default approved voice is auto-assigned."})]}),(0,a.jsxs)("label",{children:["Phone Number",(0,a.jsxs)("select",{"aria-label":"Assign Phone Number",value:ei.phoneSelection,onChange:e=>er(a=>({...a,phoneSelection:e.target.value})),children:[(0,a.jsx)("option",{value:"",children:"No number selected"}),(0,a.jsx)("option",{value:i,children:"Auto-generate free VAPI SIP number"}),_.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.displayNumber,e.assignedAgent?` (assigned: ${e.assignedAgent.name})`:""]},e.id))]})]}),ei.phoneSelection===i?(0,a.jsxs)("label",{children:["Preferred Area Code (optional)",(0,a.jsx)("input",{value:ei.numberDesiredAreaCode,onChange:e=>er(a=>({...a,numberDesiredAreaCode:e.target.value.replace(/\D/g,"").slice(0,3)})),placeholder:"212",inputMode:"numeric",maxLength:3})]}):null,(0,a.jsxs)("label",{className:"crmFieldFull",children:["Intro (optional)",(0,a.jsx)("input",{value:ei.intro,onChange:e=>er(a=>({...a,intro:e.target.value})),placeholder:"Hi, this is your assistant. How can I help?"})]}),(0,a.jsxs)("label",{children:["Conversation Start",(0,a.jsxs)("select",{"aria-label":"Conversation Start Mode",value:ei.firstMessageMode,onChange:e=>er(a=>({...a,firstMessageMode:e.target.value})),children:[(0,a.jsx)("option",{value:"assistant-speaks-first",children:"Agent speaks first"}),(0,a.jsx)("option",{value:"assistant-waits-for-user",children:"User speaks first"})]})]}),(0,a.jsxs)("label",{className:"crmFieldFull",children:["System Prompt (optional)",(0,a.jsx)("textarea",{rows:5,value:ei.systemPrompt,onChange:e=>er(a=>({...a,systemPrompt:e.target.value})),placeholder:"Instructions for this client's voice agent..."})]})]}),(0,a.jsxs)("div",{className:"inlineActions crmTopGap",children:[(0,a.jsx)("button",{type:"button",onClick:()=>void eJ(),disabled:en,children:en?"Creating...":"Create Agent"}),(0,a.jsx)("button",{type:"button",className:"secondary",onClick:()=>void eW(),disabled:f,children:"Refresh"})]})]}),ed?(0,a.jsxs)("div",{className:"card crmCardPadded",children:[(0,a.jsx)("h3",{className:"crmCardHeading",children:"Edit CRM Agent"}),(0,a.jsxs)("div",{className:"fieldGrid crmAgentGrid",children:[(0,a.jsxs)("label",{children:["Name",(0,a.jsx)("input",{value:em.name,onChange:e=>eh(a=>({...a,name:e.target.value})),placeholder:"Client Assistant"})]}),(0,a.jsxs)("label",{children:["Voice",(0,a.jsxs)("select",{"aria-label":"Agent Voice",value:em.voiceId,onChange:e=>eh(a=>({...a,voiceId:e.target.value})),children:[!H.length&&(0,a.jsx)("option",{value:"",children:"Default voice"}),H.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.label," (",e.locale,")"]},e.id))]})]}),(0,a.jsxs)("label",{className:"crmFieldFull",children:["Intro",(0,a.jsx)("input",{value:em.intro,onChange:e=>eh(a=>({...a,intro:e.target.value})),placeholder:"Hi, this is your assistant. How can I help?"})]}),(0,a.jsxs)("label",{children:["Conversation Start",(0,a.jsxs)("select",{"aria-label":"Conversation Start Mode",value:em.firstMessageMode,onChange:e=>eh(a=>({...a,firstMessageMode:e.target.value})),children:[(0,a.jsx)("option",{value:"assistant-speaks-first",children:"Agent speaks first"}),(0,a.jsx)("option",{value:"assistant-waits-for-user",children:"User speaks first"})]})]}),(0,a.jsxs)("label",{className:"crmFieldFull",children:["System Prompt",(0,a.jsx)("textarea",{rows:5,value:em.systemPrompt,onChange:e=>eh(a=>({...a,systemPrompt:e.target.value})),placeholder:"Instructions for this client's voice agent..."})]})]}),(0,a.jsxs)("div",{className:"inlineActions crmTopGap",children:[(0,a.jsx)("button",{type:"button",onClick:()=>void ez(),disabled:eu,children:eu?"Updating...":"Update Agent"}),(0,a.jsx)("button",{type:"button",className:"secondary",onClick:function(){eo(null),C("Canceled CRM agent edit.")},disabled:eu,children:"Cancel"})]})]}):null,(0,a.jsxs)("div",{className:"card crmCardPadded",children:[(0,a.jsx)("h3",{className:"crmCardHeading",children:"CRM Agents"}),(0,a.jsx)("div",{className:"tableWrap crmTableWrapFlush",children:(0,a.jsxs)("table",{className:"crmTableWide",children:[(0,a.jsx)("thead",{className:"crmTableHeadSmall",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Name"}),(0,a.jsx)("th",{children:"Voice"}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsx)("th",{children:"Conversation Start"}),(0,a.jsx)("th",{children:"Phone Number"}),(0,a.jsx)("th",{children:"Description"}),(0,a.jsx)("th",{children:"Updated"}),(0,a.jsx)("th",{children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[B.map(e=>(0,a.jsxs)("tr",{className:"crmRowCompact",children:[(0,a.jsx)("td",{className:"crmLeadName",children:e.name}),(0,a.jsx)("td",{children:e.voiceLabel}),(0,a.jsx)("td",{children:e.status}),(0,a.jsx)("td",{children:"assistant-waits-for-user"===e.firstMessageMode?"User first":"Agent first"}),(0,a.jsx)("td",{children:eI.get(e.id)??"-"}),(0,a.jsx)("td",{className:"muted",children:e.description}),(0,a.jsx)("td",{children:d(e.updatedAt)}),(0,a.jsx)("td",{children:(0,a.jsx)("button",{type:"button",className:"secondary crmButtonSmall",onClick:()=>{eo(e.id),eh({name:e.name,intro:e.intro,firstMessageMode:e.firstMessageMode,systemPrompt:e.systemPrompt,voiceId:e.voiceId}),C(`Editing ${e.name}.`)},disabled:eu,children:ed===e.id?"Editing":"Edit"})})]},e.id)),!B.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:8,className:"muted crmTableEmpty",children:"No CRM agents yet."})})]})]})})]})]}),"calls"===A&&(0,a.jsxs)("div",{className:"crmStack",children:[(0,a.jsx)("section",{className:"card crmCardPadded",children:(0,a.jsxs)("div",{className:"inlineActions",children:[(0,a.jsx)("input",{"aria-label":"Search Calls",value:eb,onChange:e=>eN(e.target.value),placeholder:"Search number or call id",className:"crmInputSearch"}),(0,a.jsx)("button",{type:"button",className:"secondary",onClick:()=>void eY(!1),disabled:f,children:"Search"}),(0,a.jsx)("button",{type:"button",onClick:()=>void eY(!0),disabled:f,children:"Sync + Refresh"})]})}),(0,a.jsx)("section",{className:"card crmCardPadded",children:(0,a.jsx)("div",{className:"tableWrap crmTableWrapFlush",children:(0,a.jsxs)("table",{className:"crmTableWide",children:[(0,a.jsx)("thead",{className:"crmTableHeadSmall",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Call"}),(0,a.jsx)("th",{children:"Agent"}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsx)("th",{children:"From"}),(0,a.jsx)("th",{children:"To"}),(0,a.jsx)("th",{children:"Duration"}),(0,a.jsx)("th",{children:"Cost"}),(0,a.jsx)("th",{children:"Started"}),(0,a.jsx)("th",{children:"Recording"})]})}),(0,a.jsxs)("tbody",{children:[$.map(e=>(0,a.jsxs)("tr",{className:"crmRowCompact",children:[(0,a.jsx)("td",{children:e.vapiCallId}),(0,a.jsx)("td",{children:e.agent?.name??"-"}),(0,a.jsx)("td",{children:e.status}),(0,a.jsx)("td",{children:e.fromNumber??"-"}),(0,a.jsx)("td",{children:e.toNumber??"-"}),(0,a.jsx)("td",{children:e.durationSeconds??"-"}),(0,a.jsx)("td",{children:"number"==typeof e.costUsd?`$${e.costUsd.toFixed(3)}`:"-"}),(0,a.jsx)("td",{children:d(e.startedAt)}),(0,a.jsx)("td",{children:e.recordingUrl?(0,a.jsx)("audio",{controls:!0,preload:"none",src:e.recordingUrl,className:"crmAudioPlayer"}):(0,a.jsx)("span",{className:"muted",children:"No recording"})})]},e.id)),!$.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:9,className:"muted crmTableEmpty",children:"No client calls logged yet."})})]})]})})})]}),"leads"===A&&(0,a.jsx)("div",{className:"crmStack",children:(0,a.jsx)("div",{className:"card crmCardPadded",children:(0,a.jsx)("div",{className:"tableWrap crmTableWrapFlush",children:(0,a.jsxs)("table",{className:"crmTableWide",children:[(0,a.jsx)("thead",{className:"crmTableHeadSmall",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Name"}),(0,a.jsx)("th",{children:"Email"}),(0,a.jsx)("th",{children:"Phone"}),(0,a.jsx)("th",{children:"Company"}),(0,a.jsx)("th",{children:"Stage"})]})}),(0,a.jsxs)("tbody",{children:[k.map(e=>(0,a.jsxs)("tr",{className:"crmRowCompact",children:[(0,a.jsx)("td",{className:"crmLeadName",children:e.fullName}),(0,a.jsx)("td",{className:"muted",children:e.email??"-"}),(0,a.jsx)("td",{className:"muted",children:e.phone??"-"}),(0,a.jsx)("td",{className:"muted",children:e.company??"-"}),(0,a.jsx)("td",{children:(0,a.jsx)("select",{"aria-label":"Lead Stage",value:e.stage,onChange:a=>void eO(e.id,a.target.value),className:"crmStageSelect",children:l.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})})]},e.id)),!k.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"muted crmTableEmpty",children:"No leads exist yet."})})]})]})})})}),"files"===A&&(0,a.jsxs)("div",{className:"crmStack",children:[(0,a.jsxs)("div",{className:"card crmCardPadded crmFileUploadCard",children:[(0,a.jsxs)("select",{"aria-label":"Select lead",value:Q,onChange:e=>X(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"General (no lead)"}),k.map(e=>(0,a.jsx)("option",{value:e.id,children:e.fullName},e.id))]}),(0,a.jsx)("input",{"aria-label":"Upload File",type:"file",onChange:e=>ee(e.target.files?.[0]??null),className:"crmUploadInput crmFileInputGrow"}),(0,a.jsx)("button",{type:"button",onClick:()=>void e_(),disabled:!Z,children:"Upload File"})]}),(0,a.jsx)("div",{className:"card crmCardPadded",children:(0,a.jsx)("div",{className:"tableWrap crmTableWrapFlush",children:(0,a.jsxs)("table",{className:"crmTableWide",children:[(0,a.jsx)("thead",{className:"crmTableHeadSmall",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"File Name"}),(0,a.jsx)("th",{children:"Associated Lead"}),(0,a.jsx)("th",{children:"Uploaded By"}),(0,a.jsx)("th",{children:"Size"})]})}),(0,a.jsxs)("tbody",{children:[L.map(e=>(0,a.jsxs)("tr",{className:"crmRowCompact",children:[(0,a.jsx)("td",{children:e.publicUrl?(0,a.jsx)("a",{href:e.publicUrl,target:"_blank",rel:"noreferrer",className:"crmFileLink",children:e.fileName}):e.fileName}),(0,a.jsx)("td",{className:"muted",children:e.leadId?eT.get(e.leadId)?.fullName??e.leadId:"General"}),(0,a.jsx)("td",{className:"muted",children:e.uploadedByEmail??"-"}),(0,a.jsxs)("td",{className:"muted",children:[Math.round(e.sizeBytes/1024)," KB"]})]},e.id)),!L.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,className:"muted crmTableEmpty",children:"No files uploaded yet."})})]})]})})})]}),"settings"===A&&(0,a.jsxs)("div",{className:"crmSettingsStack",children:[(0,a.jsxs)("div",{className:"card crmSettingsCard",children:[(0,a.jsx)("h3",{className:"crmSettingsTitle",children:"Company Branding"}),(0,a.jsx)("p",{className:"muted crmSettingsHelp",children:"Upload your company logo. It will appear beside your CRM title."}),(0,a.jsxs)("div",{className:"crmSettingsDivider crmLogoUpload",children:[R.logoUrl?(0,a.jsx)("img",{src:R.logoUrl,alt:"Company logo",width:72,height:72,className:"crmCompanyLogoLarge"}):(0,a.jsx)("div",{className:"crmCompanyLogoPlaceholder",children:"No Logo"}),(0,a.jsxs)("div",{className:"crmLogoActions",children:[(0,a.jsx)("input",{"aria-label":"Upload Logo",type:"file",accept:"image/*",onChange:e=>es(e.target.files?.[0]??null)}),(0,a.jsx)("div",{className:"inlineActions",children:(0,a.jsx)("button",{type:"button",onClick:()=>void eq(),disabled:et||!ea,children:et?"Uploading...":"Upload Logo"})})]})]})]}),(0,a.jsxs)("div",{className:"card crmSettingsCard",children:[(0,a.jsx)("h3",{className:"crmSettingsTitle",children:"Billing"}),(0,a.jsx)("p",{className:"muted crmSettingsHelp",children:"CRM-specific billing summary for this client project."}),(0,a.jsxs)("div",{className:"crmSettingsDivider",children:[(0,a.jsxs)("div",{className:"crmBillingGrid",children:[(0,a.jsxs)("div",{className:"card crmBillingCard",children:[(0,a.jsx)("div",{className:"muted crmBillingLabel",children:"Balance"}),(0,a.jsx)("div",{className:"crmBillingValue",children:c(q?.balanceCents??0)})]}),(0,a.jsxs)("div",{className:"card crmBillingCard",children:[(0,a.jsx)("div",{className:"muted crmBillingLabel",children:"Monthly Phone Cost"}),(0,a.jsx)("div",{className:"crmBillingValue",children:c(q?.monthlyPhoneCostCents??0)})]}),(0,a.jsxs)("div",{className:"card crmBillingCard",children:[(0,a.jsx)("div",{className:"muted crmBillingLabel",children:"Entries"}),(0,a.jsx)("div",{className:"crmBillingValue",children:q?.entryCount??0})]})]}),(0,a.jsx)("div",{className:"tableWrap crmTableWrapFlush",children:(0,a.jsxs)("table",{className:"crmTableWide",children:[(0,a.jsx)("thead",{className:"crmTableHeadSmall",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Description"}),(0,a.jsx)("th",{children:"Type"}),(0,a.jsx)("th",{children:"Amount"}),(0,a.jsx)("th",{children:"Date"})]})}),(0,a.jsxs)("tbody",{children:[J.map(e=>(0,a.jsxs)("tr",{className:"crmRowCompact",children:[(0,a.jsx)("td",{children:e.description}),(0,a.jsx)("td",{children:e.entryType}),(0,a.jsx)("td",{children:c(e.amountCents)}),(0,a.jsx)("td",{children:d(e.createdAt)})]},e.id)),!J.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,className:"muted crmTableEmpty",children:"No billing entries for this CRM yet."})})]})]})})]})]}),(0,a.jsxs)("div",{className:"card crmSettingsCard",children:[(0,a.jsx)("h3",{className:"crmSettingsTitle",children:"Phone Numbers"}),(0,a.jsx)("p",{className:"muted crmSettingsHelp",children:"Purchase numbers and assign them to your CRM agents."}),(0,a.jsxs)("div",{className:"crmSettingsDivider",children:[(0,a.jsxs)("div",{className:"fieldGrid crmPhoneGrid",children:[(0,a.jsxs)("label",{children:["Country",(0,a.jsx)("input",{value:ej.country,onChange:e=>eg(a=>({...a,country:e.target.value})),placeholder:"US"})]}),(0,a.jsxs)("label",{children:["Area Code (optional)",(0,a.jsx)("input",{value:ej.areaCode,onChange:e=>eg(a=>({...a,areaCode:e.target.value})),placeholder:"212"})]}),(0,a.jsxs)("label",{children:["Assign Agent",(0,a.jsxs)("select",{"aria-label":"Assign Agent",value:ej.assignAgentId,onChange:e=>eg(a=>({...a,assignAgentId:e.target.value})),children:[!B.length&&(0,a.jsx)("option",{value:"",children:"No CRM agents"}),B.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,a.jsx)("div",{className:"inlineActions crmTopGapSmall",children:(0,a.jsx)("button",{type:"button",onClick:()=>void eK(),disabled:ex||!B.length,children:ex?"Purchasing...":"Purchase Number"})}),(0,a.jsx)("div",{className:"tableWrap crmTableWrapFlush crmTopGap",children:(0,a.jsxs)("table",{className:"crmTableWide",children:[(0,a.jsx)("thead",{className:"crmTableHeadSmall",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Number"}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsx)("th",{children:"Assigned Agent"}),(0,a.jsx)("th",{children:"Price"})]})}),(0,a.jsxs)("tbody",{children:[_.map(e=>(0,a.jsxs)("tr",{className:"crmRowCompact",children:[(0,a.jsx)("td",{children:e.displayNumber}),(0,a.jsx)("td",{children:e.status}),(0,a.jsx)("td",{children:e.assignedAgent?.name??"-"}),(0,a.jsx)("td",{children:c(e.monthlyPriceCents)})]},e.id)),!_.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,className:"muted crmTableEmpty",children:"No CRM numbers yet."})})]})]})})]})]}),(0,a.jsxs)("div",{className:"card crmSettingsCard",children:[(0,a.jsxs)("div",{className:"crmSettingsHeader",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"crmSettingsTitle",children:"Dashboard Embed"}),(0,a.jsx)("p",{className:"muted crmSettingsHelp",children:"Request permission from the admin to embed this CRM directly into your own internal tools or intranet via an iframe."})]}),(0,a.jsxs)("div",{className:`crmEmbedStatusPill${"approved"===P?" isApproved":""}${"requested"===P?" isRequested":""}`,children:["Status: ",(0,a.jsx)("span",{className:"crmEmbedStatusValue",children:P?P.toUpperCase():"DISABLED"})]})]}),(0,a.jsxs)("div",{className:"crmSettingsDivider",children:[(!P||"disabled"===P)&&(0,a.jsx)("button",{type:"button",onClick:()=>void eG(),disabled:f,children:"Request Embed Access"}),"requested"===P&&(0,a.jsxs)("div",{className:"crmEmbedPending",children:[(0,a.jsx)("p",{className:"crmEmbedPendingTitle",children:"Your request is currently pending admin review."}),(0,a.jsx)("p",{className:"crmEmbedPendingCopy",children:"You will see the embed code snippet here once approved."})]}),"approved"===P&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"crmSnippetTitle",children:"Your Integration Snippet"}),(0,a.jsxs)("div",{className:"crmSnippetWrap",children:[(0,a.jsx)("pre",{className:"crmSnippetCode",children:(0,a.jsx)("code",{children:eX})}),(0,a.jsx)("button",{type:"button",className:"secondary crmSnippetCopyButton",onClick:()=>{navigator.clipboard.writeText(eX),C("Snippet copied to clipboard!")},children:"Copy Code"})]})]})]})]})]})]})]})}e.s(["CrmPortal",()=>m])}]);