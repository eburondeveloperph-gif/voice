module.exports=[21486,e=>{"use strict";let t=new Map(["Elliot","Kylie","Rohan","Lily","Savannah","Hana","Neha","Cole","Harry","Paige","Spencer","Nico","Kai","Emma","Sagar","Neil","Leah","Tara","Jess","Leo","Dan","Mia","Zac","Zoe"].map(e=>[e.toLowerCase(),e]));function a(e){return t.get(e.toLowerCase())??e}function r(e,r,i){let n=e.trim(),s=r.trim();if("vapi"!==n.toLowerCase())return{provider:n,voiceId:s};let o=a(s);if(t.has(o.toLowerCase()))return{provider:"vapi",voiceId:o};let l=function(e){if(!e)return;let t=e.trim();if(t)return t.replace(/\s*\([^)]*\)\s*$/,"").trim()}(i);if(l){let e=a(l);if(t.has(e.toLowerCase()))return{provider:"vapi",voiceId:e}}return{provider:"vapi",voiceId:s}}e.s(["normalizeVoiceSelection",()=>r])},53791,95265,e=>{"use strict";var t=e.i(43793);async function a(e){let a=await t.prisma.integration.findMany({where:{orgId:e,mode:"eburon_credential",status:"active",upstreamCredentialId:{not:null}},select:{upstreamCredentialId:!0},orderBy:{createdAt:"asc"}}),r=new Set;for(let e of a){let t=e.upstreamCredentialId?.trim();t&&r.add(t)}return Array.from(r)}e.s(["getActiveAssistantCredentialIds",()=>a],53791);var r=e.i(21486);function i(e,t,a={}){let n="assistant-waits-for-user"===e.firstMessageMode?"assistant-waits-for-user":"assistant-speaks-first",s=(0,r.normalizeVoiceSelection)(t.upstreamProvider,t.upstreamVoiceId,t.label),o={name:e.name,firstMessage:e.intro,firstMessageMode:n,model:{provider:"openai",model:"gpt-4o-mini",messages:[{role:"system",content:e.systemPrompt}],temperature:.4},transcriber:{provider:"deepgram",model:"nova-3",language:"en-US"},voice:s,endCallMessage:"Thanks for calling Eburon Voice. Goodbye.",recordingEnabled:!0,maxDurationSeconds:900};return a.credentialIds&&a.credentialIds.length>0&&(o.credentialIds=Array.from(new Set(a.credentialIds))),o}e.s(["buildAssistantTemplate",()=>i],95265)},30248,e=>{"use strict";var t=e.i(43793);async function a(e){let a=e?.trim();if(a){let e=await t.prisma.voiceCatalog.findFirst({where:{id:a,isApproved:!0}});if(e)return e}let r=await t.prisma.voiceCatalog.findFirst({where:{isApproved:!0,OR:[{id:"orbit-elliot"},{upstreamProvider:"vapi",upstreamVoiceId:"elliot"}]},orderBy:[{sortOrder:"asc"},{label:"asc"}]});if(r)return r;let i=await t.prisma.voiceCatalog.findFirst({where:{isApproved:!0,upstreamProvider:"vapi"},orderBy:[{sortOrder:"asc"},{label:"asc"}]});return i||t.prisma.voiceCatalog.findFirst({where:{isApproved:!0},orderBy:[{sortOrder:"asc"},{label:"asc"}]})}e.s(["resolveDefaultApprovedVoice",()=>a])},26583,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),i=e.i(59756),n=e.i(61916),s=e.i(74677),o=e.i(69741),l=e.i(16795),d=e.i(87718),u=e.i(95169),c=e.i(47587),p=e.i(66012),m=e.i(70101),f=e.i(26937),v=e.i(10372),h=e.i(93695);e.i(52474);var g=e.i(5232),w=e.i(43793),y=e.i(40688),A=e.i(53791),R=e.i(30248),C=e.i(84260),E=e.i(95265),b=e.i(67629);async function I(e){return(0,C.runGatewayOptions)(e)}async function S(e){return(0,C.runGatewayHandler)(e,"agents.create",async({tenant:t})=>{let a=await e.json().catch(()=>({})),r=x(a.name)??"New Agent",i=x(a.intro)??"Hello!",n=x(a.systemPrompt)??"You are a helpful assistant.",s=_(a.firstMessageMode),o=!1!==a.autoCreateRemote,l=x(a.voiceId)?.trim(),d=await (0,R.resolveDefaultApprovedVoice)(l);if(!d)throw Error("No approved voices found in VoiceCatalog. Sync voices first, then create an agent.");let u=null,c=d.label;if(o){let e=await (0,A.getActiveAssistantCredentialIds)(t.org.id),a=await b.upstream.createAssistant((0,E.buildAssistantTemplate)({name:r,intro:i,firstMessageMode:s,systemPrompt:n},d,{credentialIds:e}));if(!(u=x(a.id)??x(a.assistantId)??null))throw Object.assign(Error("Could not determine remote assistant id."),{status:502});u&&(c=T(a)||d.label)}let p=await w.prisma.agent.create({data:{orgId:t.org.id,name:r,intro:i,firstMessageMode:s,systemPrompt:n,voiceId:d.id,vapiAssistantId:u,status:"draft"},include:{voice:!0}});return{payload:{agent:{id:p.vapiAssistantId||p.id,name:p.name,intro:p.intro,firstMessageMode:_(p.firstMessageMode),description:M(p.systemPrompt),voiceLabel:p.voice.label??c,skills:O(p.systemPrompt),tools:[],phone:y.DEFAULT_AGENT_PHONE,phoneDirection:"both",status:p.status,updatedAt:p.updatedAt.toISOString(),kbFiles:[],isSample:!1}},status:201,resourceId:p.id}})}async function P(e){return(0,C.runGatewayHandler)(e,"agents.list",async({tenant:t})=>{let a="false"!==e.nextUrl.searchParams.get("sync"),r=function(e){let t={},a=e.get("limit");if(a){let e=Number(a);Number.isFinite(e)&&(t.limit=Math.max(0,Math.min(1e3,Math.floor(e))))}for(let a of["createdAtGt","createdAtLt","createdAtGe","createdAtLe","updatedAtGt","updatedAtLt","updatedAtGe","updatedAtLe"]){let r=e.get(a);r&&r.trim()&&(t[a]=r.trim())}return t}(e.nextUrl.searchParams),i=(await w.prisma.agent.findMany({where:{orgId:t.org.id},include:{voice:!0},orderBy:{updatedAt:"desc"}})).map(e=>({id:e.vapiAssistantId||e.id,name:e.name,intro:e.intro,firstMessageMode:_(e.firstMessageMode),description:M(e.systemPrompt),voiceLabel:e.voice.label,skills:O(e.systemPrompt),tools:[],phone:y.DEFAULT_AGENT_PHONE,phoneDirection:"both",status:e.status,updatedAt:e.updatedAt.toISOString(),kbFiles:[],isSample:!1})),n=[],s=null;if(a)try{let e=await b.upstream.listAssistants({...r,limit:r.limit??1e3});n=function(e){let t=e.filter(e=>"object"==typeof e&&null!==e).map(N).filter(e=>null!==e),a=new Set,r=[];for(let e of t)a.has(e.id)||(a.add(e.id),r.push(e));return r.sort((e,t)=>t.updatedAt.localeCompare(e.updatedAt))}(e)}catch(e){s=e.message}let o=new Set(i.map(e=>e.id)),l=n.filter(e=>!o.has(e.id));return{payload:{agents:[...i,...l],sampleCount:l.length,syncedFromGateway:a,syncError:s}}})}function N(e){var t;let a,r=x(e.id);if(!r)return null;let i=x(e.name)??`Assistant ${r.slice(0,6)}`,n=x(e.firstMessage)??"Hello, how can I help you today?",s=_(e.firstMessageMode),o=function(e){let t=H(e.model);for(let e of D(t?.messages)){let t=x(e.role)?.toLowerCase(),a=x(e.content);if("system"===t&&a)return a}return x(e.description)??"Sample assistant imported from upstream."}(e),l=x(e.updatedAt)??new Date().toISOString(),d=T(e);return{id:r,name:i,intro:n,firstMessageMode:s,description:M(o),voiceLabel:d,skills:O(o),tools:(a=H((t=e).model),D(a?.tools??t.tools).map(e=>x(e.name)??x(e.type)).filter(e=>!!e).slice(0,8)),phone:y.DEFAULT_AGENT_PHONE,phoneDirection:"both",status:"deployed",updatedAt:l,kbFiles:[],isSample:!0}}function T(e){let t=H(e.voice);return x(t?.voiceId)??x(t?.name)??x(t?.id)??"Default Voice"}function M(e){let t=e.replace(/\s+/g," ").trim();return t?t.length>220?`${t.slice(0,220)}â€¦`:t:"Sample assistant imported from upstream."}function O(e){let t=Array.from(e.matchAll(/\[([^\]]{2,40})\]/g)).map(e=>e[1].trim()).filter(Boolean).slice(0,6);if(t.length>0)return t;let a=e.split(/[\n,.]/).map(e=>e.trim()).filter(e=>e.length>=4).slice(0,4);return a.length>0?a:["General Conversation"]}function x(e){return"string"==typeof e&&e.trim().length>0?e.trim():void 0}function _(e){return"assistant-waits-for-user"===e?"assistant-waits-for-user":"assistant-speaks-first"}function H(e){return"object"==typeof e&&null!==e?e:null}function D(e){return Array.isArray(e)?e.filter(e=>"object"==typeof e&&null!==e):[]}e.s(["GET",()=>P,"OPTIONS",()=>I,"POST",()=>S,"dynamic",0,"force-dynamic"],35854);var L=e.i(35854);let k=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/ev/voice/agents/route",pathname:"/api/ev/voice/agents",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/ev/voice/agents/route.ts",nextConfigOutput:"",userland:L}),{workAsyncStorage:U,workUnitAsyncStorage:F,serverHooks:G}=k;function q(){return(0,r.patchFetch)({workAsyncStorage:U,workUnitAsyncStorage:F})}async function j(e,t,r){k.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/ev/voice/agents/route";w=w.replace(/\/index$/,"")||"/";let y=await k.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:A,params:R,nextConfig:C,parsedUrl:E,isDraftMode:b,prerenderManifest:I,routerServerContext:S,isOnDemandRevalidate:P,revalidateOnlyGenerated:N,resolvedPathname:T,clientReferenceManifest:M,serverActionsManifest:O}=y,x=(0,o.normalizeAppPath)(w),_=!!(I.dynamicRoutes[x]||I.routes[T]),H=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,E,!1):t.end("This page could not be found"),null);if(_&&!b){let e=!!I.routes[T],t=I.dynamicRoutes[x];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await H();throw new h.NoFallbackError}}let D=null;!_||k.isDev||b||(D="/index"===(D=T)?"/":D);let L=!0===k.isDev||!_,U=_&&!L;O&&M&&(0,s.setManifestsSingleton)({page:w,clientReferenceManifest:M,serverActionsManifest:O});let F=e.method||"GET",G=(0,n.getTracer)(),q=G.getActiveScopeSpan(),j={params:R,prerenderManifest:I,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:L,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,i)=>k.onRequestError(e,t,r,i,S)},sharedContext:{buildId:A}},V=new l.NodeNextRequest(e),$=new l.NodeNextResponse(t),B=d.NextRequestAdapter.fromNodeNextRequest(V,(0,d.signalFromNodeResponse)(t));try{let s=async e=>k.handle(B,j).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=G.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${F} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${w}`)}),o=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var n,l;let d=async({previousCacheEntry:a})=>{try{if(!o&&P&&N&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(i);e.fetchMetrics=j.renderOpts.fetchMetrics;let l=j.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let d=j.renderOpts.collectedTags;if(!_)return await (0,p.sendResponse)(V,$,n,j.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[v.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==j.renderOpts.collectedRevalidate&&!(j.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&j.renderOpts.collectedRevalidate,r=void 0===j.renderOpts.collectedExpire||j.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:j.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await k.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:P})},!1,S),t}},u=await k.handleResponse({req:e,nextConfig:C,cacheKey:D,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:I,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:N,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:o});if(!_)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",P?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&_||h.delete(v.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(V,$,new Response(u.value.body,{headers:h,status:u.value.status||200})),null};q?await l(q):await G.withPropagatedContext(e.headers,()=>G.trace(u.BaseServerSpan.handleRequest,{spanName:`${F} ${w}`,kind:n.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},l))}catch(t){if(t instanceof h.NoFallbackError||await k.onRequestError(e,t,{routerKind:"App Router",routePath:x,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:P})},!1,S),_)throw t;return await (0,p.sendResponse)(V,$,new Response(null,{status:500})),null}}e.s(["handler",()=>j,"patchFetch",()=>q,"routeModule",()=>k,"serverHooks",()=>G,"workAsyncStorage",()=>U,"workUnitAsyncStorage",()=>F],26583)}];

//# sourceMappingURL=_2efba26c._.js.map