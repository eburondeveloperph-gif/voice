module.exports=[33708,e=>{"use strict";let t={tool_providers:"Tool Providers",vector_store_providers:"Vector Store Providers",phone_number_providers:"Phone Number Providers",cloud_providers:"Cloud Providers",observability_providers:"Observability Providers",server_configuration:"Server Configuration"},r=[{key:"make",label:"Make",badge:"M",category:"tool_providers",description:"Automate workflows with Make.com integration webhooks.",mode:"eburon_credential",eburonProvider:"make",fields:[{key:"teamId",label:"Team ID",type:"text",required:!0,placeholder:"team_123..."},{key:"region",label:"Region",type:"text",required:!0,placeholder:"us1"},{key:"apiKey",label:"API Key",type:"password",required:!0,placeholder:"mk_live_..."}],buildEburonCredentialPayload:({name:e,config:t})=>({provider:"make",teamId:p(t,"teamId","Team ID"),region:p(t,"region","Region"),apiKey:p(t,"apiKey","API Key"),name:e})},{key:"gohighlevel",label:"GoHighLevel",badge:"G",category:"tool_providers",description:"CRM and marketing automation platform integration.",mode:"eburon_credential",eburonProvider:"gohighlevel",fields:[{key:"apiKey",label:"API Key",type:"password",required:!0,placeholder:"ghl_live_..."}],buildEburonCredentialPayload:({name:e,config:t})=>({provider:"gohighlevel",apiKey:p(t,"apiKey","API Key"),name:e})},{key:"slack",label:"Slack",badge:"S",category:"tool_providers",description:"Send messages and notifications to Slack channels.",mode:"eburon_credential",eburonProvider:"slack.oauth2-authorization",fields:[{key:"authorizationId",label:"Authorization ID",type:"text",required:!0,placeholder:"auth_..."}],buildEburonCredentialPayload:({name:e,config:t})=>({provider:"slack.oauth2-authorization",authorizationId:p(t,"authorizationId","Authorization ID"),name:e})},{key:"google_calendar",label:"Google Calendar",badge:"G",category:"tool_providers",description:"Manage calendar events and schedule appointments.",mode:"eburon_credential",eburonProvider:"google.calendar.oauth2-authorization",fields:[{key:"authorizationId",label:"Authorization ID",type:"text",required:!0,placeholder:"auth_..."}],buildEburonCredentialPayload:({name:e,config:t})=>({provider:"google.calendar.oauth2-authorization",authorizationId:p(t,"authorizationId","Authorization ID"),name:e})},{key:"google_sheets",label:"Google Sheets",badge:"G",category:"tool_providers",description:"Read and write data to Google Sheets spreadsheets.",mode:"eburon_credential",eburonProvider:"google.sheets.oauth2-authorization",fields:[{key:"authorizationId",label:"Authorization ID",type:"text",required:!0,placeholder:"auth_..."}],buildEburonCredentialPayload:({name:e,config:t})=>({provider:"google.sheets.oauth2-authorization",authorizationId:p(t,"authorizationId","Authorization ID"),name:e})},{key:"gohighlevel_mcp",label:"GoHighLevel MCP",badge:"G",category:"tool_providers",description:"Advanced GoHighLevel integration with MCP protocol.",mode:"eburon_credential",eburonProvider:"ghl.oauth2-authorization",fields:[{key:"authenticationSession",label:"Authentication Session (JSON)",type:"json",required:!0,placeholder:'{\n  "accessToken": "...",\n  "refreshToken": "...",\n  "expiresAt": "2026-12-31T00:00:00.000Z"\n}'}],buildEburonCredentialPayload:({name:e,config:t})=>({provider:"ghl.oauth2-authorization",authenticationSession:c(u(t.authenticationSession,"Authentication Session"),"Authentication Session"),name:e})},{key:"trieve",label:"Trieve (Deprecated)",badge:"T",category:"vector_store_providers",description:"Vector search and semantic retrieval for AI applications.",mode:"eburon_credential",eburonProvider:"trieve",deprecated:!0,fields:[{key:"apiKey",label:"API Key",type:"password",required:!0,placeholder:"tr_..."}],buildEburonCredentialPayload:({name:e,config:t})=>({provider:"trieve",apiKey:p(t,"apiKey","API Key"),name:e})},{key:"sip_trunk",label:"SIP Trunk",badge:"S",category:"phone_number_providers",description:"Bring your own SIP trunk or carrier for phone connectivity.",mode:"eburon_credential",eburonProvider:"byo-sip-trunk",fields:[{key:"gateways",label:"Gateways (JSON array)",type:"json",required:!0,placeholder:'[{"ip":"203.0.113.12","port":5060}]'},{key:"outboundAuthenticationPlan",label:"Outbound Authentication Plan (JSON)",type:"json",placeholder:'{ "type": "digest", "username": "...", "password": "..." }'},{key:"outboundLeadingPlusEnabled",label:"Outbound Leading Plus Enabled",type:"boolean",defaultValue:!1},{key:"techPrefix",label:"Tech Prefix",type:"text",placeholder:"9"},{key:"sipDiversionHeader",label:"SIP Diversion Header",type:"text",placeholder:"Diversion"},{key:"sbcConfiguration",label:"SBC Configuration (JSON)",type:"json",placeholder:'{ "host": "sbc.example.com" }'}],buildEburonCredentialPayload:({name:e,config:t})=>{let r={provider:"byo-sip-trunk",gateways:function(e,t){if(!Array.isArray(e))throw f(`${t} must be a JSON array.`);return e}(u(t.gateways,"Gateways"),"Gateways"),name:e};return h(r,"outboundAuthenticationPlan",u(t.outboundAuthenticationPlan,"Outbound Authentication Plan")),h(r,"outboundLeadingPlusEnabled",g(t.outboundLeadingPlusEnabled)),h(r,"techPrefix",b(t.techPrefix)),h(r,"sipDiversionHeader",b(t.sipDiversionHeader)),h(r,"sbcConfiguration",u(t.sbcConfiguration,"SBC Configuration")),r}},{key:"telnyx",label:"Telnyx",badge:"T",category:"phone_number_providers",description:"Global phone numbers with reliable voice infrastructure.",mode:"local_config",fields:[{key:"apiKey",label:"API Key",type:"password",required:!0,placeholder:"KEY..."},{key:"connectionId",label:"Connection ID",type:"text",placeholder:"123456789"},{key:"applicationId",label:"Application ID",type:"text",placeholder:"app_..."}]},{key:"vonage",label:"Vonage",badge:"V",category:"phone_number_providers",description:"International phone numbers and communications API.",mode:"eburon_credential",eburonProvider:"vonage",fields:[{key:"apiKey",label:"API Key",type:"text",required:!0,placeholder:"abcd1234"},{key:"apiSecret",label:"API Secret",type:"password",required:!0,placeholder:"********"}],buildEburonCredentialPayload:({name:e,config:t})=>({provider:"vonage",apiKey:p(t,"apiKey","API Key"),apiSecret:p(t,"apiSecret","API Secret"),name:e})},{key:"aws_s3",label:"AWS S3",badge:"A",category:"cloud_providers",description:"Scalable cloud storage for recordings and artifacts.",mode:"eburon_credential",eburonProvider:"s3",fields:[{key:"awsAccessKeyId",label:"AWS Access Key ID",type:"text",required:!0,placeholder:"AKIA..."},{key:"awsSecretAccessKey",label:"AWS Secret Access Key",type:"password",required:!0,placeholder:"********"},{key:"region",label:"Region",type:"text",required:!0,placeholder:"us-east-1"},{key:"s3BucketName",label:"Bucket Name",type:"text",required:!0,placeholder:"eburon-recordings"},{key:"s3PathPrefix",label:"Path Prefix",type:"text",required:!0,defaultValue:"recordings/"},{key:"fallbackIndex",label:"Fallback Index",type:"number",placeholder:"0"}],buildEburonCredentialPayload:({name:e,config:t})=>{let r={provider:"s3",awsAccessKeyId:p(t,"awsAccessKeyId","AWS Access Key ID"),awsSecretAccessKey:p(t,"awsSecretAccessKey","AWS Secret Access Key"),region:p(t,"region","Region"),s3BucketName:p(t,"s3BucketName","Bucket Name"),s3PathPrefix:p(t,"s3PathPrefix","Path Prefix"),name:e};return h(r,"fallbackIndex",y(t.fallbackIndex)),r}},{key:"aws_s3_sts",label:"AWS S3 (STS)",badge:"A",category:"cloud_providers",description:"Secure S3 storage using IAM role assumption - no static credentials required.",mode:"local_config",fields:[{key:"roleArn",label:"Role ARN",type:"text",required:!0,placeholder:"arn:aws:iam::123456789012:role/VapiUploadRole"},{key:"externalId",label:"External ID",type:"text",placeholder:"optional-external-id"},{key:"region",label:"Region",type:"text",required:!0,placeholder:"us-east-1"},{key:"bucketName",label:"Bucket Name",type:"text",required:!0,placeholder:"eburon-recordings"},{key:"pathPrefix",label:"Path Prefix",type:"text",defaultValue:"recordings/"}]},{key:"azure_blob_storage",label:"Azure Blob Storage",badge:"A",category:"cloud_providers",description:"Enterprise cloud storage by Microsoft Azure.",mode:"eburon_credential",eburonProvider:"azure",fields:[{key:"service",label:"Service",type:"select",required:!0,defaultValue:"blob_storage",options:[{value:"blob_storage",label:"blob_storage"},{value:"speech",label:"speech"}]},{key:"region",label:"Region",type:"select",options:["australia","canadaeast","canadacentral","eastus2","eastus","france","germanywestcentral","india","japaneast","japanwest","northcentralus","norway","polandcentral","southcentralus","spaincentral","swedencentral","switzerland","uaenorth","uk","westeurope","westus","westus3"].map(e=>({value:e,label:e})),placeholder:"Select region"},{key:"apiKey",label:"API Key",type:"password",placeholder:"********"},{key:"bucketPlan",label:"Bucket Plan (JSON)",type:"json",placeholder:'{ "containerName": "vapi-artifacts", "path": "/recordings" }'},{key:"fallbackIndex",label:"Fallback Index",type:"number",placeholder:"0"}],buildEburonCredentialPayload:({name:e,config:t})=>{let r={provider:"azure",service:p(t,"service","Service"),name:e};return h(r,"region",b(t.region)),h(r,"apiKey",b(t.apiKey)),h(r,"bucketPlan",u(t.bucketPlan,"Bucket Plan")),h(r,"fallbackIndex",y(t.fallbackIndex)),r}},{key:"google_cloud_storage",label:"Google Cloud Storage",badge:"G",category:"cloud_providers",description:"Reliable object storage with global edge network.",mode:"eburon_credential",eburonProvider:"gcp",fields:[{key:"gcpKey",label:"GCP Key (JSON)",type:"json",required:!0,placeholder:'{ "type": "service_account", "project_id": "..." }'},{key:"region",label:"Region",type:"text",placeholder:"us-central1"},{key:"bucketPlan",label:"Bucket Plan (JSON)",type:"json",placeholder:'{ "bucketName": "my-bucket", "path": "/recordings" }'},{key:"fallbackIndex",label:"Fallback Index",type:"number",placeholder:"0"}],buildEburonCredentialPayload:({name:e,config:t})=>{let r={provider:"gcp",gcpKey:c(u(t.gcpKey,"GCP Key"),"GCP Key"),name:e};return h(r,"region",b(t.region)),h(r,"bucketPlan",u(t.bucketPlan,"Bucket Plan")),h(r,"fallbackIndex",y(t.fallbackIndex)),r}},{key:"cloudflare_r2",label:"Cloudflare R2",badge:"C",category:"cloud_providers",description:"Zero-egress cloud storage with global distribution.",mode:"eburon_credential",eburonProvider:"cloudflare",fields:[{key:"accountId",label:"Account ID",type:"text",required:!0,placeholder:"f82c..."},{key:"apiKey",label:"API Key",type:"password",required:!0,placeholder:"********"},{key:"accountEmail",label:"Account Email",type:"text",required:!0,placeholder:"ops@example.com"},{key:"bucketPlan",label:"Bucket Plan (JSON)",type:"json",placeholder:'{ "bucketName": "vapi-r2", "path": "/recordings" }'},{key:"fallbackIndex",label:"Fallback Index",type:"number",placeholder:"0"}],buildEburonCredentialPayload:({name:e,config:t})=>{let r={provider:"cloudflare",accountId:p(t,"accountId","Account ID"),apiKey:p(t,"apiKey","API Key"),accountEmail:p(t,"accountEmail","Account Email"),name:e};return h(r,"bucketPlan",u(t.bucketPlan,"Bucket Plan")),h(r,"fallbackIndex",y(t.fallbackIndex)),r}},{key:"supabase",label:"Supabase",badge:"S",category:"cloud_providers",description:"Open-source cloud storage with built-in authentication.",mode:"eburon_credential",eburonProvider:"supabase",fields:[{key:"bucketPlan",label:"Bucket Plan (JSON)",type:"json",placeholder:'{ "bucketName": "crm-assets", "path": "/recordings" }'},{key:"fallbackIndex",label:"Fallback Index",type:"number",placeholder:"0"}],buildEburonCredentialPayload:({name:e,config:t})=>{let r={provider:"supabase",name:e};return h(r,"bucketPlan",u(t.bucketPlan,"Bucket Plan")),h(r,"fallbackIndex",y(t.fallbackIndex)),r}},{key:"langfuse",label:"Langfuse",badge:"L",category:"observability_providers",description:"LLM observability, tracing, and analytics platform.",mode:"eburon_credential",eburonProvider:"langfuse",fields:[{key:"publicKey",label:"Public Key",type:"text",required:!0,placeholder:"pk-lf-..."},{key:"apiKey",label:"Secret Key",type:"password",required:!0,placeholder:"sk-lf-..."},{key:"apiUrl",label:"Host URL",type:"text",required:!0,placeholder:"https://cloud.langfuse.com"}],buildEburonCredentialPayload:({name:e,config:t})=>({provider:"langfuse",publicKey:p(t,"publicKey","Public Key"),apiKey:p(t,"apiKey","Secret Key"),apiUrl:p(t,"apiUrl","Host URL"),name:e})},{key:"server_configuration",label:"Server Configuration",badge:"S",category:"server_configuration",description:"Configure custom server credentials and authentication.",mode:"eburon_credential",eburonProvider:"webhook",fields:[{key:"authenticationPlan",label:"Authentication Plan (JSON)",type:"json",required:!0,placeholder:'{ "type": "bearer", "token": "..." }'}],buildEburonCredentialPayload:({name:e,config:t})=>({provider:"webhook",authenticationPlan:c(u(t.authenticationPlan,"Authentication Plan"),"Authentication Plan"),name:e})}],a=new Map(r.map(e=>[e.key,e]));function o(){return Object.entries(t).map(([e,t])=>{let a=r.filter(t=>t.category===e).map(e=>({key:e.key,label:e.label,badge:e.badge,category:e.category,categoryLabel:t,description:e.description,mode:e.mode,deprecated:!!e.deprecated,eburonProvider:e.eburonProvider,fields:e.fields}));return{key:e,label:t,providers:a}})}function i(e){return a.get(e)}function n(e,t){let r={};for(let i of e.fields){let e=t[i.key];if(null==(a=e)||"string"==typeof a&&0===a.trim().length){void 0!==i.defaultValue&&(r[i.key]=i.defaultValue);continue}switch(i.type){case"text":case"password":case"select":r[i.key]=String(e).trim();break;case"number":{let t=y(e);void 0!==t&&(r[i.key]=t);break}case"boolean":{let t=g(e);void 0!==t&&(r[i.key]=t);break}case"json":{let t=u(e,i.label);void 0!==t&&(r[i.key]=t);break}default:var a,o=i.type;throw f(`Unsupported field type: ${String(o)}`)}}for(let t of e.fields)if(t.required&&void 0===r[t.key])throw f(`${t.label} is required.`);return r}function l(e,t,r){if(!e.buildEburonCredentialPayload)throw f(`${e.label} does not map to an Eburon credential payload.`);let a=t.trim();if(!a)throw f("Integration name is required.");return e.buildEburonCredentialPayload({name:a,config:r})}function d(e){var r,a;let o=i(e.providerKey),n=(r=e.category,a=o?.category,r in t?r:a??"tool_providers"),l=o?.label??e.providerKey,d=o?.description??"Custom integration";return{id:e.id,name:e.name,category:n,categoryLabel:t[n],providerKey:e.providerKey,providerLabel:l,providerBadge:o?.badge??l.charAt(0).toUpperCase(),description:d,mode:e.mode,eburonProvider:e.eburonProvider??o?.eburonProvider??null,upstreamCredentialId:e.upstreamCredentialId??null,status:e.status,deprecated:!!o?.deprecated,config:function(e,t){if("object"!=typeof t||null===t||!e)return null;let r={};for(let a of e.fields){if(!(a.key in t))continue;let e=t[a.key];if("password"===a.type){r[a.key]="********";continue}if("json"===a.type){if(null==e)continue;r[a.key]="[configured]";continue}r[a.key]=e}return r}(o,e.config),createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString()}}function s(e){if("active"===e||"disabled"===e)return e;throw f("status must be 'active' or 'disabled'.")}function u(e,t){if(null!=e){if("string"==typeof e){let r=e.trim();if(!r)return;try{return JSON.parse(r)}catch{throw f(`${t} must be valid JSON.`)}}if("object"==typeof e)return e;throw f(`${t} must be a JSON object or array.`)}}function c(e,t){if("object"!=typeof e||null===e||Array.isArray(e))throw f(`${t} must be a JSON object.`);return e}function p(e,t,r){let a=b(e[t]);if(!a)throw f(`${r} is required.`);return a}function b(e){if("string"!=typeof e)return;let t=e.trim();return t.length>0?t:void 0}function y(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e&&e.trim()){let t=Number(e.trim());if(Number.isFinite(t))return t}}function g(e){if("boolean"==typeof e)return e;if("string"==typeof e){let t=e.trim().toLowerCase();if("true"===t||"1"===t)return!0;if("false"===t||"0"===t)return!1}}function h(e,t,r){void 0!==r&&(e[t]=r)}function f(e){return Object.assign(Error(e),{status:400})}e.s(["buildEburonCredentialPayload",()=>l,"getProviderDefinition",()=>i,"listProviderCategories",()=>o,"normalizeIntegrationConfig",()=>n,"parseIntegrationStatus",()=>s,"serializeIntegrationRecord",()=>d])},80729,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),o=e.i(59756),i=e.i(61916),n=e.i(74677),l=e.i(69741),d=e.i(16795),s=e.i(87718),u=e.i(95169),c=e.i(47587),p=e.i(66012),b=e.i(70101),y=e.i(26937),g=e.i(10372),h=e.i(93695);e.i(52474);var f=e.i(5232),v=e.i(69719),k=e.i(43793),m=e.i(84260),P=e.i(33708),w=e.i(67629);let I=v.z.object({providerKey:v.z.string().trim().min(1),name:v.z.string().trim().min(2).max(120).optional(),config:v.z.record(v.z.string(),v.z.unknown()).optional(),status:v.z.string().optional()});async function A(e){return(0,m.runGatewayOptions)(e)}async function S(e){return(0,m.runGatewayHandler)(e,"settings.integrations.list",async({tenant:e})=>({payload:{integrations:(await k.prisma.integration.findMany({where:{orgId:e.org.id},orderBy:{updatedAt:"desc"}})).map(e=>(0,P.serializeIntegrationRecord)(e))}}))}async function _(e){return(0,m.runGatewayHandler)(e,"settings.integrations.create",async({tenant:t})=>{let r=I.parse(await e.json()),a=(0,P.getProviderDefinition)(r.providerKey);if(!a)throw Object.assign(Error("Unknown provider key."),{status:400});let o=(0,P.normalizeIntegrationConfig)(a,r.config??{}),i=r.name?.trim()||a.label,n=r.status?(0,P.parseIntegrationStatus)(r.status):"active",l=null;if("eburon_credential"===a.mode){let e=P.buildEburonCredentialPayload(a,i,o);if(!(l=function(e){if("object"!=typeof e||null===e)return null;let t=e.id??e.credentialId;if("string"!=typeof t)return null;let r=t.trim();return r.length>0?r:null}(await w.upstream.createCredential(e))))throw Object.assign(Error("Created credential but did not receive an upstream id."),{status:502})}let d=await k.prisma.integration.create({data:{orgId:t.org.id,name:i,category:a.category,providerKey:a.key,mode:a.mode,upstreamCredentialId:l,config:o,status:n}});return{payload:{integration:(0,P.serializeIntegrationRecord)(d)},status:201,resourceId:d.id}})}e.s(["GET",()=>S,"OPTIONS",()=>A,"POST",()=>_,"dynamic",0,"force-dynamic"],98424);var x=e.i(98424);let C=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/ev/settings/integrations/route",pathname:"/api/ev/settings/integrations",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/ev/settings/integrations/route.ts",nextConfigOutput:"",userland:x}),{workAsyncStorage:E,workUnitAsyncStorage:R,serverHooks:K}=C;function N(){return(0,a.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:R})}async function O(e,t,a){C.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/ev/settings/integrations/route";v=v.replace(/\/index$/,"")||"/";let k=await C.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!k)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:m,params:P,nextConfig:w,parsedUrl:I,isDraftMode:A,prerenderManifest:S,routerServerContext:_,isOnDemandRevalidate:x,revalidateOnlyGenerated:E,resolvedPathname:R,clientReferenceManifest:K,serverActionsManifest:N}=k,O=(0,l.normalizeAppPath)(v),q=!!(S.dynamicRoutes[O]||S.routes[R]),z=async()=>((null==_?void 0:_.render404)?await _.render404(e,t,I,!1):t.end("This page could not be found"),null);if(q&&!A){let e=!!S.routes[R],t=S.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await z();throw new h.NoFallbackError}}let T=null;!q||C.isDev||A||(T="/index"===(T=R)?"/":T);let D=!0===C.isDev||!q,j=q&&!D;N&&K&&(0,n.setManifestsSingleton)({page:v,clientReferenceManifest:K,serverActionsManifest:N});let H=e.method||"GET",G=(0,i.getTracer)(),B=G.getActiveScopeSpan(),U={params:P,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,o)=>C.onRequestError(e,t,a,o,_)},sharedContext:{buildId:m}},M=new d.NodeNextRequest(e),L=new d.NodeNextResponse(t),$=s.NextRequestAdapter.fromNodeNextRequest(M,(0,s.signalFromNodeResponse)(t));try{let n=async e=>C.handle($,U).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=G.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${H} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${v}`)}),l=!!(0,o.getRequestMeta)(e,"minimalMode"),d=async o=>{var i,d;let s=async({previousCacheEntry:r})=>{try{if(!l&&x&&E&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await n(o);e.fetchMetrics=U.renderOpts.fetchMetrics;let d=U.renderOpts.pendingWaitUntil;d&&a.waitUntil&&(a.waitUntil(d),d=void 0);let s=U.renderOpts.collectedTags;if(!q)return await (0,p.sendResponse)(M,L,i,U.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,b.toNodeOutgoingHttpHeaders)(i.headers);s&&(t[g.NEXT_CACHE_TAGS_HEADER]=s),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==U.renderOpts.collectedRevalidate&&!(U.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&U.renderOpts.collectedRevalidate,a=void 0===U.renderOpts.collectedExpire||U.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:U.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:x})},!1,_),t}},u=await C.handleResponse({req:e,nextConfig:w,cacheKey:T,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:x,revalidateOnlyGenerated:E,responseGenerator:s,waitUntil:a.waitUntil,isMinimalMode:l});if(!q)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",x?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,b.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&q||h.delete(g.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,y.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(M,L,new Response(u.value.body,{headers:h,status:u.value.status||200})),null};B?await d(B):await G.withPropagatedContext(e.headers,()=>G.trace(u.BaseServerSpan.handleRequest,{spanName:`${H} ${v}`,kind:i.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},d))}catch(t){if(t instanceof h.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:x})},!1,_),q)throw t;return await (0,p.sendResponse)(M,L,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>N,"routeModule",()=>C,"serverHooks",()=>K,"workAsyncStorage",()=>E,"workUnitAsyncStorage",()=>R],80729)}];

//# sourceMappingURL=_e2a2767c._.js.map