module.exports=[75110,a=>{"use strict";async function b(a,b){let c=await fetch(a,{...b,headers:{"Content-Type":"application/json",...b?.headers??{}}}),d=await c.text(),e=d?function(a){try{return JSON.parse(a)}catch{return a}}(d):null;if(!c.ok){let a="object"==typeof e&&e&&"error"in e?String(e.error):`Request failed (${c.status})`,b=function(a){if("string"==typeof a&&a.trim().length>0)return a.trim();if(Array.isArray(a)){let b=a.find(a=>"string"==typeof a&&a.trim().length>0);if(b)return b.trim()}if("object"!=typeof a||null===a)return null;let b=a.message;if("string"==typeof b&&b.trim().length>0)return b.trim();if(Array.isArray(b)){let a=b.find(a=>"string"==typeof a&&a.trim().length>0);if(a)return a.trim()}return null}("object"==typeof e&&e&&"details"in e?e.details:void 0);throw Error(b?`${a}: ${b}`:a)}return e}a.s(["apiRequest",()=>b])},51846,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(75110);let e=["Identity","Behavior","Voice"];function f(){let[f,g]=(0,c.useState)(0),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)("Fill all required fields to unlock preview."),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)("idle"),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)({name:"",intro:"",firstMessageMode:"assistant-speaks-first",systemPrompt:"",voiceId:""}),B=(0,c.useRef)(null),C=(0,c.useRef)(null);(0,c.useEffect)(()=>{let a=!0;return(0,d.apiRequest)("/api/ev/voice/voices").then(b=>{a&&(i(b.voices),A(a=>({...a,voiceId:a.voiceId||b.voices[0]?.id||""})))}).catch(b=>{a&&m(b.message)}),()=>{a=!1,C.current&&clearTimeout(C.current),B.current?.stop()}},[]);let D=(0,c.useMemo)(()=>{let a=[];return(z.name.trim().length<2||z.name.trim().length>80)&&a.push("Agent Name must be 2-80 characters."),(z.intro.trim().length<4||z.intro.trim().length>500)&&a.push("Intro / First Message must be 4-500 characters."),(z.systemPrompt.trim().length<20||z.systemPrompt.trim().length>5e3)&&a.push("Skills and Description must be 20-5000 characters."),a},[z]),E=0===D.length;async function F(){if(!E)throw Error("Complete all required fields before saving.");if(!j){let a=await (0,d.apiRequest)("/api/ev/voice/agents",{method:"POST",body:JSON.stringify({...z,status:"draft",autoCreateRemote:!0})});return k(a.agent.id),a.agent.id}return await (0,d.apiRequest)(`/api/ev/voice/agents/${j}`,{method:"PATCH",body:JSON.stringify(z)}),j}async function G(){o(!0);try{let a=await F();m(`Draft saved (${a.slice(0,8)}...).`)}catch(a){m(a.message)}finally{o(!1)}}async function H(a){C.current&&(clearTimeout(C.current),C.current=null),B.current?.stop(),B.current=null,s(!1),u("ended"),v&&await (0,d.apiRequest)(`/api/ev/voice/preview-sessions/${v}`,{method:"PATCH",body:JSON.stringify({status:a,transcript:x,ended:!0})}).catch(()=>{})}async function I(){if(!E)return void m(D[0]??"Complete all required fields first.");s(!0),u("connecting"),m("Starting preview...");try{let b=await F(),c=await (0,d.apiRequest)(`/api/ev/voice/session-config?agentId=${b}`);w(c.previewSessionId),y([]);let e=new(await a.A(40892)).default(c.publicKey);e.on("call-start",()=>{u("live"),m("Preview call is live.")}),e.on("call-end",()=>{H("ended")}),e.on("message",a=>{let b=function(a){if(!a||"object"!=typeof a)return null;let b="string"==typeof a.type?a.type:"",c="string"==typeof a.transcript&&a.transcript||"string"==typeof a.text&&a.text||"string"==typeof a.message&&a.message||"string"==typeof a.content&&a.content;return c&&(b.includes("transcript")||"message"===b)?{role:"assistant"===a.role||"assistant"===a.source||"assistant"===a.speaker?"agent":"user",text:c,at:new Date().toISOString()}:null}(a);b&&y(a=>[...a.slice(-99),b])}),e.on("error",a=>{u("error"),m(`Preview error: ${String(a)}`)}),B.current=e,await e.start(c.assistantId),C.current=setTimeout(()=>{H("timeout")},1e3*c.timeoutSeconds)}catch(a){u("error"),s(!1),m(a.message)}}async function J(){await H("stopped"),m("Preview stopped.")}async function K(){q(!0);try{let a=await F();await (0,d.apiRequest)(`/api/ev/voice/agents/${a}/deploy`,{method:"POST"}),m("Agent is live and attached to dashboard routing.")}catch(a){m(a.message)}finally{q(!1)}}return(0,b.jsxs)("div",{className:"split",children:[(0,b.jsxs)("section",{className:"card",children:[(0,b.jsx)("div",{className:"stepTabs",children:e.map((a,c)=>(0,b.jsxs)("button",{type:"button",className:`stepTab ${f===c?"active":""}`,onClick:()=>g(c),children:[c+1,". ",a]},a))}),0===f&&(0,b.jsxs)("div",{className:"fieldGrid",children:[(0,b.jsxs)("label",{children:["Agent Name",(0,b.jsx)("input",{value:z.name,maxLength:80,onChange:a=>A(b=>({...b,name:a.target.value})),placeholder:"Weekend Support Desk"})]}),(0,b.jsxs)("label",{children:["Intro / First Message",(0,b.jsx)("textarea",{rows:4,value:z.intro,maxLength:500,onChange:a=>A(b=>({...b,intro:a.target.value})),placeholder:"Hi, you reached Eburon Voice support. How can I help you today?"})]}),(0,b.jsxs)("label",{children:["Conversation Start",(0,b.jsxs)("select",{value:z.firstMessageMode,onChange:a=>A(b=>({...b,firstMessageMode:a.target.value})),children:[(0,b.jsx)("option",{value:"assistant-speaks-first",children:"Agent speaks first"}),(0,b.jsx)("option",{value:"assistant-waits-for-user",children:"User speaks first"})]})]})]}),1===f&&(0,b.jsx)("div",{className:"fieldGrid",children:(0,b.jsxs)("label",{children:["Skills and Description",(0,b.jsx)("textarea",{rows:10,value:z.systemPrompt,maxLength:5e3,onChange:a=>A(b=>({...b,systemPrompt:a.target.value})),placeholder:"You are a CSR assistant for Eburon Voice. Keep responses concise, polite, and actionable."})]})}),2===f&&(0,b.jsxs)("div",{className:"fieldGrid",children:[(0,b.jsxs)("label",{children:["Voice",(0,b.jsxs)("select",{value:z.voiceId,onChange:a=>A(b=>({...b,voiceId:a.target.value})),children:[!h.length&&(0,b.jsx)("option",{value:"",children:"Default voice"}),h.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.label," (",a.locale,")"]},a.id))]})]}),(0,b.jsx)("p",{className:"muted",children:"Only approved voices are shown. If none is selected, a default voice is auto-assigned."})]}),(0,b.jsxs)("div",{className:"inlineActions templateMarginTopLarge",children:[(0,b.jsx)("button",{type:"button",className:"secondary",onClick:G,disabled:n||!E,children:n?"Saving...":"Save Draft"}),(0,b.jsx)("button",{type:"button",className:"warn",onClick:I,disabled:!E||r,children:r?"Connecting...":"Preview"}),(0,b.jsx)("button",{type:"button",onClick:K,disabled:!E||p,children:p?"Deploying...":"Deploy"})]}),(0,b.jsxs)("p",{className:"muted templateMarginTopMedium",children:["Readiness: ",E?"Ready for preview":D[0]]})]}),(0,b.jsxs)("section",{className:"phoneMock",children:[(0,b.jsxs)("div",{className:"phoneState",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"kicker",children:"Preview Dialer"}),(0,b.jsx)("h3",{className:"templateMarginTopSmall",children:"Web Call Test"})]}),(0,b.jsx)("span",{className:`badge ${"live"===t?"live":"idle"}`,children:t})]}),(0,b.jsx)("div",{className:"inlineActions templateMarginBottomMedium",children:(0,b.jsx)("button",{type:"button",className:"ghost",onClick:J,disabled:!r&&"live"!==t,children:"Stop"})}),(0,b.jsx)("div",{className:"transcriptList",children:0===x.length?(0,b.jsx)("p",{className:"muted",children:"Transcript will appear here during the call."}):x.map((a,c)=>(0,b.jsxs)("div",{className:`transcriptItem ${"user"===a.role?"me":""}`,children:[(0,b.jsxs)("strong",{children:["agent"===a.role?"Agent":"User",":"]})," ",a.text]},`${a.at}-${c}`))}),(0,b.jsx)("p",{className:"muted templateMarginTopMedium",children:l})]})]})}a.s(["AgentBuilder",()=>f])},40892,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[root-of-the-server]__33f51609._.js"].map(b=>a.l(b))).then(()=>b(96226)))}];

//# sourceMappingURL=_4b22056d._.js.map