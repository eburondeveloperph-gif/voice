{"version":3,"sources":["../../../../src/lib/client/api.ts","../../../../src/app/dialer/page.tsx"],"sourcesContent":["export async function apiRequest<T>(url: string, init?: RequestInit): Promise<T> {\n  const response = await fetch(url, {\n    ...init,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...(init?.headers ?? {}),\n    },\n  });\n\n  const text = await response.text();\n  const payload = text ? safeJsonParse(text) : null;\n\n  if (!response.ok) {\n    const errorMessage =\n      typeof payload === \"object\" && payload && \"error\" in payload\n        ? String((payload as { error: string }).error)\n        : `Request failed (${response.status})`;\n    const details =\n      typeof payload === \"object\" && payload && \"details\" in payload\n        ? (payload as { details?: unknown }).details\n        : undefined;\n    const detailsMessage = getErrorDetailsMessage(details);\n    throw new Error(detailsMessage ? `${errorMessage}: ${detailsMessage}` : errorMessage);\n  }\n\n  return payload as T;\n}\n\nfunction safeJsonParse(text: string): unknown {\n  try {\n    return JSON.parse(text) as unknown;\n  } catch {\n    return text;\n  }\n}\n\nfunction getErrorDetailsMessage(details: unknown): string | null {\n  if (typeof details === \"string\" && details.trim().length > 0) {\n    return details.trim();\n  }\n\n  if (Array.isArray(details)) {\n    const firstString = details.find(\n      (item): item is string => typeof item === \"string\" && item.trim().length > 0,\n    );\n    if (firstString) {\n      return firstString.trim();\n    }\n  }\n\n  if (typeof details !== \"object\" || details === null) {\n    return null;\n  }\n\n  const message = (details as { message?: unknown }).message;\n  if (typeof message === \"string\" && message.trim().length > 0) {\n    return message.trim();\n  }\n\n  if (Array.isArray(message)) {\n    const firstString = message.find(\n      (item): item is string => typeof item === \"string\" && item.trim().length > 0,\n    );\n    if (firstString) {\n      return firstString.trim();\n    }\n  }\n\n  return null;\n}\n","\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { apiRequest } from \"@/lib/client/api\";\nimport \"./dialer.css\";\n\ntype Agent = {\n    id: string;\n    name: string;\n};\n\ntype PhoneNumber = {\n    id: string;\n    displayNumber: string;\n};\n\nexport default function DialerPage() {\n    const [agents, setAgents] = useState<Agent[]>([]);\n    const [numbers, setNumbers] = useState<PhoneNumber[]>([]);\n    const [loading, setLoading] = useState(true);\n\n    const [targetNumber, setTargetNumber] = useState(\"\");\n    const [selectedAgent, setSelectedAgent] = useState(\"\");\n    const [selectedNumber, setSelectedNumber] = useState(\"\");\n    const [isCalling, setIsCalling] = useState(false);\n    const [status, setStatus] = useState<string | null>(null);\n\n    useEffect(() => {\n        async function loadData() {\n            try {\n                const [agentsRes, numbersRes] = await Promise.all([\n                    apiRequest<{ agents: Agent[] }>(\"/api/ev/voice/agents\"),\n                    apiRequest<{ numbers: PhoneNumber[] }>(\"/api/ev/voice/phone-numbers\")\n                ]);\n                setAgents(agentsRes.agents);\n                setNumbers(numbersRes.numbers);\n                if (agentsRes.agents.length > 0) setSelectedAgent(agentsRes.agents[0].id);\n                if (numbersRes.numbers.length > 0) setSelectedNumber(numbersRes.numbers[0].id);\n            } catch {\n                setStatus(\"Error loading configuration data.\");\n            } finally {\n                setLoading(false);\n            }\n        }\n        loadData();\n    }, []);\n\n    const handleStartCall = async () => {\n        if (!targetNumber || !selectedAgent || !selectedNumber) {\n            setStatus(\"Please fill in all fields.\");\n            return;\n        }\n\n        setIsCalling(true);\n        setStatus(\"Initiating outbound call...\");\n\n        try {\n            const res = await apiRequest<{ success: boolean; callId: string }>(\"/api/ev/voice/calls/outbound\", {\n                method: \"POST\",\n                body: JSON.stringify({\n                    assistantId: selectedAgent,\n                    phoneNumberId: selectedNumber,\n                    customerNumber: targetNumber\n                })\n            });\n\n            if (res.success) {\n                setStatus(`Call successfully initiated! ID: ${res.callId}`);\n                setTargetNumber(\"\");\n            }\n        } catch (error: unknown) {\n            const message = error instanceof Error ? error.message : \"Unknown error\";\n            setStatus(`Call failed: ${message}`);\n        } finally {\n            setIsCalling(false);\n        }\n    };\n\n    if (loading) return <div className=\"dialerPage\"><p className=\"muted\">Loading dialer...</p></div>;\n\n    return (\n        <div className=\"dialerPage\">\n            <header className=\"pageHead\">\n                <div>\n                    <h1 className=\"pageTitle\">Outbound Dialer</h1>\n                    <p className=\"pageSubtitle\">Manually initiate phone calls with your voice agents.</p>\n                </div>\n            </header>\n\n            <div className=\"dialerCard card\">\n                <div className=\"fieldGrid\">\n                    <label>\n                        Destination Number\n                        <input\n                            type=\"tel\"\n                            placeholder=\"+14150000000\"\n                            value={targetNumber}\n                            onChange={(e) => setTargetNumber(e.target.value)}\n                            disabled={isCalling}\n                        />\n                    </label>\n\n                    <label>\n                        Select Agent\n                        <select\n                            value={selectedAgent}\n                            onChange={(e) => setSelectedAgent(e.target.value)}\n                            disabled={isCalling}\n                        >\n                            {agents.map(a => <option key={a.id} value={a.id}>{a.name}</option>)}\n                        </select>\n                    </label>\n\n                    <label>\n                        From Number\n                        <select\n                            value={selectedNumber}\n                            onChange={(e) => setSelectedNumber(e.target.value)}\n                            disabled={isCalling}\n                        >\n                            {numbers.map(n => <option key={n.id} value={n.id}>{n.displayNumber}</option>)}\n                        </select>\n                    </label>\n\n                    <button\n                        type=\"button\"\n                        className=\"playBtn dialerBtn\"\n                        onClick={handleStartCall}\n                        disabled={isCalling || numbers.length === 0}\n                    >\n                        {isCalling ? '‚åõ Dialing...' : 'üìû Start Call Now'}\n                    </button>\n\n                    {status && (\n                        <div className={`statusBanner ${status.includes('failed') || status.includes('Error') ? 'error' : 'success'}`}>\n                            {status}\n                        </div>\n                    )}\n                </div>\n            </div>\n\n            {numbers.length === 0 && (\n                <div className=\"warningBox\">\n                    <p>‚ö†Ô∏è No phone numbers available. Please purchase a number in the Numbers tab first.</p>\n                </div>\n            )}\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}