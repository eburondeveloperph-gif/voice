{"version":3,"sources":["../../../../src/lib/client/api.ts","../../../../src/app/crm/page.tsx"],"sourcesContent":["export async function apiRequest<T>(url: string, init?: RequestInit): Promise<T> {\n  const response = await fetch(url, {\n    ...init,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...(init?.headers ?? {}),\n    },\n  });\n\n  const text = await response.text();\n  const payload = text ? safeJsonParse(text) : null;\n\n  if (!response.ok) {\n    const errorMessage =\n      typeof payload === \"object\" && payload && \"error\" in payload\n        ? String((payload as { error: string }).error)\n        : `Request failed (${response.status})`;\n    const details =\n      typeof payload === \"object\" && payload && \"details\" in payload\n        ? (payload as { details?: unknown }).details\n        : undefined;\n    const detailsMessage = getErrorDetailsMessage(details);\n    throw new Error(detailsMessage ? `${errorMessage}: ${detailsMessage}` : errorMessage);\n  }\n\n  return payload as T;\n}\n\nfunction safeJsonParse(text: string): unknown {\n  try {\n    return JSON.parse(text) as unknown;\n  } catch {\n    return text;\n  }\n}\n\nfunction getErrorDetailsMessage(details: unknown): string | null {\n  if (typeof details === \"string\" && details.trim().length > 0) {\n    return details.trim();\n  }\n\n  if (Array.isArray(details)) {\n    const firstString = details.find(\n      (item): item is string => typeof item === \"string\" && item.trim().length > 0,\n    );\n    if (firstString) {\n      return firstString.trim();\n    }\n  }\n\n  if (typeof details !== \"object\" || details === null) {\n    return null;\n  }\n\n  const message = (details as { message?: unknown }).message;\n  if (typeof message === \"string\" && message.trim().length > 0) {\n    return message.trim();\n  }\n\n  if (Array.isArray(message)) {\n    const firstString = message.find(\n      (item): item is string => typeof item === \"string\" && item.trim().length > 0,\n    );\n    if (firstString) {\n      return firstString.trim();\n    }\n  }\n\n  return null;\n}\n","\"use client\";\n\nimport { useEffect, useState } from \"react\";\n\nimport { apiRequest } from \"@/lib/client/api\";\n\ntype CrmProject = {\n  id: string;\n  name: string;\n  slug: string;\n  description: string | null;\n  customDomain: string | null;\n  allowedEmails: string[];\n  logoUrl: string | null;\n  isActive: boolean;\n  portalUrl: string;\n  leadCount: number;\n  fileCount: number;\n  createdAt: string;\n  updatedAt: string;\n};\n\ntype CrmProjectsResponse = {\n  projects: CrmProject[];\n};\n\nexport default function CrmProjectsPage() {\n  const [projects, setProjects] = useState<CrmProject[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  async function loadProjects() {\n    setLoading(true);\n    setError(null);\n    try {\n      const payload = await apiRequest<CrmProjectsResponse>(\"/api/ev/crm/projects\");\n      setProjects(payload.projects);\n    } catch (e) {\n      setError((e as Error).message);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  useEffect(() => {\n    void loadProjects();\n  }, []);\n\n  return (\n    <div>\n      <header className=\"pageHead\">\n        <div>\n          <h1 className=\"pageTitle\">Client CRM Portals</h1>\n          <p className=\"pageSubtitle\">\n            CRM portals are auto-generated during user registration from company details.\n          </p>\n        </div>\n      </header>\n\n      <section className=\"card\" style={{ marginBottom: 14 }}>\n        <div className=\"inlineActions\">\n          <button type=\"button\" className=\"secondary\" onClick={() => void loadProjects()} disabled={loading}>\n            {loading ? \"Loading...\" : \"Refresh\"}\n          </button>\n        </div>\n        <p className=\"muted\" style={{ marginTop: 10 }}>\n          New client CRM portals are automatically provisioned when users register with company details.\n        </p>\n        {error ? <p className=\"muted\">{error}</p> : null}\n      </section>\n\n      <section className=\"card\">\n        <h3 style={{ marginBottom: 12 }}>Active Portals</h3>\n        {loading ? (\n          <p className=\"muted\">Loading projects...</p>\n        ) : (\n          <div className=\"tableWrap\">\n            <table>\n              <thead>\n                <tr>\n                  <th>Name</th>\n                  <th>Slug</th>\n                  <th>Portal</th>\n                  <th>Custom Domain</th>\n                  <th>Leads</th>\n                  <th>Files</th>\n                  <th>Updated</th>\n                </tr>\n              </thead>\n              <tbody>\n                {projects.map((project) => (\n                  <tr key={project.id}>\n                    <td>{project.name}</td>\n                    <td>{project.slug}</td>\n                    <td>\n                      <a href={project.portalUrl} target=\"_blank\" rel=\"noreferrer\">\n                        Open Portal\n                      </a>\n                    </td>\n                    <td>{project.customDomain ?? \"-\"}</td>\n                    <td>{project.leadCount}</td>\n                    <td>{project.fileCount}</td>\n                    <td>{new Date(project.updatedAt).toLocaleString()}</td>\n                  </tr>\n                ))}\n                {!projects.length && (\n                  <tr>\n                    <td colSpan={7} className=\"muted\">\n                      No CRM projects yet.\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        )}\n      </section>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}