{"version":3,"sources":["../../../../src/lib/client/api.ts","../../../../src/app/calls/bulk/page.tsx"],"sourcesContent":["export async function apiRequest<T>(url: string, init?: RequestInit): Promise<T> {\n  const response = await fetch(url, {\n    ...init,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...(init?.headers ?? {}),\n    },\n  });\n\n  const text = await response.text();\n  const payload = text ? safeJsonParse(text) : null;\n\n  if (!response.ok) {\n    const errorMessage =\n      typeof payload === \"object\" && payload && \"error\" in payload\n        ? String((payload as { error: string }).error)\n        : `Request failed (${response.status})`;\n    const details =\n      typeof payload === \"object\" && payload && \"details\" in payload\n        ? (payload as { details?: unknown }).details\n        : undefined;\n    const detailsMessage = getErrorDetailsMessage(details);\n    throw new Error(detailsMessage ? `${errorMessage}: ${detailsMessage}` : errorMessage);\n  }\n\n  return payload as T;\n}\n\nfunction safeJsonParse(text: string): unknown {\n  try {\n    return JSON.parse(text) as unknown;\n  } catch {\n    return text;\n  }\n}\n\nfunction getErrorDetailsMessage(details: unknown): string | null {\n  if (typeof details === \"string\" && details.trim().length > 0) {\n    return details.trim();\n  }\n\n  if (Array.isArray(details)) {\n    const firstString = details.find(\n      (item): item is string => typeof item === \"string\" && item.trim().length > 0,\n    );\n    if (firstString) {\n      return firstString.trim();\n    }\n  }\n\n  if (typeof details !== \"object\" || details === null) {\n    return null;\n  }\n\n  const message = (details as { message?: unknown }).message;\n  if (typeof message === \"string\" && message.trim().length > 0) {\n    return message.trim();\n  }\n\n  if (Array.isArray(message)) {\n    const firstString = message.find(\n      (item): item is string => typeof item === \"string\" && item.trim().length > 0,\n    );\n    if (firstString) {\n      return firstString.trim();\n    }\n  }\n\n  return null;\n}\n","\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { apiRequest } from \"@/lib/client/api\";\nimport \"./bulk.css\";\n\ntype Agent = { id: string; name: string };\ntype PhoneNumber = { id: string; displayNumber: string };\n\ninterface BulkJob {\n    number: string;\n    name?: string;\n    assistantId?: string;\n}\n\nexport default function BulkCallsPage() {\n    const [agents, setAgents] = useState<Agent[]>([]);\n    const [numbers, setNumbers] = useState<PhoneNumber[]>([]);\n    const [jobs, setJobs] = useState<BulkJob[]>([]);\n    const [selectedAgent, setSelectedAgent] = useState(\"\");\n    const [selectedNumber, setSelectedNumber] = useState(\"\");\n    const [isProcessing, setIsProcessing] = useState(false);\n    const [status, setStatus] = useState<string | null>(null);\n\n    useEffect(() => {\n        async function load() {\n            const [a, n] = await Promise.all([\n                apiRequest<{ agents: Agent[] }>(\"/api/ev/voice/agents\"),\n                apiRequest<{ numbers: PhoneNumber[] }>(\"/api/ev/voice/phone-numbers\")\n            ]);\n            setAgents(a.agents);\n            setNumbers(n.numbers);\n            if (a.agents.length > 0) setSelectedAgent(a.agents[0].id);\n            if (n.numbers.length > 0) setSelectedNumber(n.numbers[0].id);\n        }\n        load();\n    }, []);\n\n    const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n        const file = e.target.files?.[0];\n        if (!file) return;\n\n        const reader = new FileReader();\n        reader.onload = (event) => {\n            const text = event.target?.result as string;\n\n            // Basic CSV parser\n            const lines = text.split(\"\\n\").filter(l => l.trim());\n            const parsedJobs: BulkJob[] = lines.slice(1).map(line => {\n                const [number, name, assistantId] = line.split(\",\").map(s => s.trim());\n                return { number, name, assistantId };\n            }).filter(j => j.number);\n\n            setJobs(parsedJobs);\n            setStatus(`Detected ${parsedJobs.length} calls to make.`);\n        };\n        reader.readAsText(file);\n    };\n\n    const startBulkCampaign = async () => {\n        if (jobs.length === 0) {\n            setStatus(\"No jobs to process.\");\n            return;\n        }\n\n        setIsProcessing(true);\n        setStatus(\"Starting bulk campaign...\");\n\n        try {\n            const res = await apiRequest<{ success: boolean; results: unknown[] }>(\"/api/ev/voice/calls/bulk\", {\n                method: \"POST\",\n                body: JSON.stringify({\n                    phoneNumberId: selectedNumber,\n                    defaultAssistantId: selectedAgent,\n                    jobs: jobs\n                })\n            });\n\n            if (res.success) {\n                setStatus(`Bulk campaign completed! Processed ${res.results.length} calls.`);\n                setJobs([]);\n            }\n        } catch {\n            setStatus(`Campaign error: Unknown error`);\n        } finally {\n            setIsProcessing(false);\n        }\n    };\n\n    return (\n        <div className=\"bulkPage\">\n            <header className=\"pageHead\">\n                <div>\n                    <h1 className=\"pageTitle\">Bulk Calls</h1>\n                    <p className=\"pageSubtitle\">Upload spreadsheets to initiate mass outbound voice campaigns.</p>\n                </div>\n            </header>\n\n            <div className=\"card bulkCard\">\n                <div className=\"fieldGrid\">\n                    <label>\n                        1. Select Default Agent\n                        <select value={selectedAgent} onChange={(e) => setSelectedAgent(e.target.value)}>\n                            {agents.map(a => <option key={a.id} value={a.id}>{a.name}</option>)}\n                        </select>\n                    </label>\n\n                    <label>\n                        2. Select Outbound Line\n                        <select value={selectedNumber} onChange={(e) => setSelectedNumber(e.target.value)}>\n                            {numbers.map(n => <option key={n.id} value={n.id}>{n.displayNumber}</option>)}\n                        </select>\n                    </label>\n\n                    <label className=\"uploadZone\">\n                        3. Upload CSV File\n                        <input type=\"file\" accept=\".csv\" onChange={handleFileUpload} disabled={isProcessing} />\n                        <div className=\"uploadHint\">\n                            Header format: <code>number, name, assistantId</code>\n                        </div>\n                    </label>\n\n                    {jobs.length > 0 && (\n                        <div className=\"previewTable tableWrap\">\n                            <table>\n                                <thead>\n                                    <tr>\n                                        <th>Number</th>\n                                        <th>Name</th>\n                                        <th>Assistant Override</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    {jobs.slice(0, 5).map((j, i) => (\n                                        <tr key={i}>\n                                            <td>{j.number}</td>\n                                            <td>{j.name || \"-\"}</td>\n                                            <td>{j.assistantId || \"Default\"}</td>\n                                        </tr>\n                                    ))}\n                                </tbody>\n                            </table>\n                            {jobs.length > 5 && <p className=\"muted\">... and {jobs.length - 5} more</p>}\n                        </div>\n                    )}\n\n                    <button\n                        type=\"button\"\n                        className=\"playBtn bulkBtn\"\n                        onClick={startBulkCampaign}\n                        disabled={isProcessing || jobs.length === 0}\n                    >\n                        {isProcessing ? 'âŒ› Processing Bulk Jobs...' : `ðŸš€ Start ${jobs.length} Calls`}\n                    </button>\n\n                    {status && <div className=\"statusBanner success\">{status}</div>}\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}