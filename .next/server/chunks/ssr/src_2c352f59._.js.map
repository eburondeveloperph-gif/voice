{"version":3,"sources":["../../../../src/lib/client/api.ts","../../../../src/app/contacts/page.tsx"],"sourcesContent":["export async function apiRequest<T>(url: string, init?: RequestInit): Promise<T> {\n  const response = await fetch(url, {\n    ...init,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...(init?.headers ?? {}),\n    },\n  });\n\n  const text = await response.text();\n  const payload = text ? safeJsonParse(text) : null;\n\n  if (!response.ok) {\n    const errorMessage =\n      typeof payload === \"object\" && payload && \"error\" in payload\n        ? String((payload as { error: string }).error)\n        : `Request failed (${response.status})`;\n    const details =\n      typeof payload === \"object\" && payload && \"details\" in payload\n        ? (payload as { details?: unknown }).details\n        : undefined;\n    const detailsMessage = getErrorDetailsMessage(details);\n    throw new Error(detailsMessage ? `${errorMessage}: ${detailsMessage}` : errorMessage);\n  }\n\n  return payload as T;\n}\n\nfunction safeJsonParse(text: string): unknown {\n  try {\n    return JSON.parse(text) as unknown;\n  } catch {\n    return text;\n  }\n}\n\nfunction getErrorDetailsMessage(details: unknown): string | null {\n  if (typeof details === \"string\" && details.trim().length > 0) {\n    return details.trim();\n  }\n\n  if (Array.isArray(details)) {\n    const firstString = details.find(\n      (item): item is string => typeof item === \"string\" && item.trim().length > 0,\n    );\n    if (firstString) {\n      return firstString.trim();\n    }\n  }\n\n  if (typeof details !== \"object\" || details === null) {\n    return null;\n  }\n\n  const message = (details as { message?: unknown }).message;\n  if (typeof message === \"string\" && message.trim().length > 0) {\n    return message.trim();\n  }\n\n  if (Array.isArray(message)) {\n    const firstString = message.find(\n      (item): item is string => typeof item === \"string\" && item.trim().length > 0,\n    );\n    if (firstString) {\n      return firstString.trim();\n    }\n  }\n\n  return null;\n}\n","\"use client\";\n\nimport { useEffect, useState } from \"react\";\n\nimport { apiRequest } from \"@/lib/client/api\";\n\ntype Contact = {\n  id: string;\n  fullName: string;\n  phoneNumber: string;\n  email: string | null;\n  tags: string | null;\n};\n\nexport default function ContactsPage() {\n  const [contacts, setContacts] = useState<Contact[]>([]);\n  const [query, setQuery] = useState(\"\");\n  const [form, setForm] = useState({\n    fullName: \"\",\n    phoneNumber: \"\",\n    email: \"\",\n  });\n\n  async function load() {\n    const payload = await apiRequest<{ contacts: Contact[] }>(`/api/ev/contacts?q=${encodeURIComponent(query)}`);\n    setContacts(payload.contacts);\n  }\n\n  useEffect(() => {\n    let active = true;\n    apiRequest<{ contacts: Contact[] }>(`/api/ev/contacts?q=${encodeURIComponent(\"\")}`).then((payload) => {\n      if (active) {\n        setContacts(payload.contacts);\n      }\n    });\n    return () => {\n      active = false;\n    };\n  }, []);\n\n  async function addContact() {\n    await apiRequest<{ contact: Contact }>(\"/api/ev/contacts\", {\n      method: \"POST\",\n      body: JSON.stringify({\n        ...form,\n        tags: [\"imported\"],\n      }),\n    });\n    setForm({ fullName: \"\", phoneNumber: \"\", email: \"\" });\n    await load();\n  }\n\n  return (\n    <div>\n      <header className=\"pageHead\">\n        <div>\n          <h1 className=\"pageTitle\">Contacts</h1>\n          <p className=\"pageSubtitle\">Upload, dedupe, tag, and search customer contacts.</p>\n        </div>\n      </header>\n\n      <section className=\"card\" style={{ marginBottom: 12 }}>\n        <div className=\"fieldGrid\">\n          <label>\n            Name\n            <input value={form.fullName} onChange={(e) => setForm((s) => ({ ...s, fullName: e.target.value }))} />\n          </label>\n          <label>\n            Phone Number\n            <input value={form.phoneNumber} onChange={(e) => setForm((s) => ({ ...s, phoneNumber: e.target.value }))} />\n          </label>\n          <label>\n            Email\n            <input value={form.email} onChange={(e) => setForm((s) => ({ ...s, email: e.target.value }))} />\n          </label>\n          <div className=\"inlineActions\">\n            <button type=\"button\" onClick={() => void addContact()}>\n              Add Contact\n            </button>\n          </div>\n        </div>\n      </section>\n\n      <section className=\"card\" style={{ marginBottom: 12 }}>\n        <div className=\"inlineActions\">\n          <input\n            value={query}\n            onChange={(e) => setQuery(e.target.value)}\n            placeholder=\"Search contacts\"\n            style={{ maxWidth: 320 }}\n          />\n          <button type=\"button\" className=\"secondary\" onClick={() => void load()}>\n            Search\n          </button>\n        </div>\n      </section>\n\n      <section className=\"card\">\n        <div className=\"tableWrap\">\n          <table>\n            <thead>\n              <tr>\n                <th>Name</th>\n                <th>Phone</th>\n                <th>Email</th>\n                <th>Tags</th>\n              </tr>\n            </thead>\n            <tbody>\n              {contacts.map((contact) => (\n                <tr key={contact.id}>\n                  <td>{contact.fullName}</td>\n                  <td>{contact.phoneNumber}</td>\n                  <td>{contact.email ?? \"-\"}</td>\n                  <td>{contact.tags ?? \"-\"}</td>\n                </tr>\n              ))}\n              {contacts.length === 0 && (\n                <tr>\n                  <td colSpan={4} className=\"muted\">\n                    No contacts yet.\n                  </td>\n                </tr>\n              )}\n            </tbody>\n          </table>\n        </div>\n      </section>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}