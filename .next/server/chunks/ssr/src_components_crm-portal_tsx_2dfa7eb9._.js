module.exports=[3449,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(10849);let e=["new","contacted","qualified","proposal","won","lost"],f="__auto_vapi_sip__",g={dashboard:"A quick glance at your recent activity.",agents:"Create and manage agents generated inside this client CRM.",calls:"Client call logs filtered to this CRM, including recordings.",leads:"Manage and convert your prospective clients.",files:"Secure document and asset tracking.",settings:"Manage branding, billing, numbers, and embed settings."};function h(a){return"disabled"===a||"requested"===a||"approved"===a?a:null}function i(a){return`$${(a/100).toFixed(2)}`}function j(a){if(!a)return"-";let b=new Date(a);return Number.isNaN(b.valueOf())?"-":b.toLocaleString()}async function k(a,b,c,d){let e=await fetch(`/api/crm/${encodeURIComponent(a)}${b}`,{...d,headers:{Authorization:`Bearer ${c}`,...d?.headers??{}}}),f=await e.json().catch(()=>({}));if(!e.ok)throw Error("string"==typeof f?.error?f.error:`Request failed (${e.status})`);return f}function l({clientSlug:l,projectName:m,projectDescription:n,logoUrl:o}){let[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)("dashboard"),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)({name:m,description:n,logoUrl:o}),[H,I]=(0,c.useState)([]),[J,K]=(0,c.useState)([]),[L,M]=(0,c.useState)([]),[N,O]=(0,c.useState)([]),[P,Q]=(0,c.useState)([]),[R,S]=(0,c.useState)([]),[T,U]=(0,c.useState)(null),[V,W]=(0,c.useState)([]),[X,Y]=(0,c.useState)({fullName:"",email:"",phone:"",company:"",source:"",notes:""}),[Z,$]=(0,c.useState)(""),[_,aa]=(0,c.useState)(null),[ab,ac]=(0,c.useState)(null),[ad,ae]=(0,c.useState)(!1),[af,ag]=(0,c.useState)({name:"",intro:"",firstMessageMode:"assistant-speaks-first",systemPrompt:"",voiceId:"",phoneSelection:"",numberDesiredAreaCode:""}),[ah,ai]=(0,c.useState)(!1),[aj,ak]=(0,c.useState)(null),[al,am]=(0,c.useState)({name:"",intro:"",firstMessageMode:"assistant-speaks-first",systemPrompt:"",voiceId:""}),[an,ao]=(0,c.useState)(!1),[ap,aq]=(0,c.useState)({country:"US",areaCode:"",assignAgentId:""}),[ar,as]=(0,c.useState)(!1),[at,au]=(0,c.useState)(""),[av,aw]=(0,c.useState)(!1),[ax,ay]=(0,c.useState)(null),az=(0,c.useRef)(null),aA=(0,c.useRef)(null),aB=(0,c.useRef)(null),aC=r?.access_token??null,aD=(0,c.useMemo)(()=>new Map(H.map(a=>[a.id,a])),[H]),aE=(0,c.useMemo)(()=>{let a=new Map;for(let b of R)b.assignedAgent?.id&&a.set(b.assignedAgent.id,b.displayNumber);return a},[R]);(0,c.useEffect)(()=>{let a=(0,d.createClient)();if(!a){u(!0),w("Supabase auth is not configured. Please set Supabase env vars.");return}let b=!0;a.auth.getSession().then(({data:a})=>{b&&s(a.session)}).finally(()=>{b&&u(!0)});let{data:c}=a.auth.onAuthStateChange((a,b)=>{s(b)});return()=>{b=!1,c.subscription.unsubscribe()}},[]),(0,c.useEffect)(()=>{E(window.location.origin)},[]),(0,c.useEffect)(()=>{N.length&&ag(a=>a.voiceId?a:{...a,voiceId:N[0].id})},[N]),(0,c.useEffect)(()=>{L.length&&aq(a=>a.assignAgentId?a:{...a,assignAgentId:L[0].id})},[L]),(0,c.useEffect)(()=>{!aj||L.some(a=>a.id===aj)||ak(null)},[L,aj]);let aF=(0,c.useCallback)(async()=>{aA.current&&(clearTimeout(aA.current),aA.current=null);let a=az.current;if(a&&(a.pause(),a.currentTime=0),aB.current)try{await aB.current.stop()}catch{}finally{aB.current=null}ay(null)},[]);(0,c.useEffect)(()=>()=>{aF()},[aF]);let aG=(0,c.useCallback)(async a=>{let b=await k(l,"/bootstrap",a);I(b.leads),K(b.files),G(a=>({...a,name:b.project.name,description:b.project.description,logoUrl:b.project.logoUrl}))},[l]),aH=(0,c.useCallback)(async a=>{let b=await k(l,"",a);C(h(b.project.embedStatus)),G(a=>({...a,name:b.project.name,description:b.project.description,logoUrl:b.project.logoUrl}))},[l]),aI=(0,c.useCallback)(async a=>{let b=await k(l,"/agents",a);M(b.agents),O(b.voices)},[l]),aJ=(0,c.useCallback)(async(a,b)=>{let c=new URLSearchParams;c.set("sync",b?.sync?"true":"false"),at.trim()&&c.set("q",at.trim()),Q((await k(l,`/calls?${c.toString()}`,a)).calls)},[at,l]),aK=(0,c.useCallback)(async a=>{S((await k(l,"/phone-numbers",a)).numbers)},[l]),aL=(0,c.useCallback)(async a=>{let b=await k(l,"/billing",a);U(b.summary),W(b.entries)},[l]),aM=(0,c.useCallback)(async a=>{if(!aC)return;y(!0);let b=(await Promise.allSettled([aG(aC),aH(aC),aI(aC),aJ(aC,{sync:a?.syncCalls===!0}),aK(aC),aL(aC)])).find(a=>"rejected"===a.status);b&&"rejected"===b.status&&w(b.reason instanceof Error?b.reason.message:"Failed loading CRM data."),y(!1)},[aC,aI,aL,aG,aJ,aK,aH]);async function aN(){let a=(0,d.createClient)();if(!a)return void w("Supabase auth is not configured.");if(!p.trim())return void w("Enter your email to continue.");w("Sending sign-in link...");let{error:b}=await a.auth.signInWithOtp({email:p.trim().toLowerCase(),options:{emailRedirectTo:window.location.href}});b?w(b.message):w("Check your email for a secure sign-in link.")}async function aO(){let a=(0,d.createClient)();a&&(await a.auth.signOut(),I([]),K([]),M([]),Q([]),S([]),U(null),W([]),ak(null),w("Signed out."))}async function aP(){if(aC){if(!X.fullName.trim())return void w("Lead name is required.");w("Creating lead...");try{let a=await k(l,"/leads",aC,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:X.fullName.trim(),email:X.email.trim()||void 0,phone:X.phone.trim()||void 0,company:X.company.trim()||void 0,source:X.source.trim()||void 0,notes:X.notes.trim()||void 0})});I(b=>[a.lead,...b]),Y({fullName:"",email:"",phone:"",company:"",source:"",notes:""}),w("Lead created."),A("leads")}catch(a){w(a.message)}}}async function aQ(a,b){if(aC){I(c=>c.map(c=>c.id===a?{...c,stage:b}:c));try{await k(l,`/leads/${encodeURIComponent(a)}`,aC,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({stage:b})}),w(null)}catch(a){w(a.message),await aG(aC)}}}async function aR(){if(!aC||!_)return;w("Uploading file...");let a=new FormData;a.append("file",_),Z&&a.append("leadId",Z);try{let b=await k(l,"/files",aC,{method:"POST",body:a});K(a=>[b.file,...a]),aa(null),$(""),w("File uploaded."),A("files")}catch(a){w(a.message)}}async function aS(){if(aC){y(!0),w("Requesting embed access...");try{let a=await k(l,"",aC,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({embedStatus:"requested"})}),b=h(a.project.embedStatus);b&&C(b),w("Embed access requested. Pending admin approval.")}catch(a){w(a.message)}finally{y(!1)}}}async function aT(){if(!aC||!ab)return void w("Select a logo image first.");ae(!0),w("Uploading company logo...");try{let a=new FormData;a.append("logo",ab);let b=await k(l,"/branding",aC,{method:"POST",body:a});G(a=>({...a,logoUrl:b.project.logoUrl})),ac(null),w("Logo updated successfully.")}catch(a){w(a.message)}finally{ae(!1)}}async function aU(){let b=af.voiceId.trim();if(!b)return void w("Select a voice first.");let c=N.find(a=>a.id===b);if(!c)return void w("Selected voice is not available.");let d=az.current;if(!d)return void w("Voice preview player is unavailable.");if(ax===b)return void await aF();aw(!0);try{if(await aF(),c.previewSampleUrl){d.src=c.previewSampleUrl,await d.play(),ay(b),w(`Playing voice preview for ${c.label}.`);return}let e=await fetch(`/api/ev/voice/voices/preview-config?voiceId=${encodeURIComponent(b)}`),f=await e.json().catch(()=>({}));if(!e.ok||!("preview"in f)){let a="string"==typeof f.error?f.error:"Preview is unavailable for this voice.";throw Error(a)}let g=new(await a.A(40892)).default(f.preview.publicKey);aB.current=g,ay(b),g.on("call-end",()=>{aB.current===g&&(aB.current=null),ay(a=>a===b?null:a)}),g.on("error",()=>{aB.current===g&&(aB.current=null),ay(a=>a===b?null:a),w("Live voice preview failed.")}),await g.start(f.preview.assistantId,f.preview.assistantOverrides),aA.current=setTimeout(()=>{aF()},1e3*f.preview.timeoutSeconds),w(`Running live voice preview for ${c.label}.`)}catch{ay(null),w("Failed to play selected voice preview.")}finally{aw(!1)}}async function aV(){if(aC){if(!af.name.trim())return void w("Agent name is required.");ai(!0),w("Creating CRM agent...");try{let a=af.phoneSelection.trim(),b=a===f,c=await k(l,"/agents",aC,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:af.name.trim(),intro:af.intro.trim()||void 0,firstMessageMode:af.firstMessageMode,systemPrompt:af.systemPrompt.trim()||void 0,voiceId:af.voiceId||void 0,phoneNumberId:a&&!b?a:void 0,autoGeneratePhoneNumber:b||void 0,numberDesiredAreaCode:b&&af.numberDesiredAreaCode.trim()?af.numberDesiredAreaCode.trim():void 0})});M(a=>[c.agent,...a]);let d=c.number;d&&S(a=>[d,...a.filter(a=>a.id!==d.id)]),ag(a=>({name:"",intro:"",firstMessageMode:a.firstMessageMode,systemPrompt:"",voiceId:a.voiceId,phoneSelection:"",numberDesiredAreaCode:""})),w(c.number?"CRM agent created and phone number connected.":"CRM agent created."),A("agents")}catch(a){w(a.message)}finally{ai(!1)}}}async function aW(){if(aC&&aj){if(!al.name.trim())return void w("Agent name is required.");ao(!0),w("Updating CRM agent...");try{let a=await k(l,`/agents/${encodeURIComponent(aj)}`,aC,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:al.name.trim(),intro:al.intro.trim()||void 0,firstMessageMode:al.firstMessageMode,systemPrompt:al.systemPrompt.trim()||void 0,voiceId:al.voiceId||void 0})});M(b=>b.map(b=>b.id===a.agent.id?a.agent:b)),ak(null),w("CRM agent updated.")}catch(a){w(a.message)}finally{ao(!1)}}}async function aX(){if(aC){if(!ap.assignAgentId)return void w("Select an agent for the new phone number.");as(!0),w("Purchasing phone number...");try{let a=await k(l,"/phone-numbers",aC,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({country:ap.country.trim()||"US",areaCode:ap.areaCode.trim()||void 0,assignAgentId:ap.assignAgentId})});S(b=>[a.number,...b]),await aL(aC),w("Number purchase submitted.")}catch(a){w(a.message)}finally{as(!1)}}}async function aY(a=!1){if(aC){y(!0);try{await aJ(aC,{sync:a}),w(null)}catch(a){w(a.message)}finally{y(!1)}}}(0,c.useEffect)(()=>{aC&&aM()},[aC,aM]);let aZ=(0,c.useMemo)(()=>[{id:"dashboard",label:"Overview"},{id:"agents",label:`Agents (${L.length})`},{id:"calls",label:`Calls (${P.length})`},{id:"leads",label:`Leads (${H.length})`},{id:"files",label:`Files (${J.length})`},{id:"settings",label:"Settings"}],[L.length,P.length,H.length,J.length]);if(!t)return(0,b.jsx)("div",{className:"crmPortalRoot crmPortalCenter",children:(0,b.jsx)("p",{className:"muted",children:"Initializing workspace..."})});if(!(0,d.isSupabaseEnabled)())return(0,b.jsx)("div",{className:"crmPortalRoot crmPortalCenter",children:(0,b.jsx)("section",{className:"card crmPortalNoticeCard",children:(0,b.jsx)("p",{className:"muted crmTextCenter",children:"Auth is disabled. Please configure `NEXT_PUBLIC_SUPABASE_URL` to continue."})})});if(!r)return(0,b.jsx)("div",{className:"crmPortalRoot crmPortalCenter",children:(0,b.jsxs)("section",{className:"card crmAuthCard crmAuthCardCompact",children:[(0,b.jsxs)("div",{className:"crmAuthHeader",children:[F.logoUrl?(0,b.jsx)("img",{src:F.logoUrl,alt:F.name,width:120,height:48,className:"crmAuthLogo"}):null,(0,b.jsxs)("h2",{className:"crmAuthTitle",children:[F.name," Workspace"]}),(0,b.jsx)("p",{className:"muted crmAuthSubtitle",children:"Sign in with your client email to access your CRM."})]}),(0,b.jsxs)("div",{className:"crmAuthForm",children:[(0,b.jsx)("input",{type:"email",placeholder:"you@client.com",value:p,onChange:a=>q(a.target.value),className:"crmInputWide"}),(0,b.jsx)("button",{type:"button",className:"crmButtonFull",onClick:()=>void aN(),children:"Continue with Email Link"})]}),v?(0,b.jsx)("p",{className:"muted crmAuthStatus",children:v}):null]})});let a$=`<iframe src="${D||"{YOUR_CRM_HOST}"}/portal/${l}" width="100%" height="800px" style="border:none; border-radius:12px; box-shadow:0 4px 24px rgba(0,0,0,0.1);"></iframe>`,a_=F.description?.trim()||g.dashboard;return(0,b.jsxs)("div",{className:"crmDashboardLayout",children:[(0,b.jsx)("audio",{ref:az,hidden:!0,onEnded:()=>ay(null)}),(0,b.jsxs)("aside",{className:"crmSidebar",children:[(0,b.jsxs)("div",{className:"crmSidebarBrand",children:[F.logoUrl?(0,b.jsx)("img",{src:F.logoUrl,alt:F.name,className:"crmSidebarLogo"}):null,(0,b.jsx)("h2",{className:"crmSidebarName",children:F.name}),(0,b.jsxs)("div",{className:"muted crmSidebarSlug",children:["/",l]}),F.description?(0,b.jsx)("p",{className:"muted crmSidebarDescription",children:F.description}):null]}),(0,b.jsx)("nav",{className:"crmSidebarNav",children:aZ.map(a=>(0,b.jsx)("button",{type:"button",onClick:()=>A(a.id),className:`crmSidebarTab${z===a.id?" isActive":""}`,children:a.label},a.id))}),(0,b.jsxs)("div",{className:"crmSidebarFooter",children:[(0,b.jsx)("div",{className:"crmSidebarEmail",children:r.user.email??"Unknown email"}),(0,b.jsx)("button",{type:"button",className:"secondary crmButtonFull crmButtonSmall",onClick:()=>void aO(),children:"Sign Out"})]})]}),(0,b.jsxs)("main",{className:"crmMain",children:[(0,b.jsxs)("div",{className:"crmTopBar",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"crmTopTitle",children:"dashboard"===z?"Overview":z}),(0,b.jsx)("p",{className:"muted crmTopSubtitle",children:"dashboard"===z?a_:g[z]})]}),(0,b.jsxs)("div",{className:"inlineActions inlineActionsCenter",children:[v?(0,b.jsx)("span",{className:"crmTopStatus",children:v}):null,(0,b.jsx)("button",{type:"button",className:"secondary crmButtonSmall",onClick:()=>void aM(),disabled:x,children:x?"Refreshing...":"Refresh Data"})]})]}),"dashboard"===z&&(0,b.jsxs)("div",{className:"crmStackLg",children:[(0,b.jsxs)("div",{className:"crmMetricGrid",children:[(0,b.jsxs)("div",{className:"card crmMetricCardWide",children:[(0,b.jsx)("div",{className:"muted crmMetricLabel",children:"Total Leads"}),(0,b.jsx)("div",{className:"crmMetricValueStrong",children:H.length})]}),(0,b.jsxs)("div",{className:"card crmMetricCardWide",children:[(0,b.jsx)("div",{className:"muted crmMetricLabel",children:"Client Agents"}),(0,b.jsx)("div",{className:"crmMetricValueStrong",children:L.length})]}),(0,b.jsxs)("div",{className:"card crmMetricCardWide",children:[(0,b.jsx)("div",{className:"muted crmMetricLabel",children:"Recent Calls"}),(0,b.jsx)("div",{className:"crmMetricValueStrong",children:P.length})]}),(0,b.jsxs)("div",{className:"card crmMetricCardWide",children:[(0,b.jsx)("div",{className:"muted crmMetricLabel",children:"Active Numbers"}),(0,b.jsx)("div",{className:"crmMetricValueStrong",children:R.length})]})]}),(0,b.jsxs)("div",{className:"card crmCardPadded",children:[(0,b.jsx)("h3",{className:"crmCardHeading",children:"Recent Calls (Client-Only)"}),(0,b.jsx)("div",{className:"tableWrap crmTableWrapFlush",children:(0,b.jsxs)("table",{className:"crmTableWide",children:[(0,b.jsx)("thead",{className:"crmTableHeadSmall",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"Call"}),(0,b.jsx)("th",{children:"Agent"}),(0,b.jsx)("th",{children:"Status"}),(0,b.jsx)("th",{children:"From"}),(0,b.jsx)("th",{children:"To"}),(0,b.jsx)("th",{children:"Started"}),(0,b.jsx)("th",{children:"Recording"})]})}),(0,b.jsxs)("tbody",{children:[P.slice(0,8).map(a=>(0,b.jsxs)("tr",{className:"crmRowCompact",children:[(0,b.jsx)("td",{children:a.vapiCallId}),(0,b.jsx)("td",{children:a.agent?.name??"-"}),(0,b.jsx)("td",{children:a.status}),(0,b.jsx)("td",{children:a.fromNumber??"-"}),(0,b.jsx)("td",{children:a.toNumber??"-"}),(0,b.jsx)("td",{children:j(a.startedAt)}),(0,b.jsx)("td",{children:a.recordingUrl?(0,b.jsx)("audio",{controls:!0,preload:"none",src:a.recordingUrl,className:"crmAudioPlayer"}):(0,b.jsx)("span",{className:"muted",children:"No recording"})})]},a.id)),0===P.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:7,className:"muted crmTableEmpty",children:"No client calls logged yet."})})]})]})})]}),(0,b.jsxs)("div",{className:"card crmCardPadded",children:[(0,b.jsx)("h3",{className:"crmCardHeading",children:"Quick Add Lead"}),(0,b.jsxs)("div",{className:"fieldGrid crmQuickLeadGrid",children:[(0,b.jsx)("input",{placeholder:"Full Name",value:X.fullName,onChange:a=>Y(b=>({...b,fullName:a.target.value}))}),(0,b.jsx)("input",{placeholder:"Email",type:"email",value:X.email,onChange:a=>Y(b=>({...b,email:a.target.value}))})]}),(0,b.jsx)("div",{className:"crmActionsEnd",children:(0,b.jsx)("button",{type:"button",onClick:()=>void aP(),children:"Save Lead"})})]})]}),"agents"===z&&(0,b.jsxs)("div",{className:"crmStack",children:[(0,b.jsxs)("div",{className:"card crmCardPadded",children:[(0,b.jsx)("h3",{className:"crmCardHeading",children:"Create CRM Agent"}),(0,b.jsxs)("div",{className:"fieldGrid crmAgentGrid",children:[(0,b.jsxs)("label",{children:["Name",(0,b.jsx)("input",{value:af.name,onChange:a=>ag(b=>({...b,name:a.target.value})),placeholder:"Client Assistant"})]}),(0,b.jsxs)("label",{children:["Voice",(0,b.jsxs)("div",{className:"crmVoiceSelectGroup",children:[(0,b.jsxs)("select",{"aria-label":"Agent Voice",value:af.voiceId,onChange:a=>ag(b=>({...b,voiceId:a.target.value})),className:"crmInputGrow",children:[!N.length&&(0,b.jsx)("option",{value:"",children:"No approved voices"}),N.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.label," (",a.locale,")"]},a.id))]}),(0,b.jsx)("button",{type:"button",className:"secondary",onClick:()=>void aU(),disabled:av||!af.voiceId,"aria-label":"Preview selected voice",title:"Preview selected voice",children:ax===af.voiceId?"■":"▶"})]}),(0,b.jsx)("p",{className:"muted crmInputHint",children:"If no voice is selected, a default approved voice is auto-assigned."})]}),(0,b.jsxs)("label",{children:["Phone Number",(0,b.jsxs)("select",{"aria-label":"Assign Phone Number",value:af.phoneSelection,onChange:a=>ag(b=>({...b,phoneSelection:a.target.value})),children:[(0,b.jsx)("option",{value:"",children:"No number selected"}),(0,b.jsx)("option",{value:f,children:"Auto-generate free VAPI SIP number"}),R.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.displayNumber,a.assignedAgent?` (assigned: ${a.assignedAgent.name})`:""]},a.id))]})]}),af.phoneSelection===f?(0,b.jsxs)("label",{children:["Preferred Area Code (optional)",(0,b.jsx)("input",{value:af.numberDesiredAreaCode,onChange:a=>ag(b=>({...b,numberDesiredAreaCode:a.target.value.replace(/\D/g,"").slice(0,3)})),placeholder:"212",inputMode:"numeric",maxLength:3})]}):null,(0,b.jsxs)("label",{className:"crmFieldFull",children:["Intro (optional)",(0,b.jsx)("input",{value:af.intro,onChange:a=>ag(b=>({...b,intro:a.target.value})),placeholder:"Hi, this is your assistant. How can I help?"})]}),(0,b.jsxs)("label",{children:["Conversation Start",(0,b.jsxs)("select",{"aria-label":"Conversation Start Mode",value:af.firstMessageMode,onChange:a=>ag(b=>({...b,firstMessageMode:a.target.value})),children:[(0,b.jsx)("option",{value:"assistant-speaks-first",children:"Agent speaks first"}),(0,b.jsx)("option",{value:"assistant-waits-for-user",children:"User speaks first"})]})]}),(0,b.jsxs)("label",{className:"crmFieldFull",children:["System Prompt (optional)",(0,b.jsx)("textarea",{rows:5,value:af.systemPrompt,onChange:a=>ag(b=>({...b,systemPrompt:a.target.value})),placeholder:"Instructions for this client's voice agent..."})]})]}),(0,b.jsxs)("div",{className:"inlineActions crmTopGap",children:[(0,b.jsx)("button",{type:"button",onClick:()=>void aV(),disabled:ah,children:ah?"Creating...":"Create Agent"}),(0,b.jsx)("button",{type:"button",className:"secondary",onClick:()=>void aM(),disabled:x,children:"Refresh"})]})]}),aj?(0,b.jsxs)("div",{className:"card crmCardPadded",children:[(0,b.jsx)("h3",{className:"crmCardHeading",children:"Edit CRM Agent"}),(0,b.jsxs)("div",{className:"fieldGrid crmAgentGrid",children:[(0,b.jsxs)("label",{children:["Name",(0,b.jsx)("input",{value:al.name,onChange:a=>am(b=>({...b,name:a.target.value})),placeholder:"Client Assistant"})]}),(0,b.jsxs)("label",{children:["Voice",(0,b.jsxs)("select",{"aria-label":"Agent Voice",value:al.voiceId,onChange:a=>am(b=>({...b,voiceId:a.target.value})),children:[!N.length&&(0,b.jsx)("option",{value:"",children:"Default voice"}),N.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.label," (",a.locale,")"]},a.id))]})]}),(0,b.jsxs)("label",{className:"crmFieldFull",children:["Intro",(0,b.jsx)("input",{value:al.intro,onChange:a=>am(b=>({...b,intro:a.target.value})),placeholder:"Hi, this is your assistant. How can I help?"})]}),(0,b.jsxs)("label",{children:["Conversation Start",(0,b.jsxs)("select",{"aria-label":"Conversation Start Mode",value:al.firstMessageMode,onChange:a=>am(b=>({...b,firstMessageMode:a.target.value})),children:[(0,b.jsx)("option",{value:"assistant-speaks-first",children:"Agent speaks first"}),(0,b.jsx)("option",{value:"assistant-waits-for-user",children:"User speaks first"})]})]}),(0,b.jsxs)("label",{className:"crmFieldFull",children:["System Prompt",(0,b.jsx)("textarea",{rows:5,value:al.systemPrompt,onChange:a=>am(b=>({...b,systemPrompt:a.target.value})),placeholder:"Instructions for this client's voice agent..."})]})]}),(0,b.jsxs)("div",{className:"inlineActions crmTopGap",children:[(0,b.jsx)("button",{type:"button",onClick:()=>void aW(),disabled:an,children:an?"Updating...":"Update Agent"}),(0,b.jsx)("button",{type:"button",className:"secondary",onClick:function(){ak(null),w("Canceled CRM agent edit.")},disabled:an,children:"Cancel"})]})]}):null,(0,b.jsxs)("div",{className:"card crmCardPadded",children:[(0,b.jsx)("h3",{className:"crmCardHeading",children:"CRM Agents"}),(0,b.jsx)("div",{className:"tableWrap crmTableWrapFlush",children:(0,b.jsxs)("table",{className:"crmTableWide",children:[(0,b.jsx)("thead",{className:"crmTableHeadSmall",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"Name"}),(0,b.jsx)("th",{children:"Voice"}),(0,b.jsx)("th",{children:"Status"}),(0,b.jsx)("th",{children:"Conversation Start"}),(0,b.jsx)("th",{children:"Phone Number"}),(0,b.jsx)("th",{children:"Description"}),(0,b.jsx)("th",{children:"Updated"}),(0,b.jsx)("th",{children:"Actions"})]})}),(0,b.jsxs)("tbody",{children:[L.map(a=>(0,b.jsxs)("tr",{className:"crmRowCompact",children:[(0,b.jsx)("td",{className:"crmLeadName",children:a.name}),(0,b.jsx)("td",{children:a.voiceLabel}),(0,b.jsx)("td",{children:a.status}),(0,b.jsx)("td",{children:"assistant-waits-for-user"===a.firstMessageMode?"User first":"Agent first"}),(0,b.jsx)("td",{children:aE.get(a.id)??"-"}),(0,b.jsx)("td",{className:"muted",children:a.description}),(0,b.jsx)("td",{children:j(a.updatedAt)}),(0,b.jsx)("td",{children:(0,b.jsx)("button",{type:"button",className:"secondary crmButtonSmall",onClick:()=>{ak(a.id),am({name:a.name,intro:a.intro,firstMessageMode:a.firstMessageMode,systemPrompt:a.systemPrompt,voiceId:a.voiceId}),w(`Editing ${a.name}.`)},disabled:an,children:aj===a.id?"Editing":"Edit"})})]},a.id)),!L.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:8,className:"muted crmTableEmpty",children:"No CRM agents yet."})})]})]})})]})]}),"calls"===z&&(0,b.jsxs)("div",{className:"crmStack",children:[(0,b.jsx)("section",{className:"card crmCardPadded",children:(0,b.jsxs)("div",{className:"inlineActions",children:[(0,b.jsx)("input",{"aria-label":"Search Calls",value:at,onChange:a=>au(a.target.value),placeholder:"Search number or call id",className:"crmInputSearch"}),(0,b.jsx)("button",{type:"button",className:"secondary",onClick:()=>void aY(!1),disabled:x,children:"Search"}),(0,b.jsx)("button",{type:"button",onClick:()=>void aY(!0),disabled:x,children:"Sync + Refresh"})]})}),(0,b.jsx)("section",{className:"card crmCardPadded",children:(0,b.jsx)("div",{className:"tableWrap crmTableWrapFlush",children:(0,b.jsxs)("table",{className:"crmTableWide",children:[(0,b.jsx)("thead",{className:"crmTableHeadSmall",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"Call"}),(0,b.jsx)("th",{children:"Agent"}),(0,b.jsx)("th",{children:"Status"}),(0,b.jsx)("th",{children:"From"}),(0,b.jsx)("th",{children:"To"}),(0,b.jsx)("th",{children:"Duration"}),(0,b.jsx)("th",{children:"Cost"}),(0,b.jsx)("th",{children:"Started"}),(0,b.jsx)("th",{children:"Recording"})]})}),(0,b.jsxs)("tbody",{children:[P.map(a=>(0,b.jsxs)("tr",{className:"crmRowCompact",children:[(0,b.jsx)("td",{children:a.vapiCallId}),(0,b.jsx)("td",{children:a.agent?.name??"-"}),(0,b.jsx)("td",{children:a.status}),(0,b.jsx)("td",{children:a.fromNumber??"-"}),(0,b.jsx)("td",{children:a.toNumber??"-"}),(0,b.jsx)("td",{children:a.durationSeconds??"-"}),(0,b.jsx)("td",{children:"number"==typeof a.costUsd?`$${a.costUsd.toFixed(3)}`:"-"}),(0,b.jsx)("td",{children:j(a.startedAt)}),(0,b.jsx)("td",{children:a.recordingUrl?(0,b.jsx)("audio",{controls:!0,preload:"none",src:a.recordingUrl,className:"crmAudioPlayer"}):(0,b.jsx)("span",{className:"muted",children:"No recording"})})]},a.id)),!P.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:9,className:"muted crmTableEmpty",children:"No client calls logged yet."})})]})]})})})]}),"leads"===z&&(0,b.jsx)("div",{className:"crmStack",children:(0,b.jsx)("div",{className:"card crmCardPadded",children:(0,b.jsx)("div",{className:"tableWrap crmTableWrapFlush",children:(0,b.jsxs)("table",{className:"crmTableWide",children:[(0,b.jsx)("thead",{className:"crmTableHeadSmall",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"Name"}),(0,b.jsx)("th",{children:"Email"}),(0,b.jsx)("th",{children:"Phone"}),(0,b.jsx)("th",{children:"Company"}),(0,b.jsx)("th",{children:"Stage"})]})}),(0,b.jsxs)("tbody",{children:[H.map(a=>(0,b.jsxs)("tr",{className:"crmRowCompact",children:[(0,b.jsx)("td",{className:"crmLeadName",children:a.fullName}),(0,b.jsx)("td",{className:"muted",children:a.email??"-"}),(0,b.jsx)("td",{className:"muted",children:a.phone??"-"}),(0,b.jsx)("td",{className:"muted",children:a.company??"-"}),(0,b.jsx)("td",{children:(0,b.jsx)("select",{"aria-label":"Lead Stage",value:a.stage,onChange:b=>void aQ(a.id,b.target.value),className:"crmStageSelect",children:e.map(a=>(0,b.jsx)("option",{value:a,children:a},a))})})]},a.id)),!H.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:5,className:"muted crmTableEmpty",children:"No leads exist yet."})})]})]})})})}),"files"===z&&(0,b.jsxs)("div",{className:"crmStack",children:[(0,b.jsxs)("div",{className:"card crmCardPadded crmFileUploadCard",children:[(0,b.jsxs)("select",{"aria-label":"Select lead",value:Z,onChange:a=>$(a.target.value),children:[(0,b.jsx)("option",{value:"",children:"General (no lead)"}),H.map(a=>(0,b.jsx)("option",{value:a.id,children:a.fullName},a.id))]}),(0,b.jsx)("input",{"aria-label":"Upload File",type:"file",onChange:a=>aa(a.target.files?.[0]??null),className:"crmUploadInput crmFileInputGrow"}),(0,b.jsx)("button",{type:"button",onClick:()=>void aR(),disabled:!_,children:"Upload File"})]}),(0,b.jsx)("div",{className:"card crmCardPadded",children:(0,b.jsx)("div",{className:"tableWrap crmTableWrapFlush",children:(0,b.jsxs)("table",{className:"crmTableWide",children:[(0,b.jsx)("thead",{className:"crmTableHeadSmall",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"File Name"}),(0,b.jsx)("th",{children:"Associated Lead"}),(0,b.jsx)("th",{children:"Uploaded By"}),(0,b.jsx)("th",{children:"Size"})]})}),(0,b.jsxs)("tbody",{children:[J.map(a=>(0,b.jsxs)("tr",{className:"crmRowCompact",children:[(0,b.jsx)("td",{children:a.publicUrl?(0,b.jsx)("a",{href:a.publicUrl,target:"_blank",rel:"noreferrer",className:"crmFileLink",children:a.fileName}):a.fileName}),(0,b.jsx)("td",{className:"muted",children:a.leadId?aD.get(a.leadId)?.fullName??a.leadId:"General"}),(0,b.jsx)("td",{className:"muted",children:a.uploadedByEmail??"-"}),(0,b.jsxs)("td",{className:"muted",children:[Math.round(a.sizeBytes/1024)," KB"]})]},a.id)),!J.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:4,className:"muted crmTableEmpty",children:"No files uploaded yet."})})]})]})})})]}),"settings"===z&&(0,b.jsxs)("div",{className:"crmSettingsStack",children:[(0,b.jsxs)("div",{className:"card crmSettingsCard",children:[(0,b.jsx)("h3",{className:"crmSettingsTitle",children:"Company Branding"}),(0,b.jsx)("p",{className:"muted crmSettingsHelp",children:"Upload your company logo. It will appear beside your CRM title."}),(0,b.jsxs)("div",{className:"crmSettingsDivider crmLogoUpload",children:[F.logoUrl?(0,b.jsx)("img",{src:F.logoUrl,alt:"Company logo",width:72,height:72,className:"crmCompanyLogoLarge"}):(0,b.jsx)("div",{className:"crmCompanyLogoPlaceholder",children:"No Logo"}),(0,b.jsxs)("div",{className:"crmLogoActions",children:[(0,b.jsx)("input",{"aria-label":"Upload Logo",type:"file",accept:"image/*",onChange:a=>ac(a.target.files?.[0]??null)}),(0,b.jsx)("div",{className:"inlineActions",children:(0,b.jsx)("button",{type:"button",onClick:()=>void aT(),disabled:ad||!ab,children:ad?"Uploading...":"Upload Logo"})})]})]})]}),(0,b.jsxs)("div",{className:"card crmSettingsCard",children:[(0,b.jsx)("h3",{className:"crmSettingsTitle",children:"Billing"}),(0,b.jsx)("p",{className:"muted crmSettingsHelp",children:"CRM-specific billing summary for this client project."}),(0,b.jsxs)("div",{className:"crmSettingsDivider",children:[(0,b.jsxs)("div",{className:"crmBillingGrid",children:[(0,b.jsxs)("div",{className:"card crmBillingCard",children:[(0,b.jsx)("div",{className:"muted crmBillingLabel",children:"Balance"}),(0,b.jsx)("div",{className:"crmBillingValue",children:i(T?.balanceCents??0)})]}),(0,b.jsxs)("div",{className:"card crmBillingCard",children:[(0,b.jsx)("div",{className:"muted crmBillingLabel",children:"Monthly Phone Cost"}),(0,b.jsx)("div",{className:"crmBillingValue",children:i(T?.monthlyPhoneCostCents??0)})]}),(0,b.jsxs)("div",{className:"card crmBillingCard",children:[(0,b.jsx)("div",{className:"muted crmBillingLabel",children:"Entries"}),(0,b.jsx)("div",{className:"crmBillingValue",children:T?.entryCount??0})]})]}),(0,b.jsx)("div",{className:"tableWrap crmTableWrapFlush",children:(0,b.jsxs)("table",{className:"crmTableWide",children:[(0,b.jsx)("thead",{className:"crmTableHeadSmall",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"Description"}),(0,b.jsx)("th",{children:"Type"}),(0,b.jsx)("th",{children:"Amount"}),(0,b.jsx)("th",{children:"Date"})]})}),(0,b.jsxs)("tbody",{children:[V.map(a=>(0,b.jsxs)("tr",{className:"crmRowCompact",children:[(0,b.jsx)("td",{children:a.description}),(0,b.jsx)("td",{children:a.entryType}),(0,b.jsx)("td",{children:i(a.amountCents)}),(0,b.jsx)("td",{children:j(a.createdAt)})]},a.id)),!V.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:4,className:"muted crmTableEmpty",children:"No billing entries for this CRM yet."})})]})]})})]})]}),(0,b.jsxs)("div",{className:"card crmSettingsCard",children:[(0,b.jsx)("h3",{className:"crmSettingsTitle",children:"Phone Numbers"}),(0,b.jsx)("p",{className:"muted crmSettingsHelp",children:"Purchase numbers and assign them to your CRM agents."}),(0,b.jsxs)("div",{className:"crmSettingsDivider",children:[(0,b.jsxs)("div",{className:"fieldGrid crmPhoneGrid",children:[(0,b.jsxs)("label",{children:["Country",(0,b.jsx)("input",{value:ap.country,onChange:a=>aq(b=>({...b,country:a.target.value})),placeholder:"US"})]}),(0,b.jsxs)("label",{children:["Area Code (optional)",(0,b.jsx)("input",{value:ap.areaCode,onChange:a=>aq(b=>({...b,areaCode:a.target.value})),placeholder:"212"})]}),(0,b.jsxs)("label",{children:["Assign Agent",(0,b.jsxs)("select",{"aria-label":"Assign Agent",value:ap.assignAgentId,onChange:a=>aq(b=>({...b,assignAgentId:a.target.value})),children:[!L.length&&(0,b.jsx)("option",{value:"",children:"No CRM agents"}),L.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]})]}),(0,b.jsx)("div",{className:"inlineActions crmTopGapSmall",children:(0,b.jsx)("button",{type:"button",onClick:()=>void aX(),disabled:ar||!L.length,children:ar?"Purchasing...":"Purchase Number"})}),(0,b.jsx)("div",{className:"tableWrap crmTableWrapFlush crmTopGap",children:(0,b.jsxs)("table",{className:"crmTableWide",children:[(0,b.jsx)("thead",{className:"crmTableHeadSmall",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"Number"}),(0,b.jsx)("th",{children:"Status"}),(0,b.jsx)("th",{children:"Assigned Agent"}),(0,b.jsx)("th",{children:"Price"})]})}),(0,b.jsxs)("tbody",{children:[R.map(a=>(0,b.jsxs)("tr",{className:"crmRowCompact",children:[(0,b.jsx)("td",{children:a.displayNumber}),(0,b.jsx)("td",{children:a.status}),(0,b.jsx)("td",{children:a.assignedAgent?.name??"-"}),(0,b.jsx)("td",{children:i(a.monthlyPriceCents)})]},a.id)),!R.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:4,className:"muted crmTableEmpty",children:"No CRM numbers yet."})})]})]})})]})]}),(0,b.jsxs)("div",{className:"card crmSettingsCard",children:[(0,b.jsxs)("div",{className:"crmSettingsHeader",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"crmSettingsTitle",children:"Dashboard Embed"}),(0,b.jsx)("p",{className:"muted crmSettingsHelp",children:"Request permission from the admin to embed this CRM directly into your own internal tools or intranet via an iframe."})]}),(0,b.jsxs)("div",{className:`crmEmbedStatusPill${"approved"===B?" isApproved":""}${"requested"===B?" isRequested":""}`,children:["Status: ",(0,b.jsx)("span",{className:"crmEmbedStatusValue",children:B?B.toUpperCase():"DISABLED"})]})]}),(0,b.jsxs)("div",{className:"crmSettingsDivider",children:[(!B||"disabled"===B)&&(0,b.jsx)("button",{type:"button",onClick:()=>void aS(),disabled:x,children:"Request Embed Access"}),"requested"===B&&(0,b.jsxs)("div",{className:"crmEmbedPending",children:[(0,b.jsx)("p",{className:"crmEmbedPendingTitle",children:"Your request is currently pending admin review."}),(0,b.jsx)("p",{className:"crmEmbedPendingCopy",children:"You will see the embed code snippet here once approved."})]}),"approved"===B&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"crmSnippetTitle",children:"Your Integration Snippet"}),(0,b.jsxs)("div",{className:"crmSnippetWrap",children:[(0,b.jsx)("pre",{className:"crmSnippetCode",children:(0,b.jsx)("code",{children:a$})}),(0,b.jsx)("button",{type:"button",className:"secondary crmSnippetCopyButton",onClick:()=>{navigator.clipboard.writeText(a$),w("Snippet copied to clipboard!")},children:"Copy Code"})]})]})]})]})]})]})]})}a.s(["CrmPortal",()=>l])}];

//# sourceMappingURL=src_components_crm-portal_tsx_2dfa7eb9._.js.map