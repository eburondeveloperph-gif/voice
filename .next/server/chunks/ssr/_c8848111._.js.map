{"version":3,"sources":["../../../../src/lib/client/api.ts","../../../../src/app/voices/page.tsx"],"sourcesContent":["export async function apiRequest<T>(url: string, init?: RequestInit): Promise<T> {\n  const response = await fetch(url, {\n    ...init,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...(init?.headers ?? {}),\n    },\n  });\n\n  const text = await response.text();\n  const payload = text ? safeJsonParse(text) : null;\n\n  if (!response.ok) {\n    const errorMessage =\n      typeof payload === \"object\" && payload && \"error\" in payload\n        ? String((payload as { error: string }).error)\n        : `Request failed (${response.status})`;\n    const details =\n      typeof payload === \"object\" && payload && \"details\" in payload\n        ? (payload as { details?: unknown }).details\n        : undefined;\n    const detailsMessage = getErrorDetailsMessage(details);\n    throw new Error(detailsMessage ? `${errorMessage}: ${detailsMessage}` : errorMessage);\n  }\n\n  return payload as T;\n}\n\nfunction safeJsonParse(text: string): unknown {\n  try {\n    return JSON.parse(text) as unknown;\n  } catch {\n    return text;\n  }\n}\n\nfunction getErrorDetailsMessage(details: unknown): string | null {\n  if (typeof details === \"string\" && details.trim().length > 0) {\n    return details.trim();\n  }\n\n  if (Array.isArray(details)) {\n    const firstString = details.find(\n      (item): item is string => typeof item === \"string\" && item.trim().length > 0,\n    );\n    if (firstString) {\n      return firstString.trim();\n    }\n  }\n\n  if (typeof details !== \"object\" || details === null) {\n    return null;\n  }\n\n  const message = (details as { message?: unknown }).message;\n  if (typeof message === \"string\" && message.trim().length > 0) {\n    return message.trim();\n  }\n\n  if (Array.isArray(message)) {\n    const firstString = message.find(\n      (item): item is string => typeof item === \"string\" && item.trim().length > 0,\n    );\n    if (firstString) {\n      return firstString.trim();\n    }\n  }\n\n  return null;\n}\n","\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\n\nimport { apiRequest } from \"@/lib/client/api\";\n\nimport \"./voices.css\";\n\ntype Voice = {\n  id: string;\n  label: string;\n  locale: string;\n  previewSampleUrl?: string;\n};\n\ntype VoicePreviewConfigResponse = {\n  preview: {\n    assistantId: string;\n    publicKey: string;\n    timeoutSeconds: number;\n    assistantOverrides: Record<string, unknown>;\n  };\n};\n\ntype EburonClient = {\n  on: (event: string, listener: (...args: unknown[]) => void) => void;\n  start: (assistantId: string, assistantOverrides?: Record<string, unknown>) => Promise<unknown>;\n  stop: () => Promise<void>;\n};\n\ninterface PreviewState {\n  voiceId: string;\n  name: string;\n  isVisible: boolean;\n  message: string;\n}\n\nexport default function VoicesPage() {\n  const [voices, setVoices] = useState<Voice[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [syncing, setSyncing] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [preview, setPreview] = useState<PreviewState | null>(null);\n\n  const audioRef = useRef<HTMLAudioElement | null>(null);\n  const eburonRef = useRef<EburonClient | null>(null);\n  const previewTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  const loadVoices = (sync = false) => {\n    setLoading(true);\n    apiRequest<{ voices: Voice[] }>(`/api/ev/voice/voices?sync=${sync}`)\n      .then((payload) => {\n        setVoices(payload.voices);\n        setLoading(false);\n      })\n      .catch((err) => {\n        setError(err.message);\n        setLoading(false);\n      });\n  };\n\n  useEffect(() => {\n    loadVoices(true);\n\n    return () => {\n      if (previewTimeoutRef.current) {\n        clearTimeout(previewTimeoutRef.current);\n      }\n      if (eburonRef.current) {\n        void eburonRef.current.stop();\n        eburonRef.current = null;\n      }\n    };\n  }, []);\n\n  const stopLivePreview = async () => {\n    if (previewTimeoutRef.current) {\n      clearTimeout(previewTimeoutRef.current);\n      previewTimeoutRef.current = null;\n    }\n\n    if (eburonRef.current) {\n      try {\n        await eburonRef.current.stop();\n      } finally {\n        eburonRef.current = null;\n      }\n    }\n  };\n\n  const handleSync = async () => {\n    setSyncing(true);\n    try {\n      await apiRequest(\"/api/ev/voice/voices/sync\", { method: \"POST\" });\n      loadVoices(false);\n    } catch {\n      setError(\"Failed to sync voices\");\n    } finally {\n      setSyncing(false);\n    }\n  };\n\n  const handlePlayPreview = async (voice: Voice) => {\n    setError(null);\n    await stopLivePreview();\n\n    if (voice.previewSampleUrl) {\n      try {\n        if (audioRef.current) {\n          audioRef.current.src = voice.previewSampleUrl;\n          await audioRef.current.play();\n        }\n\n        setPreview({\n          voiceId: voice.id,\n          name: voice.label,\n          isVisible: true,\n          message: \"Playing preview sample.\",\n        });\n\n        setTimeout(() => {\n          setPreview((prev) => (prev?.voiceId === voice.id ? { ...prev, isVisible: false } : prev));\n        }, 5000);\n      } catch {\n        setError(\"Failed to play preview sample.\");\n      }\n\n      return;\n    }\n\n    try {\n      const config = await apiRequest<VoicePreviewConfigResponse>(\n        `/api/ev/voice/voices/preview-config?voiceId=${encodeURIComponent(voice.id)}`,\n      );\n\n      const mod = await import(\"@vapi-ai/web\");\n      const Eburon = mod.default as unknown as new (publicKey: string) => EburonClient;\n      const client = new Eburon(config.preview.publicKey);\n      eburonRef.current = client;\n\n      setPreview({\n        voiceId: voice.id,\n        name: voice.label,\n        isVisible: true,\n        message: \"Running live call preview.\",\n      });\n\n      client.on(\"call-end\", () => {\n        if (eburonRef.current === client) {\n          eburonRef.current = null;\n        }\n        setPreview((prev) => (prev?.voiceId === voice.id ? { ...prev, isVisible: false } : prev));\n      });\n\n      client.on(\"error\", () => {\n        setError(\"Live preview failed for this voice.\");\n        if (eburonRef.current === client) {\n          eburonRef.current = null;\n        }\n        setPreview((prev) => (prev?.voiceId === voice.id ? { ...prev, isVisible: false } : prev));\n      });\n\n      await client.start(config.preview.assistantId, config.preview.assistantOverrides);\n\n      previewTimeoutRef.current = setTimeout(() => {\n        void stopLivePreview();\n        setPreview((prev) => (prev?.voiceId === voice.id ? { ...prev, isVisible: false } : prev));\n      }, config.preview.timeoutSeconds * 1000);\n    } catch (err) {\n      const message = err instanceof Error ? err.message : \"Preview is unavailable for this voice.\";\n      setError(message);\n      setPreview((prev) => (prev?.voiceId === voice.id ? { ...prev, isVisible: false } : prev));\n    }\n  };\n\n  return (\n    <div className=\"voicesPage\">\n      <audio ref={audioRef} hidden />\n\n      <header className=\"voicesHead\">\n        <div>\n          <h1 className=\"voicesTitle\">Voices</h1>\n          <p className=\"voicesSubtitle\">Explore and preview the voice catalog available for your agents.</p>\n        </div>\n        <button className=\"secondary syncBtn\" onClick={handleSync} disabled={syncing}>\n          {syncing ? \"Syncing...\" : \"Sync Voice Catalog\"}\n        </button>\n      </header>\n\n      {error && <div className=\"error\">{error}</div>}\n\n      {loading ? (\n        <p className=\"muted\">Loading voice catalog...</p>\n      ) : (\n        <section className=\"voicesGrid\">\n          {voices.map((voice) => (\n            <article key={voice.id} className=\"voiceCard\">\n              <div className=\"voiceCardTop\">\n                <div>\n                  <h3 className=\"voiceName\">{voice.label}</h3>\n                  <p className=\"voiceId\">{voice.id}</p>\n                </div>\n                <span className=\"voiceLocale\">{voice.locale}</span>\n              </div>\n\n              <div className=\"voiceActions\">\n                <button\n                  className={`playBtn ${preview?.voiceId === voice.id && preview.isVisible ? \"playing\" : \"\"}`}\n                  onClick={() => handlePlayPreview(voice)}\n                >\n                  <span className=\"playIcon\">{preview?.voiceId === voice.id && preview.isVisible ? \"üîä\" : \"‚ñ∂\"}</span>\n                  Preview Voice\n                </button>\n              </div>\n            </article>\n          ))}\n        </section>\n      )}\n\n      {preview && preview.isVisible && (\n        <div className=\"previewNotification\">\n          <div className=\"notifIcon\">üéôÔ∏è</div>\n          <div className=\"notifContent\">\n            <h4>Voice Preview: {preview.name}</h4>\n            <p>{preview.message}</p>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}