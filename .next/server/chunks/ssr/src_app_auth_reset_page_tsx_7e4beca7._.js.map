{"version":3,"sources":["../../../../src/app/auth/reset/page.tsx"],"sourcesContent":["\"use client\";\n\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { useEffect, useState, type FormEvent } from \"react\";\n\nimport { createClient, isSupabaseEnabled } from \"@/lib/supabase\";\n\nconst LOGO_URL = \"https://eburon.ai/icon-eburon.svg\";\n\nexport default function ResetPasswordPage() {\n  const router = useRouter();\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [status, setStatus] = useState<string | null>(null);\n  const [submitting, setSubmitting] = useState(false);\n  const [recoveryReady, setRecoveryReady] = useState(false);\n  const supabaseEnabled = isSupabaseEnabled();\n\n  useEffect(() => {\n    if (!supabaseEnabled) return;\n    const sb = createClient();\n    if (!sb) return;\n\n    let active = true;\n    sb.auth.getSession().then(({ data }) => {\n      if (!active) return;\n      if (data.session) {\n        setRecoveryReady(true);\n        return;\n      }\n      setStatus(\"Open this page from the password recovery email link.\");\n    });\n\n    const { data: subscription } = sb.auth.onAuthStateChange((event, nextSession) => {\n      if (event === \"PASSWORD_RECOVERY\" || nextSession) {\n        setRecoveryReady(true);\n        setStatus(null);\n      }\n    });\n\n    return () => {\n      active = false;\n      subscription.subscription.unsubscribe();\n    };\n  }, [supabaseEnabled]);\n\n  async function handleSubmit(event: FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n    if (!supabaseEnabled) {\n      setStatus(\"Supabase auth is not configured.\");\n      return;\n    }\n    if (!recoveryReady) {\n      setStatus(\"Recovery session not found. Re-open the recovery email link.\");\n      return;\n    }\n    if (password.length < 8) {\n      setStatus(\"Password must be at least 8 characters.\");\n      return;\n    }\n    if (password !== confirmPassword) {\n      setStatus(\"Password confirmation does not match.\");\n      return;\n    }\n\n    const sb = createClient();\n    if (!sb) {\n      setStatus(\"Supabase auth client is unavailable.\");\n      return;\n    }\n\n    setSubmitting(true);\n    setStatus(null);\n    try {\n      const { error } = await sb.auth.updateUser({ password });\n      if (error) {\n        setStatus(error.message);\n        return;\n      }\n      await sb.auth.signOut();\n      setStatus(\"Password updated. Redirecting to login...\");\n      window.setTimeout(() => {\n        router.replace(\"/auth\");\n      }, 900);\n    } finally {\n      setSubmitting(false);\n    }\n  }\n\n  return (\n    <div className=\"authRoot\">\n      <div className=\"authGlow authGlowA\" aria-hidden />\n      <div className=\"authGlow authGlowB\" aria-hidden />\n      <div className=\"authShell authResetShell\">\n        <section className=\"authBrandPanel\">\n          <div className=\"authBrandLockup\">\n            <div className=\"authBrandBadge\">\n              <Image src={LOGO_URL} alt=\"Eburon Voice\" width={36} height={36} />\n            </div>\n            <div>\n              <p className=\"authEyebrow\">Eburon Voice</p>\n              <h1 className=\"authHeading\">Reset Password</h1>\n            </div>\n          </div>\n          <p className=\"authBrandText\">Create a new secure password to continue using your admin console account.</p>\n        </section>\n\n        <section className=\"card authCardPanel\">\n          <h2 className=\"authFormTitle\">Set a new password</h2>\n          <p className=\"muted authFormCopy\">Use at least 8 characters. Avoid reusing previous passwords.</p>\n\n          {!supabaseEnabled ? (\n            <p className=\"muted\">\n              Supabase auth is not configured. Add `NEXT_PUBLIC_SUPABASE_URL` and\n              `NEXT_PUBLIC_SUPABASE_ANON_KEY` in your environment.\n            </p>\n          ) : (\n            <form className=\"authForm\" onSubmit={(event) => void handleSubmit(event)}>\n              <label>\n                New Password\n                <input\n                  type=\"password\"\n                  autoComplete=\"new-password\"\n                  value={password}\n                  onChange={(event) => setPassword(event.target.value)}\n                  placeholder=\"At least 8 characters\"\n                  required\n                />\n              </label>\n\n              <label>\n                Confirm New Password\n                <input\n                  type=\"password\"\n                  autoComplete=\"new-password\"\n                  value={confirmPassword}\n                  onChange={(event) => setConfirmPassword(event.target.value)}\n                  placeholder=\"Re-enter password\"\n                  required\n                />\n              </label>\n\n              <button type=\"submit\" disabled={submitting || !recoveryReady}>\n                {submitting ? \"Updating...\" : \"Update Password\"}\n              </button>\n            </form>\n          )}\n\n          {status ? <p className=\"muted authStatus\">{status}</p> : null}\n          <p className=\"muted authStatus\">\n            <Link href=\"/auth\" className=\"authLink\">\n              Back to login\n            </Link>\n          </p>\n        </section>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,EAAA,CAAA,CAAA,OAIe,SAAS,IACtB,IAAM,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACnC,CAAC,EAAiB,EAAmB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACjD,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAwB,MAC9C,CAAC,EAAY,EAAc,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACvC,CAAC,EAAe,EAAiB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAC7C,EAAkB,CAAA,EAAA,EAAA,iBAAA,AAAiB,IA8BzC,eAAe,EAAa,CAAiC,EAE3D,GADA,EAAM,cAAc,GAChB,CAAC,EAAiB,YACpB,EAAU,oCAGZ,GAAI,CAAC,EAAe,YAClB,EAAU,gEAGZ,GAAI,EAAS,MAAM,CAAG,EAAG,YACvB,EAAU,2CAGZ,GAAI,IAAa,EAAiB,YAChC,EAAU,yCAIZ,IAAM,EAAK,CAAA,EAAA,EAAA,YAAA,AAAY,IACvB,GAAI,CAAC,EAAI,YACP,EAAU,wCAIZ,GAAc,GACd,EAAU,MACV,GAAI,CACF,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAG,IAAI,CAAC,UAAU,CAAC,UAAE,CAAS,GACtD,GAAI,EAAO,YACT,EAAU,EAAM,OAAO,CAGzB,OAAM,EAAG,IAAI,CAAC,OAAO,GACrB,EAAU,6CACV,OAAO,UAAU,CAAC,KAChB,EAAO,OAAO,CAAC,QACjB,EAAG,IACL,QAAU,CACR,GAAc,EAChB,CACF,CAEA,MAvEA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,GAAI,CAAC,EAAiB,OACtB,IAAM,EAAK,CAAA,EAAA,EAAA,YAAA,AAAY,IACvB,GAAI,CAAC,EAAI,OAET,IAAI,GAAS,EACb,EAAG,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,CAAC,MAAE,CAAI,CAAE,IACjC,GAAK,CAAD,EACJ,GAAI,EADS,AACJ,OAAO,CAAE,YAChB,GAAiB,GAGnB,EAAU,yDACZ,GAEA,GAAM,CAAE,KAAM,CAAY,CAAE,CAAG,EAAG,IAAI,CAAC,iBAAiB,CAAC,CAAC,EAAO,MACjD,sBAAV,GAAiC,CAAA,GAAa,CAChD,GAAiB,GACjB,EAAU,MAEd,GAEA,MAAO,KACL,EAAS,GACT,EAAa,YAAY,CAAC,WAAW,EACvC,CACF,EAAG,CAAC,EAAgB,EA8ClB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,qBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qBAAqB,aAAW,CAAA,CAAA,IAC/C,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qBAAqB,aAAW,CAAA,CAAA,IAC/C,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,qCACb,CAAA,EAAA,EAAA,IAAA,EAAC,UAAA,CAAQ,UAAU,2BACjB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,4BACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,0BACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAK,CAAA,CAAC,IA1FJ,CA0FS,mCAAU,IAAI,eAAe,MAAO,GAAI,OAAQ,OAE9D,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,uBAAc,iBAC3B,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,uBAAc,yBAGhC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,yBAAgB,kFAG/B,CAAA,EAAA,EAAA,IAAA,EAAC,UAAA,CAAQ,UAAU,+BACjB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,yBAAgB,uBAC9B,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,8BAAqB,iEAEhC,AAAD,EAMC,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,WAAW,SAAU,AAAC,GAAU,KAAK,EAAa,aAChE,CAAA,EAAA,EAAA,IAAA,EAAC,QAAA,WAAM,eAEL,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,KAAK,WACL,aAAa,eACb,MAAO,EACP,SAAU,AAAC,GAAU,EAAY,EAAM,MAAM,CAAC,KAAK,EACnD,YAAY,wBACZ,QAAQ,CAAA,CAAA,OAIZ,CAAA,EAAA,EAAA,IAAA,EAAC,QAAA,WAAM,uBAEL,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,KAAK,WACL,aAAa,eACb,MAAO,EACP,SAAU,AAAC,GAAU,EAAmB,EAAM,MAAM,CAAC,KAAK,EAC1D,YAAY,oBACZ,QAAQ,CAAA,CAAA,OAIZ,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,KAAK,SAAS,SAAU,GAAc,CAAC,WAC5C,EAAa,cAAgB,uBA/BlC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iBAAQ,6HAoCtB,EAAS,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,4BAAoB,IAAc,KACzD,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,4BACX,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CAAC,KAAK,QAAQ,UAAU,oBAAW,4BAQpD"}