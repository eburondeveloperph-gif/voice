module.exports=[21486,e=>{"use strict";let t=new Map(["Elliot","Kylie","Rohan","Lily","Savannah","Hana","Neha","Cole","Harry","Paige","Spencer","Nico","Kai","Emma","Sagar","Neil","Leah","Tara","Jess","Leo","Dan","Mia","Zac","Zoe"].map(e=>[e.toLowerCase(),e]));function a(e){return t.get(e.toLowerCase())??e}function r(e,r,i){let s=e.trim(),n=r.trim();if("vapi"!==s.toLowerCase())return{provider:s,voiceId:n};let o=a(n);if(t.has(o.toLowerCase()))return{provider:"vapi",voiceId:o};let d=function(e){if(!e)return;let t=e.trim();if(t)return t.replace(/\s*\([^)]*\)\s*$/,"").trim()}(i);if(d){let e=a(d);if(t.has(e.toLowerCase()))return{provider:"vapi",voiceId:e}}return{provider:"vapi",voiceId:n}}e.s(["normalizeVoiceSelection",()=>r])},53791,95265,e=>{"use strict";var t=e.i(43793);async function a(e){let a=await t.prisma.integration.findMany({where:{orgId:e,mode:"eburon_credential",status:"active",upstreamCredentialId:{not:null}},select:{upstreamCredentialId:!0},orderBy:{createdAt:"asc"}}),r=new Set;for(let e of a){let t=e.upstreamCredentialId?.trim();t&&r.add(t)}return Array.from(r)}e.s(["getActiveAssistantCredentialIds",()=>a],53791);var r=e.i(21486);function i(e,t,a={}){let s="assistant-waits-for-user"===e.firstMessageMode?"assistant-waits-for-user":"assistant-speaks-first",n=(0,r.normalizeVoiceSelection)(t.upstreamProvider,t.upstreamVoiceId,t.label),o={name:e.name,firstMessage:e.intro,firstMessageMode:s,model:{provider:"openai",model:"gpt-4o-mini",messages:[{role:"system",content:e.systemPrompt}],temperature:.4},transcriber:{provider:"deepgram",model:"nova-3",language:"en-US"},voice:n,endCallMessage:"Thanks for calling Eburon Voice. Goodbye.",recordingEnabled:!0,maxDurationSeconds:900};return a.credentialIds&&a.credentialIds.length>0&&(o.credentialIds=Array.from(new Set(a.credentialIds))),o}e.s(["buildAssistantTemplate",()=>i],95265)},30248,e=>{"use strict";var t=e.i(43793);async function a(e){let a=e?.trim();if(a){let e=await t.prisma.voiceCatalog.findFirst({where:{id:a,isApproved:!0}});if(e)return e}let r=await t.prisma.voiceCatalog.findFirst({where:{isApproved:!0,OR:[{id:"orbit-elliot"},{upstreamProvider:"vapi",upstreamVoiceId:"elliot"}]},orderBy:[{sortOrder:"asc"},{label:"asc"}]});if(r)return r;let i=await t.prisma.voiceCatalog.findFirst({where:{isApproved:!0,upstreamProvider:"vapi"},orderBy:[{sortOrder:"asc"},{label:"asc"}]});return i||t.prisma.voiceCatalog.findFirst({where:{isApproved:!0},orderBy:[{sortOrder:"asc"},{label:"asc"}]})}e.s(["resolveDefaultApprovedVoice",()=>a])},56957,e=>{"use strict";function t(e){return{id:e.id,name:e.name,intro:e.intro,firstMessageMode:e.firstMessageMode,systemPrompt:e.systemPrompt,voiceId:e.voiceId,voiceLabel:e.voice.label,status:e.status,isLocked:e.isLocked,deployedAt:e.deployedAt,createdAt:e.createdAt,updatedAt:e.updatedAt,remoteAgentId:e.vapiAssistantId}}e.s(["serializeAgent",()=>t])},38254,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),i=e.i(59756),s=e.i(61916),n=e.i(74677),o=e.i(69741),d=e.i(16795),l=e.i(87718),c=e.i(95169),u=e.i(47587),p=e.i(66012),m=e.i(70101),v=e.i(26937),f=e.i(10372),g=e.i(93695);e.i(52474);var h=e.i(5232),w=e.i(69719),y=e.i(43793),A=e.i(53791),R=e.i(30248),C=e.i(84260),E=e.i(56957),I=e.i(95265);let b=/(llm|stt|tts|provider|model|transcriber)/i,M=w.z.enum(["assistant-speaks-first","assistant-waits-for-user"]),P=w.z.object({name:w.z.string().trim().min(2).max(80),intro:w.z.string().trim().min(4).max(500),systemPrompt:w.z.string().trim().min(20).max(5e3),voiceId:w.z.string().trim().min(2).max(120),firstMessageMode:M.optional()}).strict();var O=e.i(67629);let x=w.z.object({name:P.shape.name,intro:P.shape.intro,firstMessageMode:P.shape.firstMessageMode,systemPrompt:P.shape.systemPrompt,voiceId:P.shape.voiceId.optional()}).strict();async function T(e){return(0,C.runGatewayOptions)(e)}async function S(e,t){return(0,C.runGatewayHandler)(e,"agents.list",async({tenant:e})=>{let{id:a}=await t.params,r=await y.prisma.agent.findFirst({where:{orgId:e.org.id,OR:[{id:a},{vapiAssistantId:a}]},include:{voice:!0}});if(!r)throw Object.assign(Error("Agent not found."),{status:404});return{payload:{agent:(0,E.serializeAgent)(r)},resourceId:r.id}})}async function N(e,t){return(0,C.runGatewayHandler)(e,"agents.update",async({tenant:a})=>{let{id:r}=await t.params,i=await e.json();for(let e of Object.keys(i))if(b.test(e))throw Object.assign(Error(`Field '${e}' is not editable in this builder.`),{status:400});let s=x.parse(i),n=await y.prisma.agent.findFirst({where:{orgId:a.org.id,OR:[{id:r},{vapiAssistantId:r}]},include:{voice:!0}});if(!n)throw Object.assign(Error("Agent not found."),{status:404});if(n.isLocked&&"deployed"===n.status)throw Object.assign(Error("This deployed agent is locked. Use redeploy workflow."),{status:409});let o=await (0,R.resolveDefaultApprovedVoice)(s.voiceId||n.voiceId);if(!o)throw Object.assign(Error("No approved voices are available. Sync voices first."),{status:409});let d=await (0,A.getActiveAssistantCredentialIds)(a.org.id),l=(0,I.buildAssistantTemplate)({name:s.name,intro:s.intro,firstMessageMode:s.firstMessageMode??n.firstMessageMode,systemPrompt:s.systemPrompt},o,{credentialIds:d}),c=n.vapiAssistantId;if(c)await O.upstream.updateAssistant(c,l);else{let e=await O.upstream.createAssistant(l);if(!(c=String(e.id??e.assistantId??"").trim()))throw Object.assign(Error("Could not determine remote assistant id."),{status:502})}let u=await y.prisma.agent.update({where:{id:n.id},data:{name:s.name,intro:s.intro,firstMessageMode:s.firstMessageMode??n.firstMessageMode,systemPrompt:s.systemPrompt,voiceId:o.id,vapiAssistantId:c},include:{voice:!0}});return{payload:{agent:(0,E.serializeAgent)(u)},resourceId:u.id}})}e.s(["GET",()=>S,"OPTIONS",()=>T,"PATCH",()=>N,"dynamic",0,"force-dynamic"],10880);var k=e.i(10880);let H=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/ev/voice/agents/[id]/route",pathname:"/api/ev/voice/agents/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/ev/voice/agents/[id]/route.ts",nextConfigOutput:"",userland:k}),{workAsyncStorage:_,workUnitAsyncStorage:U,serverHooks:j}=H;function D(){return(0,r.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:U})}async function L(e,t,r){H.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/ev/voice/agents/[id]/route";w=w.replace(/\/index$/,"")||"/";let y=await H.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:A,params:R,nextConfig:C,parsedUrl:E,isDraftMode:I,prerenderManifest:b,routerServerContext:M,isOnDemandRevalidate:P,revalidateOnlyGenerated:O,resolvedPathname:x,clientReferenceManifest:T,serverActionsManifest:S}=y,N=(0,o.normalizeAppPath)(w),k=!!(b.dynamicRoutes[N]||b.routes[x]),_=async()=>((null==M?void 0:M.render404)?await M.render404(e,t,E,!1):t.end("This page could not be found"),null);if(k&&!I){let e=!!b.routes[x],t=b.dynamicRoutes[N];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await _();throw new g.NoFallbackError}}let U=null;!k||H.isDev||I||(U="/index"===(U=x)?"/":U);let j=!0===H.isDev||!k,D=k&&!j;S&&T&&(0,n.setManifestsSingleton)({page:w,clientReferenceManifest:T,serverActionsManifest:S});let L=e.method||"GET",F=(0,s.getTracer)(),q=F.getActiveScopeSpan(),z={params:R,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,i)=>H.onRequestError(e,t,r,i,M)},sharedContext:{buildId:A}},$=new d.NodeNextRequest(e),K=new d.NodeNextResponse(t),V=l.NextRequestAdapter.fromNodeNextRequest($,(0,l.signalFromNodeResponse)(t));try{let n=async e=>H.handle(V,z).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=F.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${L} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${w}`)}),o=!!(0,i.getRequestMeta)(e,"minimalMode"),d=async i=>{var s,d;let l=async({previousCacheEntry:a})=>{try{if(!o&&P&&O&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await n(i);e.fetchMetrics=z.renderOpts.fetchMetrics;let d=z.renderOpts.pendingWaitUntil;d&&r.waitUntil&&(r.waitUntil(d),d=void 0);let l=z.renderOpts.collectedTags;if(!k)return await (0,p.sendResponse)($,K,s,z.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(s.headers);l&&(t[f.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==z.renderOpts.collectedRevalidate&&!(z.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&z.renderOpts.collectedRevalidate,r=void 0===z.renderOpts.collectedExpire||z.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:z.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await H.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:P})},!1,M),t}},c=await H.handleResponse({req:e,nextConfig:C,cacheKey:U,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:O,responseGenerator:l,waitUntil:r.waitUntil,isMinimalMode:o});if(!k)return null;if((null==c||null==(s=c.value)?void 0:s.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(d=c.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",P?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),I&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,m.fromNodeOutgoingHttpHeaders)(c.value.headers);return o&&k||g.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,v.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)($,K,new Response(c.value.body,{headers:g,status:c.value.status||200})),null};q?await d(q):await F.withPropagatedContext(e.headers,()=>F.trace(c.BaseServerSpan.handleRequest,{spanName:`${L} ${w}`,kind:s.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},d))}catch(t){if(t instanceof g.NoFallbackError||await H.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:P})},!1,M),k)throw t;return await (0,p.sendResponse)($,K,new Response(null,{status:500})),null}}e.s(["handler",()=>L,"patchFetch",()=>D,"routeModule",()=>H,"serverHooks",()=>j,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>U],38254)}];

//# sourceMappingURL=_cb482b4f._.js.map