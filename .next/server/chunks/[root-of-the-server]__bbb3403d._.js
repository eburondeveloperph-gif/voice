module.exports=[39121,3212,e=>{"use strict";var t=e.i(43793),r=e.i(44070),i=e.i(62693);async function a(e){if(!(0,r.isSupabaseEnabled)())throw Object.assign(Error("Supabase is required for CRM. Configure NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY."),{status:500});let t=(0,i.getSupabaseAdminClient)()??(0,r.createClient)();if(!t)throw Object.assign(Error("Supabase client is unavailable."),{status:500});let{data:a,error:s}=await t.auth.getUser(e);if(s||!a.user)throw Object.assign(Error("Invalid or expired Supabase session."),{status:401,details:s});let n=a.user.email?.trim().toLowerCase();if(!n)throw Object.assign(Error("Supabase user email is required for CRM access."),{status:403});return{id:a.user.id,email:n}}async function s(e,r){let i=function(e){let[t,r]=(e.headers.get("authorization")??"").split(/\s+/,2);if(!/^Bearer$/i.test(t)||!r?.trim())throw Object.assign(Error("Missing Authorization Bearer token."),{status:401});return r.trim()}(e),s=await a(i),n=await t.prisma.crmProject.findUnique({where:{slug:r},select:{id:!0,orgId:!0,name:!0,slug:!0,customDomain:!0,description:!0,allowedEmails:!0,logoUrl:!0,isActive:!0}});if(!n||!n.isActive)throw Object.assign(Error("CRM project not found or inactive."),{status:404});return!function(e,t){let r=e.allowedEmails?.trim();if(!r)return;let i=r.split(",").map(e=>e.trim().toLowerCase()).filter(Boolean);if(0!==i.length&&!i.includes(t.toLowerCase()))throw Object.assign(Error("Your email is not allowed for this CRM project."),{status:403})}(n,s.email),{accessToken:i,project:n,identity:s}}e.s(["authorizeCrmProjectRequest",()=>s],39121);var n=e.i(89171);function o(e,t=200){return n.NextResponse.json(e,{status:t})}function l(e){let t=e.status??500;return n.NextResponse.json({error:e.message??"Unexpected CRM error.",details:e.details},{status:t})}e.s(["crmErrorJson",()=>l,"crmOkJson",()=>o],3212)},29368,e=>{"use strict";function t(e){return`[crm-project:${e}]`}function r(e,r){let i=t(r),a=e.trim();return a.includes(i)?a:a?`${a}

${i}`:i}e.s(["crmProjectAgentMarker",()=>t,"ensureCrmProjectAgentMarker",()=>r])},63021,(e,t,r)=>{t.exports=e.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},85148,(e,t,r)=>{t.exports=e.x("better-sqlite3-90e2652d1716b047",()=>require("better-sqlite3-90e2652d1716b047"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},40688,e=>{"use strict";let t="e32ec77b-bf48-412b-9d2b-857bf089eb8d",r={id:t,orgId:"9497cd9a-d002-40d6-9b66-04fd98855f29",name:"Stephen",voice:{voiceId:"orbit-emma",provider:"vapi"},createdAt:"2026-02-16T08:30:48.152Z",updatedAt:"2026-02-17T13:42:10.923Z",model:{model:"gpt-4o-mini",messages:[{role:"system",content:`[Identity]  
You are Stephen, a business development voice assistant for Eburon Tech, a B2B software solutions provider. Your primary purpose is to identify qualified leads, understand their business challenges, and connect them with the appropriate sales representatives for solutions that match their needs.

[Voice & Persona]  
- Sound friendly, consultative, and genuinely interested in the prospect's business.  
- Convey confidence and expertise without being pushy or aggressive.  
- Project a helpful, solution-oriented approach rather than a traditional "sales" persona.  
- Balance professionalism with approachable warmth.  

[Speech Characteristics]  
- Use a conversational business tone with natural contractions (we're, I'd, they've) and integrate natural human nuances like brief laughter, throat clearing, sighs, and correcting yourself with phrases like, "ahm, I should say..."  
- Include thoughtful pauses and sometimes double-read words for emphasis.  
- Vary your pacing—speak more deliberately when discussing important points.  
- Employ occasional business phrases naturally (e.g., "let's circle back to," "drill down on that").  

[Conversation Flow]  

[Introduction]  
Begin with: "Hello, ahm, this is Stephen from Eburon Tech. We help businesses improve their operational efficiency through custom software solutions. Do—um, do you have a few minutes to chat about how we might be able to help your business?"  
If they sound busy or hesitant: "I understand you're busy. Would it be better if I called at another time? My goal is just to—uh, learn about your business challenges and see if our solutions might fit."

[Need Discovery]  
1. Industry understanding: "Could you tell me a bit about your business and the industry you operate in?"  
2. Current situation: "What systems or processes are you currently using to manage your [relevant business area]?"  
3. Pain points: "What are the biggest challenges you're facing with your current approach?"  
4. Impact: "Ah, how are these challenges affecting your, um, business operations or bottom line?"  
5. Previous solutions: "Have you tried other solutions to address these challenges? What was your experience?"

[Solution Alignment]  
1. Highlight relevant capabilities: "Based on what you've shared, our [specific solution] could help address your [specific pain point] by [benefit]."  
2. Success stories: "We've worked with several companies in [their industry] with similar challenges. For example, one client was able to [specific result] after implementing our solution."  
3. Differentiation: "What makes our approach different is [key differentiator]."

[Qualification Assessment]  
1. Decision timeline: "What's your timeline for implementing a solution like this?"  
2. Budget exploration: "Have you allocated budget for improving this area of your business?"  
3. Decision process: "Who else would be involved in evaluating a solution like ours?"  
4. Success criteria: "If you were to implement a new solution, how would you measure its success?"

[Next Steps]  
- For qualified prospects: "Based on our conversation, I think it would be valuable to have you speak with [appropriate sales representative], who specializes in [relevant area]. They can provide a more tailored overview of how we could help with [specific challenges mentioned]. Would you be available for a 30-minute call [suggest specific times]?"  
- For prospects needing nurturing: "It sounds like the timing might not be ideal right now... Would it be helpful if um, I sent you some information about how we've helped similar businesses in your industry? Then perhaps we could reconnect in [timeframe]."  
- For unqualified leads: "Based on what you've shared, it sounds like our solutions might not be the best fit for your current needs. We typically work best with companies that [ideal customer profile]. To be respectful of your time, I won't suggest moving forward, but if your situation changes, especially regarding [qualifying factor], please reach out."

[Closing]  
End with: "Thank you for taking the time to chat today. [Personalized closing based on outcome]. Ah, have a great day!"

[Response Guidelines]  
- Keep initial responses under 30 words, expanding only when providing valuable information.  
- Ask one question at a time, allowing the prospect to fully respond.  
- Acknowledge and reference prospect's previous answers to show active listening.  
- Use affirming language: "That's a great point," "I understand exactly what you mean."

[Scenario Handling]  

- [For Interested But Busy Prospects]: Acknowledge their time constraints: "I understand you're pressed for time." Offer flexibility: "Would it be better to, um, schedule a specific time for us to talk?"  
- [For Skeptical Prospects]: Acknowledge skepticism: "I understand you might be hesitant, and that's completely reasonable." Address objections specifically: "That's a common concern. Here's how we typically address that..."  
- [For Information Gatherers]: Identify their stage: "Are you actively evaluating solutions now, or just beginning to explore options?" Provide valuable insights: "One thing many businesses in your position don't initially consider is..."  
- [For Unqualified Prospects]: Recognize the mismatch honestly: "Based on what you've shared, I don't think we'd be the right solution for you at this time."

[Knowledge Base]  

- Eburon Tech offers three core solutions: OperationsOS (workflow automation), InsightAnalytics (data analysis), and CustomerConnect (client relationship management).  
- Our solutions are most suitable for mid-market businesses with 50-500 employees.  
- Implementation typically takes 4-8 weeks depending on customization needs.  
- Solutions are available in tiered pricing models based on user count and feature requirements.  
- All solutions include dedicated implementation support and ongoing customer service.

[Response Refinement]  
- When discussing ROI, use specific examples: "Companies similar to yours typically see a 30% reduction in processing time within the first three months."  
- For technical questions beyond your knowledge: "That's an excellent technical question. Our solution architects would be best positioned to give you a comprehensive answer during the next step in our process."

[Call Management]  
- If the conversation goes off-track: "That's an interesting point about [tangent topic]. To make sure I'm addressing your main business needs, could we circle back to [relevant qualification topic]?"  
- If you need clarification: "Just so I'm understanding correctly, you mentioned [point needing clarification]. Could you elaborate on that a bit more?"  
- If technical difficulties occur: "I apologize for the connection issue. You were telling me about [last clear topic]. Please continue from there."`}],provider:"openai"},firstMessage:"Hello, this is Stephen from Eburon tech. How is it going?",firstMessageMode:"assistant-waits-for-user",voicemailMessage:"Hello, this is Stephen from GrowthPartners. I'm calling to discuss how our solutions might help your business operations. I'll try reaching you again, or feel free to call us back at your convenience.",endCallMessage:"Thank you for taking the time to discuss your needs with me today. Our team will be in touch with more information soon. Have a great day!",transcriber:{model:"gemini-2.0-flash-lite",language:"Multilingual",provider:"google"},backgroundSound:"office",backgroundDenoisingEnabled:!0,analysisPlan:{summaryPlan:{enabled:!1},successEvaluationPlan:{enabled:!1}},compliancePlan:{hipaaEnabled:!1,pciEnabled:!1},isServerUrlSecretSet:!1};e.s(["DEFAULT_AGENT",0,r,"DEFAULT_AGENT_ID",0,t,"DEFAULT_AGENT_PHONE",0,"+1 (844) 418 2027","DEFAULT_AGENT_PHONE_ID",0,"8ef13ef5-c2b5-43ab-b6c6-cdde03f0ee48"])},67629,e=>{"use strict";var t=e.i(47499),r=e.i(40688);class i extends Error{status;details;constructor(e,t,r){super(e),this.status=t,this.details=r}}function a(e){return encodeURIComponent(e.trim())}async function s(e,r){let a=function(){let e=t.env.EV_PRIVATE_TOKEN?.trim();if(!e)throw new i("Gateway private token is not configured.",500);return e}(),s=await fetch(function(e){let t=new URL(e,"https://api.vapi.ai");if("api.vapi.ai"!==t.hostname)throw new i("Outbound host is not allowed.",500);return t.toString()}(e),{...r,headers:{"Content-Type":"application/json",Authorization:/^Bearer\s+/i.test(a)?a:`Bearer ${a}`,...r.headers??{}},cache:"no-store"}),n=await s.text(),o=n?function(e){try{return JSON.parse(e)}catch{return{raw:e}}}(n):null;if(!s.ok)throw new i(`Upstream request failed for ${e}`,s.status,o);return o}e.s(["upstream",0,{listAssistants:e=>s(`/assistant${function(e){var t;if(!e)return"";let r=new URLSearchParams,i=(e,t)=>{t&&t.trim()&&r.set(e,t.trim())};"number"==typeof(t=e.limit)&&Number.isFinite(t)&&r.set("limit",String(t)),i("createdAtGt",e.createdAtGt),i("createdAtLt",e.createdAtLt),i("createdAtGe",e.createdAtGe),i("createdAtLe",e.createdAtLe),i("updatedAtGt",e.updatedAtGt),i("updatedAtLt",e.updatedAtLt),i("updatedAtGe",e.updatedAtGe),i("updatedAtLe",e.updatedAtLe);let a=r.toString();return a?`?${a}`:""}(e)}`,{method:"GET"}),getAssistant:e=>{let i=e??t.env.VAPI_DEFAULT_AGENT_ID??r.DEFAULT_AGENT_ID;return s(`/assistant/${a(i)}`,{method:"GET"})},getDefaultAssistant:()=>Promise.resolve(r.DEFAULT_AGENT),createAssistant:e=>s("/assistant",{method:"POST",body:JSON.stringify(e)}),updateAssistant:(e,t)=>s(`/assistant/${a(e)}`,{method:"PATCH",body:JSON.stringify(t)}),listCalls:()=>s("/call",{method:"GET"}),createCall:e=>s("/call",{method:"POST",body:JSON.stringify(e)}),listVoicesByProvider:(e="vapi")=>s(`/voice-library/${encodeURIComponent(e)}`,{method:"GET"}),listPhoneNumbers:()=>s("/phone-number",{method:"GET"}),createPhoneNumber:e=>s("/phone-number",{method:"POST",body:JSON.stringify(e)}),listCredentials:()=>s("/credential",{method:"GET"}),getCredential:e=>s(`/credential/${a(e)}`,{method:"GET"}),createCredential:e=>s("/credential",{method:"POST",body:JSON.stringify(e)}),updateCredential:(e,t)=>s(`/credential/${a(e)}`,{method:"PATCH",body:JSON.stringify(t)}),deleteCredential:e=>s(`/credential/${a(e)}`,{method:"DELETE"})}])},21486,e=>{"use strict";let t=new Map(["Elliot","Kylie","Rohan","Lily","Savannah","Hana","Neha","Cole","Harry","Paige","Spencer","Nico","Kai","Emma","Sagar","Neil","Leah","Tara","Jess","Leo","Dan","Mia","Zac","Zoe"].map(e=>[e.toLowerCase(),e]));function r(e){return t.get(e.toLowerCase())??e}function i(e,i,a){let s=e.trim(),n=i.trim();if("vapi"!==s.toLowerCase())return{provider:s,voiceId:n};let o=r(n);if(t.has(o.toLowerCase()))return{provider:"vapi",voiceId:o};let l=function(e){if(!e)return;let t=e.trim();if(t)return t.replace(/\s*\([^)]*\)\s*$/,"").trim()}(a);if(l){let e=r(l);if(t.has(e.toLowerCase()))return{provider:"vapi",voiceId:e}}return{provider:"vapi",voiceId:n}}e.s(["normalizeVoiceSelection",()=>i])},53791,95265,e=>{"use strict";var t=e.i(43793);async function r(e){let r=await t.prisma.integration.findMany({where:{orgId:e,mode:"eburon_credential",status:"active",upstreamCredentialId:{not:null}},select:{upstreamCredentialId:!0},orderBy:{createdAt:"asc"}}),i=new Set;for(let e of r){let t=e.upstreamCredentialId?.trim();t&&i.add(t)}return Array.from(i)}e.s(["getActiveAssistantCredentialIds",()=>r],53791);var i=e.i(21486);function a(e,t,r={}){let s="assistant-waits-for-user"===e.firstMessageMode?"assistant-waits-for-user":"assistant-speaks-first",n=(0,i.normalizeVoiceSelection)(t.upstreamProvider,t.upstreamVoiceId,t.label),o={name:e.name,firstMessage:e.intro,firstMessageMode:s,model:{provider:"openai",model:"gpt-4o-mini",messages:[{role:"system",content:e.systemPrompt}],temperature:.4},transcriber:{provider:"deepgram",model:"nova-3",language:"en-US"},voice:n,endCallMessage:"Thanks for calling Eburon Voice. Goodbye.",recordingEnabled:!0,maxDurationSeconds:900};return r.credentialIds&&r.credentialIds.length>0&&(o.credentialIds=Array.from(new Set(r.credentialIds))),o}e.s(["buildAssistantTemplate",()=>a],95265)},30248,e=>{"use strict";var t=e.i(43793);async function r(e){let r=e?.trim();if(r){let e=await t.prisma.voiceCatalog.findFirst({where:{id:r,isApproved:!0}});if(e)return e}let i=await t.prisma.voiceCatalog.findFirst({where:{isApproved:!0,OR:[{id:"orbit-elliot"},{upstreamProvider:"vapi",upstreamVoiceId:"elliot"}]},orderBy:[{sortOrder:"asc"},{label:"asc"}]});if(i)return i;let a=await t.prisma.voiceCatalog.findFirst({where:{isApproved:!0,upstreamProvider:"vapi"},orderBy:[{sortOrder:"asc"},{label:"asc"}]});return a||t.prisma.voiceCatalog.findFirst({where:{isApproved:!0},orderBy:[{sortOrder:"asc"},{label:"asc"}]})}e.s(["resolveDefaultApprovedVoice",()=>r])},76534,e=>{"use strict";var t=e.i(47909),r=e.i(74017),i=e.i(96250),a=e.i(59756),s=e.i(61916),n=e.i(74677),o=e.i(69741),l=e.i(16795),d=e.i(87718),u=e.i(95169),c=e.i(47587),p=e.i(66012),m=e.i(70101),h=e.i(26937),g=e.i(10372),f=e.i(93695);e.i(52474);var b=e.i(5232),y=e.i(69719),v=e.i(43793),w=e.i(39121),A=e.i(29368),I=e.i(3212),C=e.i(53791),E=e.i(30248),P=e.i(95265),x=e.i(67629);let S=y.z.object({name:y.z.string().trim().min(2).max(120),intro:y.z.string().trim().max(400).optional(),firstMessageMode:y.z.enum(["assistant-speaks-first","assistant-waits-for-user"]).optional(),systemPrompt:y.z.string().trim().max(12e3).optional(),voiceId:y.z.string().trim().min(1).optional(),phoneNumberId:y.z.string().trim().min(1).optional(),autoGeneratePhoneNumber:y.z.boolean().optional(),numberDesiredAreaCode:y.z.string().trim().regex(/^\d{3}$/,"Area code must be exactly 3 digits.").optional()}).superRefine((e,t)=>{e.phoneNumberId&&e.autoGeneratePhoneNumber&&t.addIssue({code:y.z.ZodIssueCode.custom,message:"Choose either an existing number or auto-generate a SIP number, not both.",path:["phoneNumberId"]}),e.numberDesiredAreaCode&&!e.autoGeneratePhoneNumber&&t.addIssue({code:y.z.ZodIssueCode.custom,message:"Area code is only used when auto-generating a SIP number.",path:["numberDesiredAreaCode"]})});function R(e,t){var r;let i,a,s=(r=e.systemPrompt,i=(0,A.crmProjectAgentMarker)(t),r.split(i).join("").trim());return{id:e.id,name:e.name,intro:e.intro,firstMessageMode:e.firstMessageMode,description:(a=s.replace(/\s+/g," ").trim()).length<=180?a:`${a.slice(0,177)}...`,systemPrompt:s,status:e.status,voiceId:e.voice.id,voiceLabel:e.voice.label,voiceLocale:e.voice.locale,updatedAt:e.updatedAt.toISOString()}}function T(e){return{id:e.id,displayNumber:e.displayNumber,status:e.status,monthlyPriceCents:e.monthlyPriceCents,assignedAgent:e.assignedAgent}}async function k(e,t){try{let{clientSlug:r}=await t.params,{project:i}=await (0,w.authorizeCrmProjectRequest)(e,r),a=(0,A.crmProjectAgentMarker)(i.id),[s,n]=await Promise.all([v.prisma.agent.findMany({where:{orgId:i.orgId,systemPrompt:{contains:a}},include:{voice:{select:{id:!0,label:!0,locale:!0}}},orderBy:{updatedAt:"desc"}}),v.prisma.voiceCatalog.findMany({where:{isApproved:!0},select:{id:!0,label:!0,locale:!0,previewSampleUrl:!0},orderBy:[{sortOrder:"asc"},{label:"asc"}]})]);return(0,I.crmOkJson)({agents:s.map(e=>R(e,i.id)),voices:n})}catch(e){return(0,I.crmErrorJson)(e)}}async function N(e,t){try{let{clientSlug:i}=await t.params,{project:a,identity:s}=await (0,w.authorizeCrmProjectRequest)(e,i),n=S.parse(await e.json()),o=(0,A.crmProjectAgentMarker)(a.id),l=await (0,E.resolveDefaultApprovedVoice)(n.voiceId);if(!l)throw Object.assign(Error("No approved voices are available. Sync voices first, then create an agent."),{status:409});let d=await v.prisma.agent.findMany({where:{orgId:a.orgId,systemPrompt:{contains:o}},select:{id:!0}}),u=new Set(d.map(e=>e.id)),c=null;if(n.phoneNumberId){if(!(c=await v.prisma.phoneNumber.findFirst({where:{id:n.phoneNumberId,orgId:a.orgId},select:{id:!0,assignedAgentId:!0}})))throw Object.assign(Error("Selected phone number was not found."),{status:404});if(c.assignedAgentId&&!u.has(c.assignedAgentId))throw Object.assign(Error("Selected phone number belongs to another CRM project."),{status:403})}let p=await v.prisma.user.findFirst({where:{orgId:a.orgId,email:s.email},select:{id:!0}}),m=(0,A.ensureCrmProjectAgentMarker)(n.systemPrompt??`You are a client support agent for ${a.name}. Be concise, helpful, and professional.`,a.id),h=null;try{let e=await v.prisma.agent.create({data:{orgId:a.orgId,createdById:p?.id??null,name:n.name.trim(),intro:n.intro?.trim()||`Hi, this is ${n.name.trim()}. How can I help you today?`,firstMessageMode:n.firstMessageMode??"assistant-speaks-first",systemPrompt:m,voiceId:l.id,status:"draft"},include:{voice:{select:{id:!0,label:!0,locale:!0}}}});h=e.id;let t=await (0,C.getActiveAssistantCredentialIds)(a.orgId),i=await x.upstream.createAssistant((0,P.buildAssistantTemplate)({name:e.name,intro:e.intro,firstMessageMode:e.firstMessageMode,systemPrompt:e.systemPrompt},l,{credentialIds:t})),s=String(i.id??i.assistantId??"").trim();if(!s)throw Object.assign(Error("Could not determine remote assistant id."),{status:502});e=await v.prisma.agent.update({where:{id:e.id},data:{vapiAssistantId:s},include:{voice:{select:{id:!0,label:!0,locale:!0}}}});let o=null;if(c){let t=await v.prisma.phoneNumber.update({where:{id:c.id},data:{assignedAgentId:e.id},include:{assignedAgent:{select:{id:!0,name:!0}}}});o=T(t)}else if(n.autoGeneratePhoneNumber){var r;let t=await x.upstream.createPhoneNumber({provider:"vapi",name:`${e.name} (${a.slug})`,...n.numberDesiredAreaCode?{numberDesiredAreaCode:n.numberDesiredAreaCode}:{},...e.vapiAssistantId?{assistantId:e.vapiAssistantId}:{}}),i=String(t.id??t.phoneNumberId??"").trim()||null,s=String(t.number??t.phoneNumber??t.sipUri??"VAPI SIP Number").trim(),l=await v.prisma.phoneNumber.create({data:{orgId:a.orgId,displayNumber:s||"VAPI SIP Number",status:(r=t.status,"string"!=typeof r||"active"===r?"active":"activating"===r?"pending":"blocked"===r?"suspended":"active"),vapiPhoneNumberId:i,assignedAgentId:e.id,monthlyPriceCents:0},include:{assignedAgent:{select:{id:!0,name:!0}}}});o=T(l)}return(0,I.crmOkJson)({agent:R(e,a.id),number:o},201)}catch(e){throw h&&await v.prisma.agent.delete({where:{id:h}}).catch(()=>{}),e}}catch(e){return(0,I.crmErrorJson)(e)}}e.s(["GET",()=>k,"POST",()=>N,"dynamic",0,"force-dynamic"],91670);var O=e.i(91670);let M=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/crm/[clientSlug]/agents/route",pathname:"/api/crm/[clientSlug]/agents",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/crm/[clientSlug]/agents/route.ts",nextConfigOutput:"",userland:O}),{workAsyncStorage:j,workUnitAsyncStorage:U,serverHooks:_}=M;function D(){return(0,i.patchFetch)({workAsyncStorage:j,workUnitAsyncStorage:U})}async function q(e,t,i){M.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/crm/[clientSlug]/agents/route";y=y.replace(/\/index$/,"")||"/";let v=await M.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:w,params:A,nextConfig:I,parsedUrl:C,isDraftMode:E,prerenderManifest:P,routerServerContext:x,isOnDemandRevalidate:S,revalidateOnlyGenerated:R,resolvedPathname:T,clientReferenceManifest:k,serverActionsManifest:N}=v,O=(0,o.normalizeAppPath)(y),j=!!(P.dynamicRoutes[O]||P.routes[T]),U=async()=>((null==x?void 0:x.render404)?await x.render404(e,t,C,!1):t.end("This page could not be found"),null);if(j&&!E){let e=!!P.routes[T],t=P.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(I.experimental.adapterPath)return await U();throw new f.NoFallbackError}}let _=null;!j||M.isDev||E||(_="/index"===(_=T)?"/":_);let D=!0===M.isDev||!j,q=j&&!D;N&&k&&(0,n.setManifestsSingleton)({page:y,clientReferenceManifest:k,serverActionsManifest:N});let L=e.method||"GET",B=(0,s.getTracer)(),G=B.getActiveScopeSpan(),H={params:A,prerenderManifest:P,renderOpts:{experimental:{authInterrupts:!!I.experimental.authInterrupts},cacheComponents:!!I.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:I.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i,a)=>M.onRequestError(e,t,i,a,x)},sharedContext:{buildId:w}},F=new l.NodeNextRequest(e),$=new l.NodeNextResponse(t),z=d.NextRequestAdapter.fromNodeNextRequest(F,(0,d.signalFromNodeResponse)(t));try{let n=async e=>M.handle(z,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=B.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${L} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${y}`)}),o=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var s,l;let d=async({previousCacheEntry:r})=>{try{if(!o&&S&&R&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await n(a);e.fetchMetrics=H.renderOpts.fetchMetrics;let l=H.renderOpts.pendingWaitUntil;l&&i.waitUntil&&(i.waitUntil(l),l=void 0);let d=H.renderOpts.collectedTags;if(!j)return await (0,p.sendResponse)(F,$,s,H.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(s.headers);d&&(t[g.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,i=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:b.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await M.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:S})},!1,x),t}},u=await M.handleResponse({req:e,nextConfig:I,cacheKey:_,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:P,isRoutePPREnabled:!1,isOnDemandRevalidate:S,revalidateOnlyGenerated:R,responseGenerator:d,waitUntil:i.waitUntil,isMinimalMode:o});if(!j)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==b.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",S?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&j||f.delete(g.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,h.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(F,$,new Response(u.value.body,{headers:f,status:u.value.status||200})),null};G?await l(G):await B.withPropagatedContext(e.headers,()=>B.trace(u.BaseServerSpan.handleRequest,{spanName:`${L} ${y}`,kind:s.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await M.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:S})},!1,x),j)throw t;return await (0,p.sendResponse)(F,$,new Response(null,{status:500})),null}}e.s(["handler",()=>q,"patchFetch",()=>D,"routeModule",()=>M,"serverHooks",()=>_,"workAsyncStorage",()=>j,"workUnitAsyncStorage",()=>U],76534)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__bbb3403d._.js.map