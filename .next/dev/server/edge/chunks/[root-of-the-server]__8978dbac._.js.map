{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\";\nimport { NextResponse, type NextRequest } from \"next/server\";\n\nconst INTERNAL_ROOT_SEGMENTS = new Set([\n    \"dashboard\",\n    \"create\",\n    \"agents\",\n    \"voices\",\n    \"dialer\",\n    \"calls\",\n    \"call-logs\",\n    \"contacts\",\n    \"numbers\",\n    \"settings\",\n    \"crm\",\n]);\n\nconst AUTH_ROUTE = \"/auth\";\n\nfunction isInternalRoute(pathname: string): boolean {\n    const firstSegment = pathname.split(\"/\").filter(Boolean)[0] ?? \"\";\n    return INTERNAL_ROOT_SEGMENTS.has(firstSegment);\n}\n\nexport async function middleware(request: NextRequest) {\n    const legacyPortalPathMatch = request.nextUrl.pathname.match(/^\\/crm\\/([^/]+)\\/?$/);\n    if (legacyPortalPathMatch) {\n        const url = request.nextUrl.clone();\n        url.pathname = `/portal/${legacyPortalPathMatch[1]}`;\n        return NextResponse.redirect(url);\n    }\n\n    let supabaseResponse = NextResponse.next({\n        request,\n    });\n\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n    if (!supabaseUrl || !supabaseKey) {\n        // Supabase is not configured, pass through (components will render a warning if needed)\n        return supabaseResponse;\n    }\n\n    const supabase = createServerClient(supabaseUrl, supabaseKey, {\n        cookies: {\n            getAll() {\n                return request.cookies.getAll();\n            },\n            setAll(cookiesToSet) {\n                cookiesToSet.forEach(({ name, value }) =>\n                    request.cookies.set(name, value)\n                );\n                supabaseResponse = NextResponse.next({\n                    request,\n                });\n                cookiesToSet.forEach(({ name, value }) =>\n                    supabaseResponse.cookies.set(name, value)\n                );\n            },\n        },\n    });\n\n    // ---------------------------------------------------------------------------\n    // ADMIN ROUTE PROTECTION (Basic Auth)\n    // ---------------------------------------------------------------------------\n    if (request.nextUrl.pathname.startsWith(\"/admin\")) {\n        const authHeader = request.headers.get(\"authorization\");\n        if (!authHeader) {\n            return new NextResponse(\"Authentication required\", {\n                status: 401,\n                headers: { \"WWW-Authenticate\": 'Basic realm=\"Admin Access\"' },\n            });\n        }\n\n        const authValue = authHeader.split(\" \")[1] ?? \"\";\n        const [user, pwd] = atob(authValue).split(\":\");\n\n        if (user !== \"master@eburon.ai\" || pwd !== \"120221\") {\n            return new NextResponse(\"Authentication required\", {\n                status: 401,\n                headers: { \"WWW-Authenticate\": 'Basic realm=\"Admin Access\"' },\n            });\n        }\n\n        // Allowed to proceed to /admin\n        return supabaseResponse;\n    }\n\n    // ---------------------------------------------------------------------------\n    // AUTHENTICATED ROUTES\n    // ---------------------------------------------------------------------------\n    // IMPORTANT: Avoid writing any logic between createServerClient and\n    // supabase.auth.getUser(). A simple mistake could make it very hard to debug\n    // issues with cross-browser cookies.\n    const {\n        data: { user },\n    } = await supabase.auth.getUser();\n\n    const isAuthRoute = request.nextUrl.pathname === AUTH_ROUTE;\n    const isProtected = isInternalRoute(request.nextUrl.pathname);\n\n    if (isProtected && !user) {\n        // If user is not signed in and trying to access a protected route,\n        // redirect them to the auth page\n        const url = request.nextUrl.clone();\n        url.pathname = AUTH_ROUTE;\n        return NextResponse.redirect(url);\n    }\n\n    if (isAuthRoute && user) {\n        // If user is already signed in and trying to access the auth page,\n        // redirect them to the dashboard\n        const url = request.nextUrl.clone();\n        url.pathname = \"/dashboard\";\n        return NextResponse.redirect(url);\n    }\n\n    return supabaseResponse;\n}\n\nexport const config = {\n    matcher: [\n        /*\n         * Match all request paths except for the ones starting with:\n         * - _next/static (static files)\n         * - _next/image (image optimization files)\n         * - favicon.ico (favicon file)\n         * - api (API routes except under certain conditions but generally bypassed)\n         */\n        \"/((?!_next/static|_next/image|favicon.ico|api|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)\",\n    ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AAAA;;;AAEA,MAAM,yBAAyB,IAAI,IAAI;IACnC;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACH;AAED,MAAM,aAAa;AAEnB,SAAS,gBAAgB,QAAgB;IACrC,MAAM,eAAe,SAAS,KAAK,CAAC,KAAK,MAAM,CAAC,QAAQ,CAAC,EAAE,IAAI;IAC/D,OAAO,uBAAuB,GAAG,CAAC;AACtC;AAEO,eAAe,WAAW,OAAoB;IACjD,MAAM,wBAAwB,QAAQ,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC;IAC7D,IAAI,uBAAuB;QACvB,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;QACjC,IAAI,QAAQ,GAAG,CAAC,QAAQ,EAAE,qBAAqB,CAAC,EAAE,EAAE;QACpD,OAAO,gMAAY,CAAC,QAAQ,CAAC;IACjC;IAEA,IAAI,mBAAmB,gMAAY,CAAC,IAAI,CAAC;QACrC;IACJ;IAEA,MAAM;IACN,MAAM;IAEN;;IAKA,MAAM,WAAW,IAAA,uMAAkB,EAAC,aAAa,aAAa;QAC1D,SAAS;YACL;gBACI,OAAO,QAAQ,OAAO,CAAC,MAAM;YACjC;YACA,QAAO,YAAY;gBACf,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,GACjC,QAAQ,OAAO,CAAC,GAAG,CAAC,MAAM;gBAE9B,mBAAmB,gMAAY,CAAC,IAAI,CAAC;oBACjC;gBACJ;gBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,GACjC,iBAAiB,OAAO,CAAC,GAAG,CAAC,MAAM;YAE3C;QACJ;IACJ;IAEA,8EAA8E;IAC9E,sCAAsC;IACtC,8EAA8E;IAC9E,IAAI,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,WAAW;QAC/C,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,IAAI,CAAC,YAAY;YACb,OAAO,IAAI,gMAAY,CAAC,2BAA2B;gBAC/C,QAAQ;gBACR,SAAS;oBAAE,oBAAoB;gBAA6B;YAChE;QACJ;QAEA,MAAM,YAAY,WAAW,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI;QAC9C,MAAM,CAAC,MAAM,IAAI,GAAG,KAAK,WAAW,KAAK,CAAC;QAE1C,IAAI,SAAS,sBAAsB,QAAQ,UAAU;YACjD,OAAO,IAAI,gMAAY,CAAC,2BAA2B;gBAC/C,QAAQ;gBACR,SAAS;oBAAE,oBAAoB;gBAA6B;YAChE;QACJ;QAEA,+BAA+B;QAC/B,OAAO;IACX;IAEA,8EAA8E;IAC9E,uBAAuB;IACvB,8EAA8E;IAC9E,oEAAoE;IACpE,6EAA6E;IAC7E,qCAAqC;IACrC,MAAM,EACF,MAAM,EAAE,IAAI,EAAE,EACjB,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,MAAM,cAAc,QAAQ,OAAO,CAAC,QAAQ,KAAK;IACjD,MAAM,cAAc,gBAAgB,QAAQ,OAAO,CAAC,QAAQ;IAE5D,IAAI,eAAe,CAAC,MAAM;QACtB,mEAAmE;QACnE,iCAAiC;QACjC,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;QACjC,IAAI,QAAQ,GAAG;QACf,OAAO,gMAAY,CAAC,QAAQ,CAAC;IACjC;IAEA,IAAI,eAAe,MAAM;QACrB,mEAAmE;QACnE,iCAAiC;QACjC,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;QACjC,IAAI,QAAQ,GAAG;QACf,OAAO,gMAAY,CAAC,QAAQ,CAAC;IACjC;IAEA,OAAO;AACX;AAEO,MAAM,SAAS;IAClB,SAAS;QACL;;;;;;SAMC,GACD;KACH;AACL"}}]
}